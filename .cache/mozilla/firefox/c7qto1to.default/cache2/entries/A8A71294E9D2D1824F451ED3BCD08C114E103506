/**
 * @modified $Author: lixingyuan $
 * @version $Rev: e08d0e45ee7510ad0c111a994dd19d25761391ee $
 */
!function(e){require.config({enable_ozma:true});define("tui/xDomainRequest",[],function(){var t=e.ajaxSettings.xhr();var i=!!t&&"withCredentials"in t;if(i||!e.ajaxTransport||!window.XDomainRequest)return e;var n=/^(https?:)?\/\//i;var a=/^get|post$/i;var r=new RegExp("^(//|"+location.protocol+")","i");e.ajaxTransport("* text html xml json",function(t,i,o){if(!t.crossDomain||!t.async||!a.test(t.type)||!n.test(t.url)||!r.test(t.url))return;var s=null;return{send:function(n,a){var r="";var o=(i.dataType||"").toLowerCase();s=new XDomainRequest;if(/^\d+$/.test(i.timeout))s.timeout=i.timeout;s.ontimeout=function(){a(500,"timeout")};s.onload=function(){var t="Content-Length: "+s.responseText.length+"\r\nContent-Type: "+s.contentType;var i={code:200,message:"success"};var n={text:s.responseText};try{if("html"===o||/text\/html/i.test(s.contentType))n.html=s.responseText;else if("json"===o||"text"!==o&&/\/json/i.test(s.contentType))try{n.json=e.parseJSON(s.responseText)}catch(r){i.code=500;i.message="parseerror"}else if("xml"===o||"text"!==o&&/\/xml/i.test(s.contentType)){var l=new window.ActiveXObject("Microsoft.XMLDOM");l.async=false;try{l.loadXML(s.responseText)}catch(r){l=void 0}if(!l||!l.documentElement||l.getElementsByTagName("parsererror").length){i.code=500;i.message="parseerror";throw new Error("Invalid XML: "+s.responseText)}n.xml=l}}catch(d){throw d}finally{a(i.code,i.message,n,t)}};s.onprogress=function(){};s.onerror=function(){a(500,"error",{text:s.responseText})};if(i.data)r="string"===e.type(i.data)?i.data:e.param(i.data);if("post"==t.type.toLowerCase()&&t.xhrFields&&true===t.xhrFields.withCredentials)r=r+"&cookie="+encodeURIComponent(document.cookie);s.open(t.type,t.url);s.send(r)},abort:function(){if(s)s.abort()}}})});define("module/comment/v3/utils",["module/comment/v3/model","tui/cookie","tui/net"],function(t,i){var n={escapePostsHtml:function(e){return e.replace(/<((?!(?:\/?(p|b|font))|br|img).*?)>/gi,"&#60;$1&#62;")},recordGoldlog:function(t,n){n.t=Date.now();i.getRequest("http://gm.mmstat.com/yt/"+t+"?"+e.param(n))}};return n});define("tui/plupload/plupload",[],function(){var t="uploader",i=t+1e17*Math.random(),n=e.noop,a={mode:"html5",action:"",name:"file",formData:null,multiple:false,auto:true,showQueue:false,fileSizeLimit:0,fileTypeDesc:"",fileTypeExts:"",maxChunkSize:512*1e3,maxConnections:2,preview:false,num:1e3,onInit:n,onClearQueue:n,onSelected:n,onCancel:n,onError:n,onStart:n,onProgress:n,onSuccess:n,onComplete:n,onAllComplete:n,onMouseOver:n,onMouseOut:n,onMouseClick:n,onAddQueue:function(e,t){var i='<li data-id="'+e.name+"_"+e.id+'"><div class="img-item">';if(this.options.preview)i+='<a href="javascript:;"  class="f-preview picbox '+this.id+"_preview_"+e.id+'"><img src="http://oss-comments.youku.com/pic/35ND0vgl/1481541888456.png"></a>';i+='<div class="opacity-dom"><a href="javascript:;" class="pic-icon">x</a></div>'+'<div class="img-load "><img src="http://oss-comments.youku.com/pic/WObxvPcs/1481541857541.gif"><div class="f-progress-bg"></div></div>'+"</div></li>";return i}},r={600:"Installation error",601:'Please select "{1}" format file',602:"The file size must be less than {1}"},o={};!function(e){var t=e.split(/,/),i,n,a;for(i=0;i<t.length;i+=2){a=t[i+1].split(/ /);for(n=0;n<a.length;n++)o[a[n]]=t[i]}}("image/x-icon,ico,"+"image/bmp,bmp,"+"image/gif,gif,"+"image/jpeg,jpeg jpg jpe,"+"image/photoshop,psd,"+"image/png,png,"+"image/svg+xml,svg svgz,"+"image/tiff,tiff tif,"+"text/plain,asc txt text diff log,"+"text/html,htm html xhtml,"+"text/xml,xml,"+"text/css,css,"+"text/csv,csv,"+"text/rtf,rtf,"+"audio/mpeg,mpga mpega mp2 mp3,"+"audio/x-wav,wav,"+"audio/mp4,m4a,"+"audio/ogg,oga,"+"audio/webm,webma,"+"video/mpeg,mpeg mpg mpe,"+"video/quicktime,qt mov,"+"video/mp4,mp4,"+"video/x-m4v,m4v,"+"video/x-flv,flv,"+"video/x-ms-wmv,wmv,"+"video/avi,avi,"+"video/ogg,ogv,"+"video/webm,webmv,"+"video/vnd.rn-realvideo,rv,"+"application/msword,doc dot,"+"application/pdf,pdf,"+"application/pgp-signature,pgp,"+"application/postscript,ps ai eps,"+"application/rtf,rtf,"+"application/vnd.ms-excel,xls xlb,"+"application/vnd.ms-powerpoint,ppt pps pot,"+"application/zip,zip,"+"application/x-rar-compressed,rar,"+"application/x-shockwave-flash,swf swfl,"+"application/vnd.openxmlformats-officedocument.wordprocessingml.document,docx,"+"application/vnd.openxmlformats-officedocument.wordprocessingml.template,dotx,"+"application/vnd.openxmlformats-officedocument.spreadsheetml.sheet,xlsx,"+"application/vnd.openxmlformats-officedocument.presentationml.presentation,pptx,"+"application/vnd.openxmlformats-officedocument.presentationml.template,potx,"+"application/vnd.openxmlformats-officedocument.presentationml.slideshow,ppsx,"+"application/x-javascript,js,"+"application/json,json,"+"application/java-archive,jar war ear,"+"application/vnd.oasis.opendocument.formula-template,otf,"+"application/octet-stream,exe");var s=function(){};s.extend=function(e){var t=this.prototype,i,n,a,r=t,o;if("function"===typeof e)e=e.call(t);a=e.__construct;while(!a){a=r.constructor;r=r.__super()}n=new this("!-");for(o in e)n[o]=e[o];i=function(){if("!-"!==arguments[0])a.apply(this,arguments)};n.constructor=i;n.__super=function(e,i){return e?t[e].apply(this,i?i:arguments.callee.caller.arguments):t};i.prototype=n;i.extend=arguments.callee;return i};var l=s.extend(function(){function n(e,t,i){var n="progress"===t,a;if(e&&e.timeStamp){a=e.timeStamp;if(String(a).length>13)a=+String(a).substr(0,13)}else a=+new Date;this.timeStamp=a;this.type=t;this.loaded=n?e.loaded:0;this.total=n?e.total:0;this.lengthComputable=n?e.lengthComputable:false;this.file=i||e.file;if(n)this.originalEvent=e;if(e.data)this.data=e.data}function a(e,t){this.id=e;this.name=t.name;this.size=t.size;this.type=!t.type?o[t.name.split(".").pop()]:t.type.length<6?o[t.type]:t.type;this.lastModifiedDate=new Date(+t.lastModifiedDate);this.originalFile=t;if(t.error)this.error=t.error}function r(e){var t=e.code||+e.message,i={600:"Installation Error",601:"Type Error",602:"Size Error"};if(t){this.code=t;e.name=e.name||i[t]||"HTTP Error";e.message=e.message||t}if(e.file)this.file=e.file;this.type="error";this.name=f(e.name||"Error");this.message=e.params?f.apply(null,[e.message].concat(e.params)):f(e.message)}function s(e){var t=this.queue,i=t.length;while(i--)if(t[i].id===e)return t[i]}function c(e){var t=e.substr(e.lastIndexOf(".")+1).toLowerCase();return this.acceptExts[t]}function p(e,t){return d(1e3*e/t)+"/s"}function h(t,i){var n=e("."+this.id+"_preview_"+t.id).parent(),a=n.find(".f-progress-bg");a.animate({width:i},200);n.find(".f-progress").text(i)}return{__construct:function(n,a){var r=n[i],o=t+"_",s;if(void 0!==r){o+=r;s=window[o];s&&s.destroy()}else{r=l.guid++;o+=r;n[i]=r}this.id=o;this.options=e.extend({},l.defaults,a);this.element=n;this.init();window[o]=this},init:function(){var t=this,i=e(t.element),n=t.options,a=i.outerWidth(),r=i.outerHeight(),o="width:"+a+"px;height:"+r+"px;",s="z-index:"+i.css("z-index")+";",l="margin:0;padding:0;border:0;cursor:pointer;font-size:200px;filter:alpha(opacity=0);opacity:0;";if(n.showQueue){if("string"===typeof n.showQueue)t.$queue=e(n.showQueue).addClass("upload-queue");else{i.after('<div class="upload-queue" id="'+t.id+'_queue"></div>');t.$queue=e("#"+t.id+"_queue")}if(n.preview)t.$queue.addClass("upload-preview")}var d=i.css("left"),u=i.css("top"),c=i.css("margin-left"),f=i.css("margin-top");if("absolute"===i.css("position"))s+="left:"+d+";top:"+u+";margin-left:"+c+";margin-top:"+f+";";else{s+="margin-left:-"+(a+(0^parseInt(i.css("margin-right")))+0^parseInt(d))+"px;";s+="margin-top:"+(0^parseInt(f)+0^parseInt(u))+"px;"}t.$browseEl=e('<span class="upload-el" style="position:absolute;overflow:hidden;'+o+s+'">'+t.create(l+o)+"</span>");i.after(t.$browseEl);t.$el=i;t.browse=e("#"+t.id)[0];t.queue=[];t.loadIndex=-1;t.acceptExts=function(t){if("*"===t)return t;var i={};e.each(t.split("|").join(",").split(","),function(e,t){i[t]=1});return i}(n.fileTypeExts);n.onInit.call(t)},setOption:function(t,i){var n=this.options;if("string"===typeof t)n[t]=i;else if("object"===typeof t)e.extend(n,t)},start:function(){var e=this,t=e.queue.length,i;e.loadIndex++;if(e.loadCount===t)e.onAllComplete();else if(e.loadIndex<t){i=e.queue[e.loadIndex];if(i.error||i.abort)e.start();else e.upload(i)}},remove:function(t){if(this.$queue)e("#"+this.id+"___"+t).delay(1e3).fadeOut(500).remove()},destroy:function(){this.$browseEl&&this.$browseEl.remove();this.$queue&&this.$queue.remove();delete window[this.id]},getFile:function(e){return this.validId(e)?this.files[e]:null},validId:function(e){var t=this.queue.length;while(t--)if(this.queue[t].id===e)return true},getDataURL:function(e){var t=this;if(window.File&&e instanceof File){if(window.FileReader){var i=new FileReader;i.onload=function(i){e.dataURL=this.result;t.setPreview(e)};i.readAsDataURL(e)}}else if(e.dataURL&&/^data:.*;base64/i.test(e.dataURL))t.setPreview(e)},setPreview:function(t){var i=this,n=i.options;e("."+this.id+"_preview_"+t.id).last().html('<img src="'+t.dataURL+'">')},onSelected:function(t){var i=this,n=i.options,o,s=n.fileTypeExts.split("|").join(","),l=u(n.fileSizeLimit);i.queue=[];i.files={};i.loadIndex=-1;i.loadCount=0;e.each(t,function(e,t){var d;o=new a(+e,t);t.id=e;if(n.preview)i.getDataURL(t);if("*"!==i.acceptExts&&!c.call(i,t.name)){i.onError({code:601,params:[s]},false);return}if(l>0&&o.size>l){o.error="Size Error";d=new r({code:602,params:[n.fileSizeLimit.toUpperCase()],file:o});i.onError(d,false)}i.files[e]=t;i.queue[e]=o});if(false===n.onSelected.call(i,i.queue))return;if(i.$queue){var d="",f=i.queue.length;e.each(i.queue,function(e,t){d+=n.onAddQueue.call(i,t,t.error)});i.$queue.append(d)}if(n.auto)i.start()},onStart:function(e){var t=this,i=e.file;e=new n(e,"loadstart",i);e.originalFile=t.files[i.id];i._t=e.timeStamp-1;i._l=0;l.uploading=true;t.options.onStart.call(t,e)},onProgress:function(e){var t=this,i=e.file||t.queue[e.id];e=new n(e,"progress",i);e.originalFile=t.files[i.id];if(e.lengthComputable){e.speed=p(e.loaded-i._l,e.timeStamp-i._t);if(t.$queue)h.call(t,i,Math.round(100*e.loaded/e.total).toFixed(1)+"%");i._t=e.timeStamp;i._l=e.loaded}t.options.onProgress.call(t,e)},onCancel:function(e){this.remove(e);this.queue[e].abort=true;this.options.onCancel.call(this,this.queue[e])},onClearQueue:function(){this.queue=[];if(this.$queue)this.$queue[0].innerHTML="";this.browse.style.display="";l.uploading=false;this.options.onClearQueue.call(this)},onError:function(t,i){var n=this.options,a=t.id||null,o=a?t.file||s.call(this,a):null;t=new r(t);if(n.language&&t.code&&n.language[t.code])t.message=n.language[t.code];if(null!==a){if(this.$queue)e("#"+this.id+"___"+a).addClass("upload-error").find(".f-progress").text(t.name);if(false!==i)this.onComplete(t)}this.options.onError.call(this,t)},onSuccess:function(e){e=new n(e,"load",this.queue[e.id]);h.call(this,e.file,"100%");this.options.onSuccess.call(this,e);this.onComplete(e)},onComplete:function(e){e=new n(e,"loadend");this.loadCount++;this.options.onComplete.call(this,e);this.start()},onAllComplete:function(){var e=this;l.uploading=false;e.files={};e.queue=[];e.options.onAllComplete.call(e)},onMouseOver:function(){this.$el.addClass("upload-btn-over");this.options.onMouseOver.call(this,this.$btn)},onMouseOut:function(){this.$el.removeClass("upload-btn-over");this.options.onMouseOut.call(this,this.$btn)},onMouseClick:function(){this.$el.trigger("click");this.options.onMouseClick.call(this,this.$btn)}}});if(!!(window.FormData&&(new XMLHttpRequest).upload))l.html5=l.extend(function(){var t={loadstart:"onStart",progress:"onProgress",error:"onError",load:"onSuccess",loadend:"onComplete"};function i(){var e=[],t=this.options.fileTypeExts.replace("|",",").split(","),i,n=t.length,a;if(n){for(i=0;i<n;i++){a=t[i];if(o[a])e.push("csv"===a?".csv":o[a])}return e.join(",")}}function n(){this.xhr=this.xhr||new XMLHttpRequest;return this.xhr}return{create:function(e){return'<input type="file" title="" class="uploader"'+' id="'+this.id+'"'+' style="'+e+'"'+' accept="'+i.call(this)+'"'+(this.options.multiple?" multiple":"")+">"},upload:function(i){var a=this,r=a.options,o,s,l;l=i.originalFile;if(!l)return;s=new FormData;s.append(r.name,l);if(r.formData)e.each(e.isFunction(r.formData)?r.formData.call(a):r.formData,function(e,t){s.append(e,t)});o=n.call(a);o.open(r.method||"POST",r.action,true);o.onreadystatechange=function(){if(4===o.readyState)if(200===o.status)a.onSuccess({file:i,data:o.responseText});else a.onError({file:i,code:o.status})};o.upload.onloadstart=o.upload.onprogress=o.upload.onerror=function(e){e.file=i;a[t[e.type]](e)};e.each({"Cache-Control":"no-cache","X-Requested-With":"XMLHttpRequest"},function(e,t){o.setRequestHeader(e,t)});o.withCredentials=true;o.send(s)},cancel:function(e){var t=this,i=t.queue;if(void 0===e||"*"===e){if(t.xhr&&t.xhr.readyState>0)t.xhr.abort();t.onClearQueue()}else{if(!i.length)return;if(t.xhr&&t.xhr.readyState>0&&t.queue[e])t.xhr.abort();t.onCancel(e)}},destroy:function(){if(this.browse)this.browse.parentNode.removeChild(this.browse);this.xhr=null;this.__super("destroy")}}});a.swf=function(){var e=document.getElementsByTagName("script"),t=e[0],i=t&&t.getAttribute("src"),n;if(!i)i="";n=i.split("/").slice(0,-1).join("/");if(n)n+="/";n="";return n+"uploader.swf"}();l.flash=l.extend(function(){var t=!!window.ActiveXObject,i=t&&!navigator.msDoNotTrack,n=+new Date;function a(e){if(!e.src)return;var i=e.src+(e.src.indexOf("?")!==-1?"&":"?")+"__="+n,a="",r={type:"application/x-shockwave-flash"},o={wmode:"transparent",allowScriptAccess:"always"},s=function(e){var t,i="";for(t in e)i+=" "+t+'="'+e[t]+'"';return i};!function(t){var i=t.length,n,a={};while(i--)a[t[i]]=1;for(n in e)if(a[n])r[n]=e[n];else o[n]=e[n]}("width height id class style".split(" "));o.src=i;if(t){r.codebase="http://download.macromedia.com/pub/shockwave/cabs/flash/swflash.cab#version=9,0,28,0";r.classid="clsid:d27cdb6e-ae6d-11cf-96b8-444553540000";a+="<object"+s(r)+">";for(var l in o)a+='<param name="'+l+'" value="'+o[l]+'">';a+="</object>"}else a+="<embed"+s(o)+s(r)+">";return a}function r(e){if(t){e.style.display="none";!function(){if(4===e.readyState){for(var t in e)if("function"===typeof e[t])e[t]=null;e.parentNode.removeChild(e)}else setTimeout(arguments.callee,15)}()}else e.parentNode.removeChild(e)}return{create:function(t){var n=this.options,r={id:this.id,path:function(){var e=location.pathname.split("/");e.pop();return e.join("/")+"/"}(),action:n.action,field:n.name,src:n.swf,desc:n.fileTypeDesc,ext:n.fileTypeExts};if(n.multiple)r.multiple=1;if(n.debug)r.debug=1;if(n.preview){r.preview=1;if(i)r.previewSize=31*1024}if(n.method)r.method=n.method;return a({src:n.swf,style:t,id:this.id,"class":"uploader",flashvars:e.param(r)})},upload:function(t){var i=this,n=i.options;if(n.formData)i.browse.setData(e.param(e.isFunction(n.formData)?n.formData.call(i):n.formData));var a=t.size/1024/1024;var r=a>1?1e3:100;if(a>2)r=2e3;else if(a>3)r=3e3;setTimeout(function(){try{i.browse.startUpload(""+t.id)}catch(e){}},r)},cancel:function(e){var t=this.queue;if(t.length)if(!e)e=t[0].id;this.browse.cancelUpload(e)},destroy:function(){r(this.browse);this.__super("destroy")}}});e(function(){var i=e("body");i.on("change."+t,":file."+t,function(){if(!this.value)return;window[this.id].onSelected(this.files);this.value=""}).on("click."+t,":file."+t,function(){window[this.id].onMouseClick()});i.on("mouseenter."+t,"div.upload-btn-wrap",function(){window[this.firstChild.id].onMouseOver()}).on("mouseleave."+t,"div.upload-btn-wrap",function(){window[this.firstChild.id].onMouseOut()});i.on("click."+t,"a.upload-cancel",function(t){var i=e(this).closest(".queue"),n=i.attr("id").split("___");if(i.hasClass("upload-error"))i.remove();else window[n[0]].cancel(n[1]);t.preventDefault()})});function d(e){var t=-1;if(e){do{e/=1024;t++}while(e>1024)}else{t++;e=0}return e.toFixed(2)+["KB","M","G","T"][t]}function u(e){var t={k:1024,m:1048576,g:1073741824},i;if("string"===typeof e){i=/([0-9\.]+)([mgk])/.exec(e.toLowerCase());e=+i[1];e*=t[i[2]]}return e}function c(e,t){var i=e.length,n,a;if(i>t){a=4+1+(i-e.lastIndexOf(".")-1);n=t-a-3;if(n%2)n-=1;e=e.substr(0,n)+"..."+e.substr(-a)}return e}function f(t){if(!t)return"";if("object"===typeof t)return e.extend(r,t);var i=r[t]||t,n=arguments;if(n.length>1)for(var a=1,o=n.length;a<o;a++)i=i.replace("{"+a+"}",n[a]);return i}l.guid=0;l.uploading=false;l.defaults=a;l.mimes=o;l.lang=r;l.i18n=f;l.stringifySize=d;l.parseSize=u;l.getShortName=c;e.uploader=l;e.fn.uploader=function(n){var r=arguments,o=this[0][i],s;if(void 0!==o)s=t+"_"+o;if(!r.length)return s?window[s]:null;if("string"===typeof n&&"on"!==n.substr(0,2)){if(s)window[s][n].apply(window[s],Array.prototype.slice.call(r,1))}else{this.off("remove."+t).on("remove."+t,function(){window[this[i]].destroy()});n=e.extend({},a,n);n.fileTypeExts=n.fileTypeExts.replace(/ /g,"");if(!l[n.mode])n.mode="flash";this.each(function(){new l[n.mode](this,n)})}return this};f({400:"(400)请求无效",404:"(404)请求的资源不存在",500:"(500)内部服务器错误",501:"(501)未执行",502:"(502)连接超时",600:"初始化上传发生错误",601:"请选择“{1}”格式的文件",602:"文件不能大于{1}"});return l});define("module/comment/v3/uploadimg",["tui/plupload/plupload"],function(t){var i={uploadst:[],errpic:0,mupload:function(i,n,a){var r=this;var o="."+i.id+"FormContent";var s=new t["flash"](e("#"+i.id+i.num)[0],{action:n+"/ycp/public/common/uploadPic",mode:"flash",name:"imageFiles",multiple:true,auto:false,swf:a+"/youku/dist/embed/swf/uploader.swf",preview:true,showQueue:"#"+i.id+"imgitem ul",fileSizeLimit:"5M",fileTypeDesc:"选择图片文件",fileTypeExts:"jpg,jpeg,gif,png",onInit:function(e){},onSelected:function(t){e(o+" .form-textarea-picdom").addClass("form-textarea-pic");if(r.uploadst.indexOf(i.id)<0){r.uploadst.push(i.id);r.mupload({id:i.id,num:1},n,a)}e(o+" .cont-imgupload").show();setTimeout(function(){s.start()},1e3);r.uploadAuto(o,1e3)},onCancel:function(e){},onStart:function(e){},onProgress:function(e){},onError:function(t){setTimeout(function(){e(o+" .cont-imgitem li").each(function(i){if(e(this).attr("data-id")==t.file.name+"_"+t.file.id)e(this).remove()});r.showError(o,t.message);r.uploadAuto(o)},1e3)},onSuccess:function(t){var i=JSON.parse(t.data);if(0==i.code)e(o+" .cont-imgitem li").each(function(n){if(e(this).attr("data-id")==t.file.name+"_"+t.file.id){e(this).addClass("img-itemload").attr({"data-src":i.data[0].picUrl,"data-arr":JSON.stringify(i.data[0])});e(this).find(".picbox img").attr("src",i.data[0].picUrl+"?x-oss-process=image/format,jpg/resize,m_fill,h_100,w_100")}});else{e(o+" .cont-imgitem li").each(function(i){if(e(this).attr("data-id")==t.file.name+"_"+t.file.id)e(this).remove()});if(i.code==-3008)r.showError(o,"您选择的图片尺寸太小，请上传质量更高的图片");else r.showError(o,i.message)}},onComplete:function(e){},onAllComplete:function(t){r.uploadAuto(o);if(e(o+" .cont-imgitem ul li").length>9){r.showError(o,"上传的文件已经超过9张，发表只会取前9张！");r.uploadAuto(o,1e3)}else if(e(o+" .cont-imgitem ul li").length>=9)r.uploadAuto(o,1e3)},onClearQueue:function(){}})},uploadAuto:function(t,i){if(1e3==i){e(t+" .upload-el").css({left:"-1000px"});e(t+" .ui-upload-a").addClass("ui-upload-ative")}else{e(t+" .upload-el").css({left:"auto"});e(t+" .ui-upload-a").removeClass("ui-upload-ative")}},showError:function(t,i){var n=e(t).find(".form-tooltip");n.find(".tips").html(i);n.show();setTimeout(function(){n.fadeOut()},2e3)}};return i});define("module/comment/v3/commentConfig",["tui/cookie"],function(t){var i={commentOpen:false,tabFixed:true,posts:true,tab:{my:true,hot:true,db:true,owner:true,star:true},text:{hotComment:true,at:true,ht:true,star:true},operate:{reply:true,input:true,top:true,inform:true},egg:true,quickreply:true,gift:true,picUpload:true};var n={globals:{userDomain:"//i.youku.com/i/"},init:function(t,n){e.extend(true,i,t);e.extend(true,this.globals,n)},check:function(t,n,a){if(1==arguments.length){n=t;t=true}else if(2==arguments.length&&e.isFunction(n)){a=n;n=t;t=true}if(!t)return false;var r=n.split(".");var o=i[r[0]];if(!o)return false;if(r.length>1&&!o[r[1]])return false;e.isFunction(a)&&a();return true},isJoinCommentTest:function(){if(["307775"].indexOf(this.globals.page.showid)===-1)return false;return 2},getCommentTestSpmConfig:function(t,i,n){var a=this.isJoinCommentTest();if(false===a)return"";if("comment"==t)return"data-spm=comment"+a;var r=e.extend({type:t,showid:this.globals.page.showid,videocode:this.globals.page.videoId2},n);return"data-spm-click=gostr=/yt/ykcomment.play.commentNewAlgorithm;locaid=d"+t+"_"+i+";"+e.param(r)}};return n});define("tui/encrypt/md5",[],function(){function e(e,t){var o=e[0],s=e[1],l=e[2],d=e[3];o=i(o,s,l,d,t[0],7,-680876936);d=i(d,o,s,l,t[1],12,-389564586);l=i(l,d,o,s,t[2],17,606105819);s=i(s,l,d,o,t[3],22,-1044525330);o=i(o,s,l,d,t[4],7,-176418897);d=i(d,o,s,l,t[5],12,1200080426);l=i(l,d,o,s,t[6],17,-1473231341);s=i(s,l,d,o,t[7],22,-45705983);o=i(o,s,l,d,t[8],7,1770035416);d=i(d,o,s,l,t[9],12,-1958414417);l=i(l,d,o,s,t[10],17,-42063);s=i(s,l,d,o,t[11],22,-1990404162);o=i(o,s,l,d,t[12],7,1804603682);d=i(d,o,s,l,t[13],12,-40341101);l=i(l,d,o,s,t[14],17,-1502002290);s=i(s,l,d,o,t[15],22,1236535329);o=n(o,s,l,d,t[1],5,-165796510);d=n(d,o,s,l,t[6],9,-1069501632);l=n(l,d,o,s,t[11],14,643717713);s=n(s,l,d,o,t[0],20,-373897302);o=n(o,s,l,d,t[5],5,-701558691);d=n(d,o,s,l,t[10],9,38016083);l=n(l,d,o,s,t[15],14,-660478335);s=n(s,l,d,o,t[4],20,-405537848);o=n(o,s,l,d,t[9],5,568446438);d=n(d,o,s,l,t[14],9,-1019803690);l=n(l,d,o,s,t[3],14,-187363961);s=n(s,l,d,o,t[8],20,1163531501);o=n(o,s,l,d,t[13],5,-1444681467);d=n(d,o,s,l,t[2],9,-51403784);l=n(l,d,o,s,t[7],14,1735328473);s=n(s,l,d,o,t[12],20,-1926607734);o=a(o,s,l,d,t[5],4,-378558);d=a(d,o,s,l,t[8],11,-2022574463);l=a(l,d,o,s,t[11],16,1839030562);s=a(s,l,d,o,t[14],23,-35309556);o=a(o,s,l,d,t[1],4,-1530992060);d=a(d,o,s,l,t[4],11,1272893353);l=a(l,d,o,s,t[7],16,-155497632);s=a(s,l,d,o,t[10],23,-1094730640);o=a(o,s,l,d,t[13],4,681279174);d=a(d,o,s,l,t[0],11,-358537222);l=a(l,d,o,s,t[3],16,-722521979);s=a(s,l,d,o,t[6],23,76029189);o=a(o,s,l,d,t[9],4,-640364487);d=a(d,o,s,l,t[12],11,-421815835);l=a(l,d,o,s,t[15],16,530742520);s=a(s,l,d,o,t[2],23,-995338651);o=r(o,s,l,d,t[0],6,-198630844);d=r(d,o,s,l,t[7],10,1126891415);l=r(l,d,o,s,t[14],15,-1416354905);s=r(s,l,d,o,t[5],21,-57434055);o=r(o,s,l,d,t[12],6,1700485571);d=r(d,o,s,l,t[3],10,-1894986606);l=r(l,d,o,s,t[10],15,-1051523);s=r(s,l,d,o,t[1],21,-2054922799);o=r(o,s,l,d,t[8],6,1873313359);d=r(d,o,s,l,t[15],10,-30611744);l=r(l,d,o,s,t[6],15,-1560198380);s=r(s,l,d,o,t[13],21,1309151649);o=r(o,s,l,d,t[4],6,-145523070);d=r(d,o,s,l,t[11],10,-1120210379);l=r(l,d,o,s,t[2],15,718787259);s=r(s,l,d,o,t[9],21,-343485551);e[0]=f(o,e[0]);e[1]=f(s,e[1]);e[2]=f(l,e[2]);e[3]=f(d,e[3])}function t(e,t,i,n,a,r){t=f(f(t,e),f(n,r));return f(t<<a|t>>>32-a,i)}function i(e,i,n,a,r,o,s){return t(i&n|~i&a,e,i,r,o,s)}function n(e,i,n,a,r,o,s){return t(i&a|n&~a,e,i,r,o,s)}function a(e,i,n,a,r,o,s){return t(i^n^a,e,i,r,o,s)}function r(e,i,n,a,r,o,s){return t(n^(i|~a),e,i,r,o,s)}function o(t){if(/[\x80-\xFF]/.test(t))t=unescape(encodeURI(t));txt="";var i=t.length,n=[1732584193,-271733879,-1732584194,271733878],a;for(a=64;a<=t.length;a+=64)e(n,s(t.substring(a-64,a)));t=t.substring(a-64);var r=[0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0];for(a=0;a<t.length;a++)r[a>>2]|=t.charCodeAt(a)<<(a%4<<3);r[a>>2]|=128<<(a%4<<3);if(a>55){e(n,r);for(a=0;a<16;a++)r[a]=0}r[14]=8*i;e(n,r);return n}function s(e){var t=[],i;for(i=0;i<64;i+=4)t[i>>2]=e.charCodeAt(i)+(e.charCodeAt(i+1)<<8)+(e.charCodeAt(i+2)<<16)+(e.charCodeAt(i+3)<<24);return t}var l="0123456789abcdef".split("");function d(e){var t="",i=0;for(;i<4;i++)t+=l[15&e>>8*i+4]+l[15&e>>8*i];return t}function u(e){for(var t=0;t<e.length;t++)e[t]=d(e[t]);return e.join("")}function c(e){return u(o(e))}function f(e,t){return 4294967295&e+t}return c});define("module/comment/v3/model",["tui/encrypt/md5","module/domain","module/comment/v3/commentConfig","module/comment/v3/uploadimg","module/comment/v3/utils","tui/cookie","tui/xDomainRequest"],function(t,i,n,a,r,o){var s="//p.comments.youku.com";var l="//js.ykimg.com";var d="//api.hdyy.tudou.com";function u(){if(n.globals.isTestEnv){s="//pre.comments.youku.com";d="//10.25.34.49:8080/int-api";l="//jstest.ykimg.com"}if(window.location.href.indexOf("type=test")>0)s="//ptest.comments.youku.com"}var c=function(e){return t(n.globals.appId+"&"+n.globals.appSecret+"&"+e)};function f(t){var i=0;var n=t.success;var a=t.error;delete t.success;delete t.error;t.success=function(e){if(!e){t.error();return}n&&n.apply(this,Array.prototype.slice.call(arguments))};t.error=function(n){i++;if(i<=0)e.ajax(t);else a&&a.apply(this,Array.prototype.slice.call(arguments))};t.cache="undefined"===typeof t.cache||t.cache;if(!t.jsonpCallback&&"jsonp"==t.dataType.toLocaleLowerCase()){var r=t.url.split("/");t.jsonpCallback="n_"+r[r.length-1].replace(/[^\w]+/g,"_")}e.ajax(t)}function p(){}var h={};var m={add:function(e,t){var i=h[e];if(!i)i=h[e]={loading:false,value:null,queue:[]};i.queue.push(t);if(i.value)this.run(i);return!!(i.loading||i.value)},run:function(e){e.queue.forEach(function(t){t&&t(e.value)});e.loading=false;e.queue=[];setTimeout(function(){e.value=null},6e4)},loading:function(e){h[e]&&(h[e].loading=true)},val:function(e,t){var i=h[e];if(i){i.value=t;this.run(i)}}};var v={submit:function(t,i){try{var n=e.ajaxSettings.xhr();var a=!!n&&"withCredentials"in n;if(!a)r.recordGoldlog("/ykcomment.cmt_submit_type.submitType",{type:window.XDomainRequest?1:0});if(!a&&!window.XDomainRequest){i({code:-99999,message:"您当前浏览器版本过低，请使用更高版本浏览器。"});return}}catch(o){}f({url:s+"/ycp/public/common/add?app="+t.app+"&sign="+t.sign+"&time="+t.time,data:t,dataType:"json",type:"post",contentType:"text/plain",xhrFields:{withCredentials:true},success:function(e){i(e)},error:function(){i({code:-1})}})},commentList:function(e,t){var i="/ycp/comment/pc/commentList";var a=false;if(1===n.isJoinCommentTest()){a=true;i="/ycp/comment/pc/sort/commentList"}f({url:s+i,data:e,dataType:"jsonp",jsonp:"jsoncallback",success:function(e){t&&t(e,a)},error:function(){t({code:-1})}})},getDbComment:function(e,t){f({url:s+"/ycp/comment/pc/getDbComment",data:e,dataType:"jsonp",jsonp:"jsoncallback",success:function(e){t&&t(e)},error:function(e){t({code:-1})}})},replyList:function(e,t){f({url:s+"/ycp/comment/pc/replyList",data:e,dataType:"jsonp",jsonp:"jsoncallback",success:function(e){t&&t(e)},error:function(e){t({code:-1})}})},setTop:function(e,t){f({url:s+"/ycp/comment/pc/setTop",data:e,dataType:"jsonp",jsonp:"jsoncallback",success:function(e){t&&t(e)},error:function(e){t({code:-1})}})},getInfo:function(e,t){f({url:s+"/ycp/comment/pc/getInfo",data:e,dataType:"jsonp",jsonp:"jsoncallback",success:function(e){t&&t(e)},error:function(e){t({code:-1})}})},objectCommentStatus:function(e,t){f({url:s+"/ycp/comment/pc/objectCommentStatus",data:e,dataType:"jsonp",jsonp:"jsoncallback",success:function(e){t&&t(e)},error:function(e){t({code:-1})}})},navigationBar:function(e,t){f({url:s+"/ycp/comment/pc/navigationBar",data:e,dataType:"jsonp",jsonp:"jsoncallback",success:function(e){t&&t(e)},error:function(e){t({code:-1})}})},getPersonInfo:function(e,t){f({url:s+"/ycp/comment/pc/getPersonInfo",data:e,dataType:"jsonp",jsonp:"jsoncallback",success:function(e){if(e&&e.data&&e.data.length>0){var i={};e.data.forEach(function(e){for(var t in e)i[t]=e[t]});e.data=i}t&&t(e)},error:function(e){t({code:-1})}})},getUserComment:function(e,t){f({url:s+"/ycp/comment/pc/getUserComment",data:e,dataType:"jsonp",jsonp:"jsoncallback",success:function(e){t&&t(e)},error:function(e){t({code:-1})}})},updown:function(e,t){f({url:s+"/ycp/comment/pc/updown?utdid="+o("juid"),data:e,dataType:"jsonp",jsonp:"jsoncallback",success:function(e){t&&t(e)},error:function(e){t({code:-1})}})},deleted:function(e,t){f({url:s+"/ycp/comment/pc/delete",data:e,dataType:"jsonp",jsonp:"jsoncallback",success:function(e){t&&t(e)},error:function(e){t({code:-1})}})},tipOffNew:function(e,t){f({url:s+"/ycp/tipOffNew.srv",data:e,dataType:"jsonp",jsonp:"jsoncallback",success:function(e){t&&t(e)},error:function(e){t({code:-1})}})},isNeedVerify:function(e,t){f({url:s+"/ycp/public/verify/isNeedVerify",data:e,dataType:"jsonp",jsonp:"jsoncallback",success:function(e){t&&t(e)},error:function(e){t({code:-1})}})},getVerifyCode:function(e,t){f({url:s+"/ycp/public/verify/getVerifyCode",data:e,dataType:"jsonp",jsonp:"jsoncallback",success:function(e){t&&t(e)},error:function(e){t({code:-1})}})},checkVerifyCode:function(e,t){f({url:s+"/ycp/public/verify/checkVerifyCode",data:e,dataType:"jsonp",jsonp:"jsoncallback",success:function(e){t&&t(e)},error:function(e){t({code:-1})}})},getPicFlag:function(e,t){f({url:s+"/ycp/public/common/getPicFlag.action",data:e,dataType:"jsonp",jsonp:"jsoncallback",success:function(e){t&&t(e)},error:function(e){t({code:-1})}})},mupload:function(e){a.mupload(e,s,l)},quickreply:function(e,t){f({url:d+"/hd/api/comments/quickreply",data:e,dataType:"jsonp",jsonp:"jsoncallback",success:function(e){t&&t(e)},error:function(e){t({code:-1})}})},getPosts:function(e,t){f({url:s+"/ycp/comment/pc/postList",data:e,dataType:"jsonp",jsonp:"jsoncallback",success:function(e){t&&t(e)},error:function(e){t({code:-1})}})},getPostsContent:function(e,t){f({url:s+"/ycp/comment/pc/getPostInfo",data:e,dataType:"jsonp",jsonp:"jsoncallback",success:function(e){t&&t(e)},error:function(e){t({code:-1})}})},getUserInfo:function(e,t){var i="login_getuserinfo";var n=m.add(i,t);if(n)return;m.loading(i);f({url:s+"/ycp/public/common/getUserInfo",data:e,dataType:"jsonp",jsonp:"jsoncallback",success:function(e){m.val(i,e)},error:function(e){t({code:-1})}})},getActivityInfo:function(e,t){f({url:s+"/ycp/public/common/getActivityRole",data:e,dataType:"jsonp",jsonp:"jsoncallback",success:function(e){t&&t(e)},error:function(e){t({code:-1})}})},addActivityName:function(e,t){f({url:s+"/ycp/public/common/addActName",data:e,dataType:"jsonp",jsonp:"jsoncallback",success:function(e){t&&t(e)},error:function(e){t({code:-1})}})}};var g={web_cms_module_pv:function(e,t){f({url:"//p.l.youku.com/web_cms_module_pv",data:e,dataType:"jsonp",jsonp:"__callback",success:function(e){t(e)}})},hasGiftForComment:function(e,t){f({url:"//www.youku.com/QVideo/~ajax/hasGiftForComment",dataType:"jsonp",jsonp:"__callback",data:{__ap:JSON.stringify(e)},success:function(e){t(e)}})},getUinfo:function(e){var t="login_getuinfo";var i=m.add(t,e);if(i)return;m.loading(t);f({url:"//lv.youku.com/api/grade/get_uinfo",dataType:"jsonp",success:function(e){m.val(t,e)}})},show_valid:function(e){var t="show_valid";var i=m.add(t,e);if(i)return;m.loading(t);f({url:"http://vip.youku.com/member/show_valid_member.jsonp?version=2",dataType:"jsonp",success:function(e){m.val(t,e)}})}};var y={load:f,createCrossIframe:p,switchEnv:u};for(var _ in v){if(!e.isFunction(v[_]))continue;!function(t){y[t]=function(i,a){if(!i)i={};if(e.isFunction(i)){a=i;i={}}var r=~~(Date.now()/1e3);i.app=n.globals.appId;i.sign=c(r);i.time=r;return v[t](i,a)}}(_)}e.extend(y,g);return y});define("module/comment/v3/commentLogin",["tui/event","tui/cookie","module/comment/v3/model"],function(t,i,n){var a=e.extend(new t,{_userInfo:null,isLogin:function(){var e=decodeURIComponent(i("P_gck")||"").split("|")[1];return!!(i("yktk")||e&&"NA"!==e||0)},uid:function(){var e=this.getUserInfo()||{};return e.yid||e.userId||0},getUserInfo:function(){return this._userInfo},login:function(t){var i=this;i.unbind(".loginoncecallback").one("login:after.loginoncecallback",t);e.isFunction(i.loginFunc)&&i.loginFunc(function(){i.trigger("login:success")});return i},init:function(){this._loadUserInfo()},_loadUserInfo:function(){var e=this;if(!e.isLogin())return;n.getUserInfo(function(t){if(0!=t.code)return;e._userInfo=t.data;e.trigger("login:after",[t.data])})}});a.bind("login:success",function(){a._loadUserInfo()});return a});define("module/cms/dataStore",["tui/event"],function(t){var i;var n=t.extend({initialize:function(e){var t=this;n.superClass.initialize.call(t);t.fetch(e)},get:function(e){if(!this.storage)return null;
return this.storage[e]||null},fetch:function(t){var i=this;var n=e.ajax({url:"//cmstool.youku.com/cms/tool/pub/get_putdata.json?securemode=2",data:t,dataType:"jsonp"});n.done(function(e){i.storage=e.data})}});n.getInstance=function(e){if(i)return i;else return i=new n(e)};return n});define("tui/view",["tui/event"],function(t){var i="ontouchstart"in window||navigator.maxTouchPoints>0||navigator.msMaxTouchPoints>0;var n=0;var a;var r=".delegateEvents";var o=function(i){this.clsid=n++;this._configure(i||{});this._ensureElement();this.initialize.apply(this,arguments);this.delegateEvents();e.extend(this,new t)};var s={};var l=["el","id","attrs","className","tagName","model"];var d=/^(\S+)\s*(.*)$/;e.extend(o.prototype,{tagName:"div",initialize:function(){},render:function(){return this},get:function(e){return s[e]||null},find:function(e){return this.$el.find(e)},remove:function(){this.$el.remove();this.undelegateEvents();this.unbind();return this},create:function(t,i,n){var a=document.createElement(t);if(i)e(a).attr(i);if(n)e(a).html(n);return a},setElement:function(t,i){if(this.$el)this.undelegateEvents();this.$el=t instanceof e?t:e(t);this.el=this.$el[0];if(false!==i)this.delegateEvents();return this},delegateEvents:function(t){if(!(t||(t=this.events)))return;this.undelegateEvents();for(var i in t){var n=t[i];if(!e.isFunction(n))n=this[t[i]];if(!n)continue;var a=i.match(d);var o=a[1],s=a[2];n=n.bind(this);o=this._ensureTouch(o,s);o+=r+this.clsid;if(""===s)this.$el.on(o,n);else this.$el.on(o,s,n)}return this},undelegateEvents:function(e,t){var e=e?this._ensureTouch(e):"";this.$el.off(e+r+this.clsid,t);return this},modelEvents:function(t,i){i="{"+(e.trim(i)||"mod")+"} ";for(var n in this)if(0===n.indexOf(i))t.bind(n.slice(i.length),this[n],this)},_configure:function(t){if(this.options)t=e.extend({},this.options,t);for(var i=0,n=l.length;i<n;i++){var a=l[i];if(t[a])this[a]=t[a]}this.options=t},_ensureElement:function(){if(this.el)this.setElement(this.el,false);else{var e=this.attrs||{};if(this.id)e.id=this.id;if(this.className)e["class"]=this.className;this.setElement(this.create(this.tagName,e),false)}},_ensureTouch:function(e,t){if(i&&window.tudouClickStat){if(("click"==e||"tap"==e||"singleTap"==e)&&""!==t){var n=e+r+this.clsid;this.$el.on(n,t,function(e){if(!tudouClickStat.getStatTarget(e.target)){if(void 0===e.pageX)e.pageX=e.pageY=0;if(a)clearTimeout(a);a=setTimeout(function(){tudouClickStat.send(e,{},function(){},true)},10)}})}return e}switch(e){case"tap":case"singleTap":return"click";case"doubleTap":return"dblclick"}return e},_clearTimer:function(){var e=arguments;for(var t=0,i=e.length;t<i;t++){var n=e[t];if(n){clearTimeout(n);clearInterval(n)}}return null}});o.create=function(e,t){if(e&&!s[e])return s[e]=new this(t);return new this(t)};o.instance=function(e,t){if(e&&!s[e])return s[e]=t;return s[e]||null};o.destroy=function(e){if(e){if(s[e]){s[e].remove();delete s[e]}}else for(var t in s)arguments.callee(t)};o.extend=function(t,i){var n=this;var a=function(){n.apply(this,arguments)};e.extend(a,n,i);var r=function(){this.constructor=a};r.prototype=n.prototype;a.prototype=new r;e.extend(a.prototype,t);a.superClass=n.prototype;return a};return o});define("module/comment/v3/cmtegg",["tui/view","module/cms/dataStore"],function(t,i){var n=t.extend({initialize:function(e){var t=this;var n=e.params;t.modelEvents(e.form,"form");t.dataStore=i.getInstance(n)},boom:function(t,i){var n=this;var a=e(window).scrollTop()-222;var r=e("#videoCommentlist .comment-list-main");if(r.length>0)a=r.offset().top-300;if("png"==i||"gif"==i){var o='<img src="'+t+'">';n.$egg=e('<div style="z-index:99;position:absolute;left:50%;margin-left:-430px;top:50%; margin-top:'+a+'px;width:860px;height:444px;background:transparent;">'+o+"</div>");e(document.body).append(n.$egg)}else{var s='<object type="application/x-shockwave-flash" data="'+t+'" width="100%" height="100%"><param name="wmode" value="transparent"><param name="movie" value="'+t+'" width="100%" height="100%"><embed src="'+t+'" width="100%" height="100%" border="0" align="center" wmode="transparent"></object>';n.$egg=e('<div style="z-index:99;position:absolute;left:50%;margin-left:-430px;top:50%; margin-top:'+a+'px;width:860px;height:444px;background:transparent;">'+s+"</div>");e(document.body).append(n.$egg)}setTimeout(function(){n.$egg.remove()},11e3)},"{form} submit:success":function(e){var t=this;var i=t.dataStore.get("comment");if(!i)return;var n=i[0];if(n)i=i[0];else i=i.show?i.show:i.folder;if(i&&i.content.length>0){var a=JSON.parse(i.content);if(!a||a.length<=0)return;for(var r=0,o=a.length;r<o;r++){if(a[r].keywordContent.length<=0)continue;var s=new RegExp(a[r].keywordContent.replace(",","|"));if(s.test(e.params.content)){t.boom(a[r].keywordlink,a[r].keywordtype);break}}}}});return n});define("module/comment/v3/commentImage",["tui/art","tui/dialog","module/comment/v3/model","tui/view"],function(t,i,n,a){var r=t.compile('<% if(picList && picList.length > 0) { %>\n<div class="comment-image">\n<div class="comment-img-view" style="display:none">\n<div class="comment-img-stage">\n<span class="smallcursor" data-count="<%=picList.length%>" data-index="0">\n<img alt="" />\n</span>\n<i node-type="loading" class="W_loading"></i>\n</div>\n<div class="comment-img-choose fix">\n<ul class="fix">\n<%picList.forEach(function(pic,i){%>\n<li data-index="<%=i%>">\n<a class="<%if(i==0){%>active<%}%>" href="javascript:;">\n<img src="<%=pic.picUrl%>?x-oss-process=image/format,jpg/resize,m_fill,h_100,w_100"  data-msrc="<%=pic.picUrl%>" data-width="<%=pic.width%>" data-height="<%=pic.height%>">\n</a>\n</li>\n<%})%>\n</ul>\n</div>\n</div>\n<% var isShowBig = !(picList.length == 1 && picList[0].width<300 && picList[0].height<300); %>\n<div class="comment-img-list">\n<ul class="fix comment-img-<%=picList.length%> <%if(isShowBig){%>bigcursor<%}%>">\n<%picList.forEach(function(pic,i){%>\n<li class="li_<%=i%>" data-index="<%=i%>">\n<%if(picList.length==1){%>\n<img src="<%=pic.picUrl%><%if(isShowBig){%>?x-oss-process=image/format,jpg/resize,m_lfit,h_300,w_300<%}%>">\n<%}else{%>\n<img src="<%=pic.picUrl%>?x-oss-process=image/format,jpg/resize,m_fill,h_100,w_100">\n<%}%>\n<%if(pic.picUrl.indexOf(\'.gif\')>0){%>\n<span class="gif-icon">GIF</span>\n<%}%>\n</li>\n<%})%>\n</ul>\n</div>\n</div>\n<% } %>');var o=a.extend({initialize:function(e){},render:function(e){return r(e||{})},events:{"click .comment-image .comment-img-list li":"txtpic","click .comment-image .comment-img-choose li":"txtpicslid","click .comment-image .comment-img-stage span":"txtpicsmallck","mousemove .comment-image .comment-img-stage span":"txtpicsmallms"},txtpic:function(t){var i=this;var n=e(t.currentTarget);if(!n.closest("ul").hasClass("bigcursor"))return;var a=n.closest(".comment-image");a.find(".comment-img-list").hide();a.find(".comment-img-view").show();i.imgloadfn(n,n.index())},txtpicslid:function(t){var i=this;var n=e(t.currentTarget);i.imgloadfn(n,n.index())},txtpicsmallck:function(t){var i=this;var n=e(t.currentTarget);var a=n.closest(".comment-image");var r=parseInt(n.data("index"),10);var o=parseInt(n.data("count"),10);if(n.hasClass("leftcursor"))r>0&&i.imgloadfn(n,r-1);else if(n.hasClass("rightcursor"))r<o-1&&i.imgloadfn(n,r+1);else if(n.hasClass("smallcursor")){a.find(".comment-img-list").show();a.find(".comment-img-view").hide()}},txtpicsmallms:function(t){var i=e(t.currentTarget);var n=parseInt(i.data("index"),10);var a=parseInt(i.data("count"),10);var r=i.width();if(t.offsetX<.33*r){if(!i.hasClass("leftcursor")&&n>0)i.removeClass("rightcursor smallcursor").addClass("leftcursor")}else if(t.offsetX>.66*r){if(!i.hasClass("rightcursor")&&n<a-1)i.removeClass("leftcursor smallcursor").addClass("rightcursor")}else if(!i.hasClass("smallcursor"))i.removeClass("rightcursor leftcursor").addClass("smallcursor")},imgloadfn:function(e,t){var i=e.closest(".comment-image");var n=i.find(".comment-img-choose li");var a=n.eq(t);var r=i.find(".comment-img-stage span");var o=r.find("img");if(n.length>1){n.removeClass("active");a.addClass("active")}else n.hide();var s=a.find("img");var l=imgW=s.data("width");var d=imgH=s.data("height");var u=s.data("msrc");if(u){if(Math.max(l,d)>=600){var c=l>=d;var f=(c?l:d)/600;if(c){l=600;d=Math.floor(d/f)}else{l=Math.floor(l/f);d=600}}r.addClass("comment-img-loading").css({width:l>100?l:100,height:d>100?d:100});o.hide();var p="?x-oss-process=image/resize,w_200";if(imgW<600)if(imgH<600)if(imgW>imgH){p="?x-oss-process=image/resize,w_"+imgW;if(imgH<200)p="?x-oss-process=image/resize,h_200"}else{p="?x-oss-process=image/resize,w_"+imgW;if(imgH<200)p="?x-oss-process=image/resize,h_200"}else p="?x-oss-process=image/resize,w_600";else if(imgW>=600)if(imgH<600){p="?x-oss-process=image/resize,w_600";if(imgH<200)p="?x-oss-process=image/resize,m_lfit,w_600,h_200"}else p="?x-oss-process=image/resize,w_600";u+=p;var h=new Image;h.onload=function(){o.attr("src",u).show();r.removeAttr("style").removeClass("comment-img-loading").data("index",t);if(t<=0||t>=n.length-1)r.removeClass("rightcursor leftcursor").addClass("smallcursor")};h.src=u}}});return o});define("module/comment/v3/commentToolbar",["tui/art","tui/view","tui/dialog","module/comment/v3/model","module/comment/v3/commentConfig","module/comment/v3/commentLogin"],function(t,i,n,a,r,o){var s=Array.prototype.slice;var l=t.compile('<div class="comment-handle">\n<%if(showUp){%>\n<a href="javascript:;" data-id="<%=id%>" class="comment-handle-btn comment-handle-up" <%=getSpmConfig(\'top\')%> ><%=upCount || \'\'%></a>\n<%}%>\n<%if(showDown){%>\n<a href="javascript:;" data-id="<%=id%>" class="comment-handle-btn comment-handle-down" <%=getSpmConfig(\'down\')%> ><%=downCount || \'\'%></a>\n<%}%>\n<%if(showReply){%>\n<a href="javascript:;" data-id="<%=id%>" data-uid="<%=userId%>" class="comment-handle-btn comment-handle-reply" <%=getSpmConfig(\'commentreplyicon\')%> ><%if(replyCount>0){%>(<%=replyCount%>)<%}%></a>\n<%}%>\n<%if(showSubReply){%>\n<a href="javascript:;" data-id="<%=id%>" data-uname="<%=userName%>" class="comment-handle-btn comment-handle-subreply">回复</a>\n<%}%>\n<%if(canDelete && showDelete){%>\n<a href="javascript:;" data-id="<%=id%>" class="comment-handle-btn comment-handle-delete">删除</a>\n<%}%>\n<%if(canSetTop && showSetTop){%>\n<a href="javascript:;" data-id="<%=id%>" class="comment-handle-btn comment-handle-top"><%=isTop ? \'取消置顶\' : \'置顶\'%></a>\n<%}%>\n<%if(showInform){%>\n<a href="javascript:;" data-id="<%=id%>" class="comment-handle-btn comment-handle-inform">举报</a>\n<%}%>\n</div>');var d=i.extend({initialize:function(t){var i=this;i.objectInfo=t.objectInfo;i.items=e.extend({showUp:false,showDown:false,showReply:false,showSubReply:false,showDelete:false,showSetTop:false,showInform:false},t.items);["commentUp","commentDown","commentDelete","commentTop","commentReply","commentReplySub","commentDeleteCallback","commentTopCallback"].forEach(function(n){e.isFunction(t[n])&&(i[n]=t[n])})},render:function(t,i){t=e.extend({id:0,upCount:0,downCount:0,replyCount:0,userId:0,userName:"",isTop:false,canSetTop:false,canDelete:false,getSpmConfig:function(e){return r.getCommentTestSpmConfig(e,t.id)}},this.items,t,i);if(!r.check("operate.top"))t.showSetTop=false;return l(t)},events:{"click .comment-handle .comment-handle-up":"commentUp","click .comment-handle .comment-handle-down":"commnetDown","click .comment-handle .comment-handle-reply":"commentReply","click .comment-handle .comment-handle-subreply":"commentReplySub","click .comment-handle .comment-handle-delete":"commentDelete","click .comment-handle .comment-handle-inform":"commentInform","click .comment-handle .comment-handle-top":"commentTop"},commentUp:function(e){this.setSupport(e.target,1,"顶",".comment-handle-down");return false},commnetDown:function(e){this.setSupport(e.target,2,"踩",".comment-handle-up");return false},setSupport:function(t,i,n,r){var l=this;var d=o.isLogin();if(!d){var u=s.call(arguments);o.login(function(){l.setSupport.apply(l,u)});return}var c=e(t);if(c.hasClass("active"))return;var f=c.siblings(r);var p=c.data("id");var h=parseInt(c.text(),10)||0;a.updown({app:"pc",type:i,commentId:p,objectId:l.objectInfo.objectId,objectType:l.objectInfo.objectType},function(e){switch(parseInt(e.code,10)){case 0:f.removeClass("active");c.text(h+1).addClass("active");break;case 1:if(h<=0)h=1;f.removeClass("active");c.text(h+"您已经"+n+"过了").addClass("active");break;case 2:var t=(parseInt(f.text(),10)||0)-1;f.text(t>0?t:"").removeClass("active");c.text(h+1).addClass("active")}})},commentReplySub:function(e){return false},commentReply:function(e){return false},commentDelete:function(t){var i=this;var o=e(t.target);var s='<div style="text-align:center;"><div class="title"><i class="icon icon-prompt-warning"></i><span>你确定要删除该评论吗</span></div><p class="prompt">如果该评论下有其他回复也将一起删除</p></div>';var l=o.parent();new n({target:r.check("commentOpen")?l:null,hasMask:!r.check("commentOpen"),width:300,zIndex:20010,content:s,className:"yk-prompt-dialog",buttons:[{className:"prompt-btn prompt-btn-primary",name:"删 除",callback:function(s){s.preventDefault();var d=o.data("id");a.deleted({app:"pc",commentId:d,objectId:i.objectInfo.objectId,objectType:i.objectInfo.objectType},function(a){if(0==a.code){n.alert({target:r.check("commentOpen")?l:null,hasMask:!r.check("commentOpen"),zIndex:20010,content:"删除成功"});e.isFunction(i.commentDeleteCallback)&&i.commentDeleteCallback(d,t)}else n.alert({target:r.check("commentOpen")?l:null,hasMask:!r.check("commentOpen"),zIndex:20010,content:"删除失败，请重试"})});this.close()}},{className:"prompt-btn",name:"取消",callback:function(e){e.preventDefault();this.close()}}]});return false},commentTop:function(t){var i=this;var s=e(t.target);var l=s.parent();var d=o.isLogin();if(!d){o.login(function(){i.commentTop(t)});return}if(i.submit)return;i.submit=true;var u={app:"pc",objectId:i.objectInfo.objectId,objectType:i.objectInfo.objectType,commentId:s.data("id"),type:"置顶"==s.text()?1:2};a.setTop(u,function(a){i.submit=false;if(0!=a.code){n.alert({target:r.check("commentOpen")?l:null,hasMask:!r.check("commentOpen"),zIndex:20010,content:a.message});return}n.alert({target:r.check("commentOpen")?l:null,hasMask:!r.check("commentOpen"),zIndex:20010,content:"操作成功！"});s.text(1==u.type?"取消置顶":"置顶");e.isFunction(i.commentTopCallback)&&i.commentTopCallback(t)});return false},commentInform:function(t){var i=this;var o=e(t.currentTarget);var s=o.parent();var l='<div><div class="title"><span>匿名举报不会对您有任何影响，请选举举报原因：</span></div>'+'<p class="prompt">'+'<input type="radio" name="tip" value="1" id="gg"><label for="gg" class="prompt_rad">广告</label>'+'<input type="radio" name="tip" id="sq" value="2"><label for="sq" class="prompt_rad">色情</label>'+'<input type="radio" name="tip" id="mm" value="3"><label for="mm" class="prompt_rad">骚扰谩骂</label>'+'<input type="radio" name="tip" id="dy" value="4"><label for="dy" class="prompt_rad">地域攻击</label>'+'<input type="radio" name="tip" id="ey" value="5"><label for="ey" class="prompt_rad">恶意灌水</label>'+'<input type="radio" name="tip" id="qt" value="6"  checked="checked"><label for="qt" class="prompt_rad">其他</label>'+"</p>"+'<p class="prompt"><textarea class="defaultext" name="content" placeholder="请输入举报原因（至少5个字）！"></textarea></p></div>';new n({target:r.check("commentOpen")?s:null,hasMask:!r.check("commentOpen"),width:580,content:l,className:"yk-prompt-dialog yk-tip-dialog ",title:"举报",buttons:[{className:"prompt-btn prompt-tip-primary",name:"提交",callback:function(t){t.preventDefault();var l=o.data("id");var d="6";var u=e(".yk-tip-dialog .defaultext").val();e(".yk-tip-dialog input[name=tip]").each(function(){if(this.checked)d=e(this).val()});var c={app:"pc",objectId:i.objectInfo.objectId,objectType:i.objectInfo.objectType,commentId:l,memo:u,reason:d};if(!u){n.alert({target:r.check("commentOpen")?s:null,hasMask:!r.check("commentOpen"),zIndex:20010,content:"请填写举报原因"});return false}a.tipOffNew(c,function(e){if("0"==e.code){var t=n.alert({target:r.check("commentOpen")?s:null,hasMask:!r.check("commentOpen"),zIndex:20010,content:"提交成功，请等待客服审核"});setTimeout(function(){t.close()},1e3)}});this.close()}},{className:"prompt-btn prompt-close",name:"取消",callback:function(e){e.preventDefault();this.close()}}]});return false}});return d});define("module/comment/v3/giftarea",[],function(){"use strict";var t={getUserPageLink:function(e){if(!e||!uc_domain||"function"!=typeof encodeUid)return-1;return"//"+uc_domain+"/u/"+encodeUid(e)},PlayerPause:function(){return t.PlayerController(1)},PlayerStart:function(){return t.PlayerController(0)},playerShow:function(){if(!_player())return-1;_player().style.height="100%";_player().style.width="100%"},playerHide:function(){if(!_player())return-1;_player().style.height="0px";_player().style.width="0px"},PlayerController:function(e){if("function"==typeof PlayerPause){PlayerPause(e);return}return-1},islogin:function(){return islogin()},VideoOwner:function(){if(!video_owner)return-1;return video_owner},giftPannelSetContent:function(e,t,i){if(!e&&!t&&!jQuery("#giftForCommentPannel"))return-1;if(i)jQuery("#giftForCommentPannel").append('<img class = "YK_interact_plugins_container_lazyLodingImg"  src = "'+i+'" />');if("function"==typeof e)e(t)},giftPannelHide:function(){return giftForComment.hidePannel()},qwindowSetContent:function(e,t,i){if(!e&&!t)return-1;if(!this.qwindow)this.qwindowInit();var n=i?'<img src = "'+i+'" />':"";this.qwindow.setContent("html",'<div id= "giftWindowForPay" style = "height:100%; width:100%; background:#FFF;">'+n+"</div>");if("function"==typeof e)e(t)},qwindowShow:function(){if(!this.qwindow)this.qwindowInit();this.qwindow.hideHandle();this.qwindow.dom.winbg.className="";this.qwindow.show()},qwindowHide:function(){if(!this.qwindow)return-1;this.qwindow.hide()},qwindowDestroy:function(){if(!this.qwindow)return-1;this.qwindow.destroy()},changeWindowSize:function(e,t){this.windowsize.width=e;this.winbdow.height=t},qwindow:false,windowsize:{width:200,height:200},qwindowInit:function(){if(!this.qwindow)this.qwindow=new Qwindow({size:{width:this.windowsize.width,height:this.windowsize.height},content:{type:"html",value:""}});return},commitComment:function(i){if(jQuery("#verify_code_value").is(":visible")){e("content").value=i;return false}if(!e("content"))return-1;if(!i)return-2;t.CommentStorate=i;var n=window.videoId;var a=i.replace("：",":");e("content").focus();var r=e("content").value;e("content").value=a;pre="";try{var o="4000481";if(2==parseInt(playmode))o="4000495";if(3==parseInt(playmode))o="4000488"}catch(s){}var l="1_1";if(2==parseInt(playmode))l="1_7";if(3==parseInt(playmode))l="1_4";window.flagId="";window.is_quote=true;var d="";Nova.QComments.comment({videoId:n,content:a,verify_code:d,reply_cid:"",soure_id:"",log_source_id:l,cmt_type:5,sync_ucenter:0,sync_renren:0,sync_sina:0,sync_tencent:0,sync_messenger:0,sync_qzone:0,sync_kaixin:0},t.commentsCallBack);VideoComments.isInputting=false;if(r)e("content").value=r;jQuery("content").blur();return false},CommentStorate:"",PayState:false,getPayState:function(){return t.PayState},setPayState:function(e){t.PayState=e;return e},verify_code_comment:function(){if(t.getPayState()&&jQuery("#verify_code_img").is(":visible"))return jQuery("#verify_code_img").clone();return false},commentsCallBack:function(i,n){if(!isNaN(i)){if(i<0){if(""!=t.CommentStorate){e("content").value=t.CommentStorate;jQuery("content").blur()}return}}else{if(null==i){e("content").value=t.CommentStorate;jQuery("content").blur();return}window.commentsCallBack(i,n)}},gotGiftBtn:function(){if(jQuery("#giftForCommentTab a").length+jQuery("#giftForCommentPannel").length<2)return-1;if(!jQuery("#commentAction"))return-2;var e=jQuery("#commentAction").offset().top-300;var t={scrollTop:e};jQuery("html,body").animate(t,1e3)}};return t});define("module/comment/v3/gift",["tui/view","tui/art","tui/util","module/comment/v3/model","module/comment/v3/giftarea","module/comment/v3/commentConfig"],function(t,i,n,a,r,o){var s={1:"103",2:"101",3:"100",4:"104",5:"102"};var l=t.extend({initialize:function(){var t=this;var i=t.page=o.globals.page;if(!i||!i.videoOwner)return;if(e("#ck_giftForComment").length>0)return;t.owner=i.videoOwner;a.hasGiftForComment({owner:i.videoOwner},function(e){t.giftForCommentShow(e)})},events:{"click #ck_giftForComment":"showAndHidePannel"},showAndHidePannel:function(t){var i=this;var n=e(t.currentTarget);if(n.hasClass("show")){i.hidePannel();return}var a=e("#commentAction .comment-form .form-user-avatar").outerWidth(true);var r=e("#giftForCommentPannel");r.css({"margin-left":a});n.addClass("show");r.show();if(!i.gifts)i.gifts=new window.YOUKU.API.Interact.GiftModule("6a4afb296a89b285",i.owner,r,e("#player")[0],function(){},function(){i.hidePannel()},"1"==i.page.playmode?7:6,function(){},{pvid:i.page.videoId,showId:i.page.showid,pageType:s[i.page.playmode]});if(i.gifts)i.gifts.sendShowTracking()},hidePannel:function(){e("#ck_giftForComment").removeClass("show");e("#giftForCommentPannel").hide()},giftForCommentShow:function(t){var i=this;if(t<0)return-1;if(t.haveGiftForComment){var n=e('<div class="form-cell form-gift"><a id="ck_giftForComment" href="javascript:;"></a></div><div id="giftForCommentPannel" class="form-gift-content"></div>');e("#commentAction .comment-form").append(n);i.setElement(n,true);window.__define=window.define;window.define=null;e.ajax({url:"//hudong.pl.youku.com/jsapi/interact/giftModule.js?_="+(new Date).toLocaleDateString().replace(/[\/-]/g,"_"),cache:false,dataType:"script",success:function(){window.define=window.__define;window.__define=null}})}}});return l});define("module/comment/v3/submit",["tui/view","tui/net","module/comment/v3/model","module/comment/v3/commentConfig","module/comment/v3/commentLogin"],function(t,i,n,a,r){var o={0:"发送成功。","-1":"服务器开小差，请稍后在试。","-2":"服务器开小差，请稍后在试。","-3":"服务器开小差，请稍后在试。","-4":"你没有操作权限，有疑问请联系客服400 810 0580","-5":"你的手速太快啦，亲稍后再试","-7":"您的评论含有网站禁止内容，请修改，谢谢！","-8":"内容不能为空。","-9":"请输入验证码","-10":"验证码输入错误，请重新输入。","-11":"请将文字减少到300字以内。","-12":"您还未购买本节目，请购买观看后再发表评论。","-13":"当前视频不存在。","-14":"当前视频被设置为禁止评论。","-20":"试图伪造明星评论被禁止，请重试","-30":"请输入回复内容后再发布","-100":"请先登录。","-400":"您已经发表了该评论，谢谢！","-450":"您的评论含有网站禁止内容，请修改，谢谢！","-130":"当前用户被禁止发布评论。","-131":"当前视频被禁止评论。","-2004":"服务器开小差，请稍后在试。","-2006":"评论内容包含不恰当内容，请修改。","-2007":"你被禁言了，有疑问请联系客服400 810 0580","-2082":"验证码输入错误，请重新输入。","-2008":"该视频禁止评论"};var s=t.extend({initialize:function(e){var t=this;t.playmode=e.playmode;t.$ta=t.find("textarea")},events:{},checkCommentsContent:function(){var t=this;var i=e.trim(t.$ta.val());var n=t.$el.find(".form-wordlimit .input-count").text();if("0"==n){t.showError(o[-8]);return false}var a=i.replace(/^回复 @.*?:/,"").replace(/(\r\n|\n|\r|\s)/g,"--").length;if(a<1||a>parseInt(t.$ta.data("maxlength"))){t.showError(o[a<1?-8:-11]);return false}var r=t.$el.find(".form-validate");var s=r.find(".verify_code_value").val();if("none"!==r.css("display")&&s.length<3){t.showError(o[-9]);return false}return true},commentNew:function(t,i){var s=e.extend({},t);var l=this;if(!r.isLogin()){r.login(function(){l.commentNew(t)});return false}var d=s.commentId||"";var u=s.sourceCommentId||"";var c=s.objectId||a.globals.page.videoId;var f=s.objectType||1;var p=s.picUploadId||"comment";var h=s.flag;if(!l.checkCommentsContent())return false;if(l.isSubmiting){l.showError("正在提交！");return}var m=e.trim(l.$ta.val());var v=m.replace(/^回复 @.*?[:：]/,"");var g=h?"":0;var y=l.$el.find(".verify_code_value").val();var _=l.$el.find(".verify_code_value").attr("key");t={app:"pc",objectId:c,objectType:f,content:v,source:a.globals.commentSource};if(d){t.commentId=d;if(0===g)t.flag=g;if(u)t.sourceCommentId=u}if(y){t.captchaCode=y;t.captchaKey=_}l.isSubmiting=true;var b=e("."+p+"FormContent .cont-imgitem ul li");l.picList=[];if(b.length>0){t.picUrl="";b.each(function(i){if(i<9){if(b.length-1==i)t.picUrl+=e(this).attr("data-src");else t.picUrl+=e(this).attr("data-src")+",";l.picList.push(JSON.parse(e(this).attr("data-arr")))}})}setTimeout(function(){l.isSubmiting=false},1e4);n.submit(t,function(i){l.isSubmiting=false;if(0==i.code){i.data=l.data;i.params=t;i.params.content=m;i.picList=l.picList;l.trigger("success",[i]);l.showError(o[0]);b.remove();e("."+p+"FormContent .form-textarea-picdom").removeClass("form-textarea-pic").find("textarea").css({height:"auto"});e("."+p+"FormContent .upload-el").css({left:"auto"});e("."+p+"FormContent .ui-upload-a").removeClass("ui-upload-ative")}else if(i.code==-6001);else{l.showError(o[i.code]||i.message);l.trigger("error",[]);return false}})},setVipGrade:function(e){var t=this;t.data=e},showError:function(e){var t=this.$el.find(".form-tooltip");t.find(".tips").html(e);t.show();setTimeout(function(){t.fadeOut()},2e3)}});return s});define("tui/countTextArea",["tui/event"],function(t){var i=/MSIE 9/i.test(navigator.userAgent);function n(e,t){var i=t.val();e.trigger("input",[i.length,parseInt(t.attr("data-maxlength"))])}var a=t.extend({initialize:function(t){var r=this;a.superClass.initialize.apply(r,arguments);if("string"==e.type(t))t=e(t);if(window.addEventListener){t.bind("input",function(){n(r,t)});if(i)t.bind("keydown cut paste",function(e){switch(e.type){case"keydown":if(46!=e.keyCode&&8!=e.keyCode)return;default:setTimeout(function(){n(r,t)},0)}})}else t.bind("propertychange",function(){n(r,t)})}});return a});define("tui/placeholder_dom",["tui/event"],function(t){var i=t.extend({initialize:function(t,n,a){var r=this;i.superClass.initialize.call(this);n=n||"";a=e.extend({left:4,top:2},a);var o=e(t);var s=e('<span class="ui-placeholder" data-role="placeholder">'+n+"</span>");s.css({position:"absolute",left:o[0].offsetLeft+a.left,top:o[0].offsetTop+a.top});o.parent().append(s);o.focus(function(){s.hide()}).blur(function(){if(""==o.val())s.show()});o.bind("input propertychange",function(){s[""==o.val()?"show":"hide"]()});s.click(function(e){o.focus()});s[""==o.val()?"show":"hide"]();r.input=o;r.txt=n;r.element=s},changeTxt:function(e){this.txt=e||"";this.element.text(this.txt)},getTxt:function(){return this.txt}});i.isSupport=function(){var e=document.createElement("input");return"placeholder"in e};return i});define("tui/autolinetextarea",["tui/event","tui/art"],function(t,i){var n=e.support.boxModel&&e.support.leadingWhitespace;var a=e("<div>");var r=t.extend({initialize:function(t,o,s){var l=this,d=o;r.superClass.initialize.apply(l,arguments);e(document.body).append(a);a.css({position:"absolute","white-space":"pre-wrap",top:0,left:"-99999em",width:t.width(),"font-family":t.css("font-family"),"line-height":t.css("line-height"),"font-size":t.css("font-size")});if(void 0===o)o=t.height();function u(e){a.html(i.helpers.$escape(t.val()).replace(/\n/g,"<br/>&nbsp;"));var n=a.height();if(t.parent().hasClass("form-textarea-pic"))o=168;else o=d;if(void 0!==o)n=Math.max(o,n);if(void 0!==s)n=Math.min(s,n);t.css("height",n)}if(window.addEventListener){t.bind("input",u);if(n)t.bind("keydown cut paste",u)}else t.bind("keydown contextmenu",u)}});return r});define("tui/edittextarea",["tui/class"],function(t){var i=t({initialize:function(t){if("string"==e.type(t))t=e(t);this.ta1=t},getCursor:function(){var e=this.ta1[0];if(!document.selection)return e.selectionStart;var t=document.selection.createRange(),i=document.body.createTextRange();i.moveToElementText(e);for(var n=0;i.compareEndPoints("StartToStart",t)<0;n++)i.moveStart("character",1);return n},getSelection:function(){var e=this.ta[0],t,i,n;if(!document.selection){t=e.selectionStart;i=e.selectionEnd;return{start:t,end:i,text:e.value.substring(t,i)}}var a=document.selection.createRange(),r=document.body.createTextRange();r.moveToElementText(e);n=a.text;if(!n)return{start:0,end:0,text:""};for(t=0;r.compareEndPoints("StartToStart",a)<0;t++)r.moveStart("character",1);return{start:t,end:t+n.length,text:n}},setCursor:function(e,t){var i=this.ta1[0];e=e||0;t=t||e;try{if(i.setSelectionRange){i.focus();i.setSelectionRange(e,t)}else if(i.createTextRange){range=i.createTextRange();range.collapse(true);range.moveEnd("character",t);range.moveStart("character",e);range.select()}}catch(n){}},insert:function(e,t){var i=this.ta1[0],n=this.ta1.val();t=void 0!==t?t:this.getCursor(i);if(void 0===t)t=n.length;i.focus();if(!document.selection){this.ta1.val(n.substr(0,t)+e+n.substr(t,n.length-t));this.setCursor(t+e.length)}else{var a=document.selection.createRange();a.text=e}}});return i});define("module/comment/v3/face",[],function(){var e={data_vip:{"万万表情":{"绑架":"w_bangjia","不赞同":"w_buzantong","呆怒":"w_dainu","呆左":"w_daizuo","呆右":"w_daiyou","导演":"w_daoyan","敌视":"w_dishi","嘟嘴":"w_duzui","富二代":"w_fuerdai","鼓掌":"w_guzhang","交叉腿":"w_jiaochatui","交叉腿右":"w_jiaochatuiyou","交叉腿左":"w_jiaochatuizuo","叫兽":"w_jiaoshou","抠鼻":"w_koubi","哭泣":"w_kuqi","拉链":"w_lalian","刘备":"w_liubei","没":"w_mei","牛逼":"w_niubi","闪剑":"w_shanjian","帅":"w_shuai","挑眉":"w_tiaomei","呕吐":"w_outu","吐舌头":"w_tushetou","悟空":"w_wukong","香蕉":"w_xiangjiao","笑":"w_xiao","疑惑":"w_yiwen","怨念":"w_yuannian","大赞":"w_dazan","主持人":"w_zhuchiren","紫金钵":"w_zijinbo"},"泡芙小姐":{"泡芙-拜托":"p_baituobaituo","泡芙-点赞":"p_dianzan","泡芙-翻白眼":"p_fanbaiyan","泡芙-飞吻":"p_feiwen","泡芙-尴尬":"p_ganga","泡芙-get":"p_get","泡芙-鬼脸":"p_guilian","泡芙-鼓掌":"p_guzhang","泡芙-好困":"p_haokun","泡芙-哼":"p_heng","泡芙-惊讶":"p_jingya","泡芙-哭笑不得":"p_kuxiaobude","泡芙-么么哒":"p_memeda","泡芙-ok":"p_ok","泡芙-呸":"p_pei","泡芙-生气":"p_shengqi","泡芙-挑眉毛":"p_tiaomeimao","泡芙-偷笑":"p_touxiao","泡芙-无聊":"p_wuliao","泡芙-想到点子":"p_xiangdaodianzi","泡芙-嫌弃":"p_xianqi","泡芙-喜欢你":"p_xihuani","泡芙-有鬼":"p_yougui","泡芙-约吗":"p_yuema"},"暴走漫画":{"暴走-阿布":"b_abu","暴走-呵呵":"b_hehe","暴走-把持不住":"b_bachibuzhu","暴走-暴走":"b_baozou","暴走-兵库北":"b_binkubei","暴走-呆":"b_dai","暴走-逗我":"b_douwo","暴走-额":"b_e","暴走-放弃治疗":"b_fangqizhiliao","暴走-感累不爱":"b_ganleibuai","暴走-孤独一生":"b_guduyisheng","暴走-寒":"b_han","暴走-基佬":"b_jilao","暴走-金馆长":"b_jinguanzhang","暴走-惊":"b_jing","暴走-毛腿肩上扛":"b_maotuijianshangkang","暴走-内牛满面":"b_neiniumanmian","暴走-怕怕":"b_papa","暴走-软妹纸":"b_ruanmeizhi","暴走-兔美":"b_tumei","暴走-膝盖中箭":"b_xigaizhongjian","暴走-笑cry":"b_xiaocry","暴走-斜看":"b_xiekan","暴走-熊孩纸":"b_xionghaizhi","暴走-熊吉":"b_xiongji","暴走-姚明":"b_yaoming","暴走-吔屎":"b_chishi","暴走-有点意思":"b_youdianyisi","暴走-赞":"b_zan","暴走-作死":"b_zuosi"}},data_normal:{"默认表情":{"赞":"o1","稀饭":"o2","愤怒":"o3","吐":"o4","无语":"o5","难过":"o6","汗":"o7","搞笑":"o8","牛":"o9","强":"o10"},"步步惊心":{"八爷暴怒":"bb_bybn","八爷呵呵":"bb_byhh","八爷泪流成河":"bb_byllch","八爷么么哒":"bb_bymmd","八爷什么鬼":"bb_bysmg","解树不哭":"bb_jsbk","解树发怒":"bb_jsfn","解树好尴尬":"bb_jshgg","解树花痴":"bb_jshc","解树震惊了":"bb_jszj","四爷发飙":"bb_syfb","四爷害羞了":"bb_syhxl","四爷黑线":"bb_syhx","四爷求抱抱":"bb_syqbb","四爷吻我":"bb_syww"},"终极一班":{"汪大东_放电":"zj_fangdian","汪大东_怒":"zj_nu","雷婷_女王":"zj_nvwang","雷婷_害羞":"zj_haixiu","裘球_机智":"zj_qiuqiu","裘球_萌萌哒":"zj_mmda","辜战_困":"zj_kun","辜战_逗我":"zj_douwo","止戈_花痴":"zj_huachi","止戈_疑惑":"zj_yihuo","金宝三_可怜":"zj_kelian","断肠人_兴奋":"zj_xingfen","执_扮鬼脸":"zj_zhi","流尘_汗":"zj_liucheng","太阳_嘿嘿嘿":"zj_taiyang"},"极限挑战":{"搞怪":"j_gaoguai","耍酷":"j_shuaku","神算子":"j_shensuanzi","么么哒":"j_memeda","笑cry":"j_xiaocry","财迷":"j_caimi","贱萌":"j_jianmeng","小猪卖萌":"j_maimeng","卖萌":"j_maimeng1","羞涩":"j_xiuse"},"琅琊榜":{"苏兄看不懂":"l_kanbudong","苏兄笑cry":"l_xiaocry","苏兄委屈":"l_weiqu","苏兄爱你":"l_aini","苏兄尴尬":"l_ganga","苏兄么么哒":"l_sumemeda","苏兄想静静":"l_xiangjingjing","苏兄拜拜":"l_baibai","飞流么么哒":"l_memeda","飞流不开心":"l_bukaixin","飞流路过":"l_luguo","飞流最酷":"l_zuiku","飞流呆呆":"l_daidai","飞流不哭":"l_buku","飞流吓死了":"l_xiasi"},"小丈夫":{"广场舞女王":"x_gcwnw","老爸不明白":"x_lbbmb","老妈嫌弃":"x_lmxq","甜甜拜拜":"x_ttbb","小贝撩妹":"x_xblm","小贝么么哒":"x_xbmmd","小山女王":"x_xsnw","姚澜不开心":"x_ylbkx","姚澜女神":"x_ylns","袁帅怕怕":"x_yspp"},"快捷回复":{}}};var t={};function i(e,t){var n=t||{};for(var a in e)if("object"!==typeof e[a])e[a]&&(n[a]=e[a]);else i(e[a],n);return n}t=i(e);return{showFace:function(e){var i=t;for(var n in i){var a=new RegExp("\\[("+n+")\\]","g");e=e.replace(a,function(e,t){return'<span class="gface gface_'+i[t]+'_show" title="'+t+'"></span>'})}return e},all:function(){return e}}});define("module/comment/v3/form",["tui/art","tui/cookie","module/comment/v3/face","tui/view","tui/edittextarea","tui/autolinetextarea","tui/placeholder_dom","tui/countTextArea","module/comment/v3/submit","module/comment/v3/model","module/comment/v3/gift","module/comment/v3/commentConfig","module/comment/v3/commentLogin"],function(t,i,n,a,r,o,s,l,d,u,c,f,p){var h=t.compile('<div class="comment-form <%if(isReply){%>comment-form-reply<%}%>">\n<%if(!isReply && userInfo){%>\n<div class="form-cell form-user-avatar">\n<a href="<%=userDomain%><%=userInfo.userCode%>" target="_blank">\n<img title="<%=userInfo.userName%>" src="//static.youku.com/user/img/avatar/50/55.jpg">\n</a>\n</div>\n<%}%>\n<div class="form-cell form-content <%=picUploadId%>FormContent">\n<div class="form-user-info">\n<%if(userInfo){%>\n<a href="<%=userDomain%><%=userInfo.userCode%>" target="_blank"><%=userInfo.userName%></a>\n<%}else{%>\n<a href="javascript:;" class="form-user-login" hzCharset="hz-4003764-1000494" charset="404-0-1">登录</a>\n<span>|</span>\n<a href="https://account.youku.com/register.htm" target="_blank">注册</a>\n<%}%>\n</div>\n<div class="form-wordlimit"><span class="form-wordlimit-input input-count">0</span><span class="form-wordlimit-upper">/300</span></div>\n<div class="form-textarea form-textarea-picdom">\n<textarea data-maxlength="300" name="content" <%if(!isReply){%>placeholder="看点槽点，不吐不快！别憋着，马上大声说出来吧！"<%}%> <%=getSpmConfig(!isReply ? \'commentboxclick\' : \'commentreplybox\')%> ></textarea>\n<%if(!isReply  && picUpload){%>\n<div class="cont-imgbox">\n<div class="cont-imgbox-box fix">\n<div class="cont-imgitem " id="<%=picUploadId%>imgitem">\n<ul class="fix"></ul>\n</div>\n<div class="cont-imgupload">\n<div class="upload_div handle">\n<span class="ui-upload-a"   id="<%=picUploadId%>1">\n+\n</span>\n</div>\n</div>\n</div>\n</div>\n<%}%>\n</div>\n<div class="form-toolbar">\n<div class="form-toolbar-right">\n<div class="form-tool form-action">\n<%if(isReply){%>\n<a href="javascript:;" class="form-btn form-btn-small form-btn-submit form-btn-blue" <%=getSpmConfig(\'commentreply\')%>>回复</a>\n<a href="javascript:;" class="form-btn form-btn-small form-btn-cancle">取消</a>\n<%} else {%>\n<a href="javascript:;" class="form-btn form-btn-large form-btn-submit" <%=getSpmConfig(\'commententerclick\')%> >发表评论</a>\n<%}%>\n</div>\n<div class="form-tooltip" style="display:none">\n<div class="com_overlay_con">\n<div class="tips"></div>\n</div>\n</div>\n</div>\n<div class="form-toolbar-left">\n<%if(false && isReply){%>\n<div class="tool">\n<input class="reply-repeat" type="checkbox" />\n<label style = "cursor: pointer;">回复并转发</label>\n</div>\n<%}%>\n<div class="form-tool faces-normal-tool"></div>\n<div class="form-tool faces-vip-tool"></div>\n<%if(!isReply && picUpload){%>\n<div class="form-tool pic_tool">\n<a href="javascript:;" id="<%=picUploadId%>0" class="ui-upload-a">\n<span class="upload-icon"></span>\n<span>图片</span>\n</a>\n<div id="<%=picUploadId%>queue"></div>\n</div>\n<%}%>\n</div>\n<div class="form-validate" style="display:none;">\n验证码: <input class="defaultext verify_code_value" type="text" name="verify_code_value" placeholder="输入右图的字符" />\n<img class="key verify_code_img"/>\n<span>看不清, <a class="change_verify_code" href="javascript:;">点此刷新</a></span>\n</div>\n</div>\n</div>\n</div>\n');
var m=t.compile('<a href="javascript:;" class="faces-btn" title="表情">\n<span class="faces-icon faces-icon-normal"></span><span>表情</span>\n</a>\n<div class="faces-content">\n<div class="insert_emoticon">\n<%for(var o in data){%>\n<div class="faces" data-id="<%=o%>" <%if(o !== init){%> style="display:none;"<%}%>>\n<div class="faces_con faces_con_<%=indexList.indexOf(o)%>">\n<%if(o =="快捷回复" && setrumors){%>\n<%for(var mors in setrumors){%>\n<p title="<%=setrumors[mors]%>"  data-test="<%=setrumors[mors]%>" data-stat-role="ck"><%=setrumors[mors]%></p>\n<%}%>\n<%}else{%>\n<% \nvar list = data[o];\nfor(var k in list){%>\n<a href="javascript:;" title="<%=k%>" data-test="<%=k%>" class="gface_<%=list[k]%>"><%if(list[k]){%><i></i><%}%></a>\n<%}%>\n<%}%>\n</div>\n</div>\n<%}%>\n<div class="emot_tab clearfix">\n<div class="switch_toobar">\n<% \nvar count = 0;\nfor( var item=0; item < indexList.length; item++){ count++\n%>\n<a href="javascript:;"  class="<%if(indexList[item] === init){%>tab_active<%}%>" style="<%if(indexList[item]===initnone){%>display:none;<%}%>" title="<%=indexList[item]%>">\n<i class="general_tab_<%=count%>"></i>\n<%if(indexList[item]==="快捷回复" && hasNew){%>\n<span class="chuda_qheader_spot chuda_qheader_spot_dis" style="top: 10px;right: 4px; display:block;"></span>\n<%}%>\n</a>\n<%}%>\n</div>\n<a class="next disabled"></a>\n<a class="pre disabled"></a>\n</div>\n</div>\n<iframe class="mask" frameborder="0" scrolling="no"></iframe>\n</div>');var v=t.compile('<a href="javascript:;" class="faces-btn" title="vip表情">\n<span class="faces-icon faces-icon-vip"></span><span>会员表情</span>\n</a>\n<div class="faces-content">\n<div class="vip_insert_emoticon">\n<%for(var o in data){%>\n<div class="faces" data-id="<%=o%>" <%if(o !== init){%> style="display:none;"<%}%> >\n<% if(!isVip){ %>\n<% var face = nonVip[o]; %>\n<% if(face){ %>\n<div class="non_vip">\n<div class="non_vip_wrap clearfix">\n<img src="<%=face.img%>" />\n<div>\n<p><%=face.name%>表情系列<span>（VIP会员专享）</span></p>\n<a href="//cps.youku.com/redirect.html?id=00014725" target="_blank" class="vip_btn">开通VIP会员</a>\n</div>\n</div>\n</div>\n<% } %>\n<% }else{ %>\n<div class="faces_title clearfix">\n<span><%=o%>（原创表情，动画系列）</span>\n<a href="//cps.youku.com/redirect.html?id=000145d1" target="_blank">续费会员</a>\n<em>优酷会员免费</em>\n</div>\n<div class="faces_con faces_con_<%=indexList.indexOf(o)%>">\n<% var list = data[o]; %>\n<% for(var k in list){ %>\n<a href="javascript:;" title="<%=k%>" class="gface_<%=list[k]%>"><i></i></a>\n<%}%>\n</div>\n<%}%>\n</div>\n<%}%>\n<div class="vip_emot_tab">\n<a class="pre disabled"></a>\n<div class="switch_toobar">\n<% var count = 0;%>\n<% for( var item in data){ %>\n<% count++ %>\n<a href="javascript:;" <%if(item === init){%>class="tab_active"<%}%> title="<%=item%>">\n<i class="vip_tab_<%=count%>"></i>\n</a>\n<%}%>\n</div>\n<a class="next disabled"></a>\n</div>\n</div>\n<iframe class="mask" frameborder="0" scrolling="no"></iframe>\n</div>');var g=t.compile("<%if(data.vipInfo && data.vipInfo.vipGrade){%>\n<%\nvar arrVipMMId = [ 0, 100004, 100002, 100006 ];\nvar arrVipCss = [ 'level-expired', 'level-lvip', 'level-vip', 'level-lvip'];\nvar arrVipName = [ '会员已过期', '优酷土豆白银会员：VIP', '优酷土豆黄金会员：VIP', '优酷土豆钻石会员：VIP'];\nvar curVipIndex = arrVipMMId.indexOf(data.vipInfo.mmid);\ncurVipIndex = curVipIndex < 0 ? 0 : curVipIndex;\nvar css = arrVipCss[curVipIndex] + data.vipInfo.vipGrade;\nvar txt = arrVipName[curVipIndex] + data.vipInfo.vipGrade;\nvar sty = data.vipInfo.icon ? ('background: url(' + data.vipInfo.icon + ') 0px 0px no-repeat;height: 22px;') : '';\n%>\n<a href=\"http://vip.youku.com/\" title=\"<%=txt%>\" target=\"_blank\"><span class=\"vip-level-icon <%=css%>\" style=\"<%=sty%>\"></span></a>\n<%}%>\n<a href=\"//lv.youku.com/page/grade/compare?uid=<%=data.userId%>\" target=\"_blank\" title=\"用户等级\" class=\"user-grade-icon user-grade-lv<%=data.userLevel%>\"></a>");var y={objectId:0,objectType:1,flag:1,commentId:0,sourceCommentId:0};var _;var b=[];var w=a.extend({initialize:function(t){var i=this;i.facesConfig=e.extend({},{rangeNode:null,align:"bottom left"},t.faces);i.isReply=t.isReply;i.parentSubmitArgs=e.extend({},y,t.submitArgs,{picUploadId:t.picUploadId});var n=p.getUserInfo();i.$el.html(h({userInfo:n,isReply:i.isReply,picUpload:f.check("picUpload"),picUploadId:t.picUploadId,userDomain:f.globals.userDomain,getSpmConfig:function(e){return f.getCommentTestSpmConfig(e,i.parentSubmitArgs.commentId)}}));i.$ta=i.$el.find("textarea");new o(i.$ta,81);if(!s.isSupport())new s(i.$ta,i.$ta.attr("placeholder"));i.limitTa=new l(i.$ta);i.modelEvents(i.limitTa,"ta");i.editTa=new r(i.$ta);i.submitForm=new d({el:i.$el,playmode:parseInt(f.globals.page.playmode)});i.modelEvents(i.submitForm,"submit");i.renderFace();i.setVipGrade();i.FormContent="."+t.picUploadId+"FormContent";if(f.check("picUpload")&&!i.isReply){if(b.length>0)if(b.indexOf(t.picUploadId)>=0)u.mupload({id:t.picUploadId,num:0});else if(b.indexOf("nopic")>=0)e(".comment-form .pic_tool",i.$el).remove();else i.picflag(t);else i.picflag(t);if(!n){e(i.FormContent+" .upload-el").css({left:"-1000px"});e(i.FormContent+" .ui-upload-a").addClass("ui-upload-ative")}}e(document.body).on("click",function(t){var n=e(t.target).closest(".form-toolbar");if(i.hasOpenFace&&!n.length)i.closeFace()});p.bind("login:after",function(t){if(!i.$el||i.$el.length<=0)return;if(!t)return;var n=e(".comment-form",i.$el);e(".form-user-info",n).html('<a href="'+f.globals.userDomain+t.userCode+'" target="_blank">'+t.userName+"</a>");if(!i.isReply)0==e(".form-user-avatar",n).length&&n.prepend('<div class="form-cell form-user-avatar"><a href="'+f.globals.userDomain+t.userCode+'" target="_blank"><img title="'+t.userName+'" src="'+t.avatarMiddle+'"></a></div>');i.uploadload();i.setVipGrade()})},uploadload:function(){var t=this;e(t.FormContent+" .upload-el").css({left:"auto"});e(t.FormContent+" .ui-upload-a").removeClass("ui-upload-ative")},picflag:function(e){u.mupload({id:e.picUploadId,num:0});return false},reset:function(e){this.parentSubmitArgs.objectId=e},setVipGrade:function(){var t=this;var i=p.getUserInfo();if(!i)return;t.submitForm.setVipGrade(i);if(!t.isReply){var n=e(".form-user-info",t.$el);n.find("a:gt(0)").remove();var a=n.html();n.html(a+g({data:i}));e(".form-user-avatar img",t.$el).attr("src",i.avatarMiddle)}if(i.userLevel>16||i.vipInfo&&i.vipInfo.mmid)t.renderFace(20)},events:{"click .switch_toobar a":"switchFace","click .faces-btn":"openFace","click .time_anchor":"timeAnchor","click .form-btn-submit":"formSubmit","click .faces_con a":"addFace2Ta","click .faces_con p":"addQuickreply","click .form-user-login":"loginRegGuide","click .change_verify_code":"changeVerifyCode","focus textarea":"changeVerifyCodeTime","click .form-btn-cancle":"remove","click .comment-atuser":"focus","mouseenter  .form-textarea-pic .img-item":"mouseePic","mouseleave  .form-textarea-pic .img-item":"mouselPic","click .form-textarea-pic .opacity-dom .pic-icon":"closePic"},mouseePic:function(t){var i=e(t.currentTarget);i.addClass("img-ctive")},mouselPic:function(t){var i=e(t.currentTarget);i.removeClass("img-ctive")},closePic:function(t){var i=e(t.currentTarget);var n=i.closest(".form-content");var a=i.closest(".cont-imgbox").find(".cont-imgitem ul li").length-1;if(a<=0)n.removeClass("form-textarea-pic");else if(a<9){n.find(".upload-el").css({left:"auto"});n.find(".ui-upload-a").removeClass("ui-upload-ative")}i.closest("li").remove()},focus:function(){this.$ta.focus()},renderFace:function(e,t){var a=this;var r=t||a.$el;var o=n.all();var s=["万万表情","泡芙小姐","暴走漫画"];var l=["默认表情","快捷回复","步步惊心","终极一班","琅琊榜"];var d=p.getUserInfo();var u={"万万表情":{name:"万万",img:"//r1.ykimg.com/05100000573C2D3067BC3D740E011788"},"泡芙小姐":{name:"泡芙",img:"//r1.ykimg.com/05100000573C2D3167BC3D3D0C0B5C07"},"暴走漫画":{name:"暴走",img:"//r1.ykimg.com/05100000573C2D3067BC3D7402025ABC"}};var c=d&&d.vipInfo&&d.vipInfo.mmid||e>16;a.isVipx=c;r.find(".faces-vip-tool").html(v({data:o.data_vip,nonVip:u,indexList:s,isVip:c,init:"万万表情"}));var f="快捷回复";var h=false;if(_){f="";h="3"!=i("chuda_qheader_spot_dis")}r.find(".faces-normal-tool").html(m({data:o.data_normal,hasNew:h,indexList:l,init:"默认表情",initnone:f,setrumors:_}))},remove:function(){this.trigger("remove:success",[]);this.undelegateEvents();this.unbind();this.$el.remove();this.$el=null},loginRegGuide:function(e){p.login(function(){if("function"==typeof e)e()})},changeVerifyCodeTime:function(e){var t=this;if(!t.VerifyCodeTime){t.VerifyCodeTime=true;setTimeout(function(){t.VerifyCodeTime=false},1e4);this.changeVerifyCode()}},changeVerifyCode:function(t){t&&t.preventDefault();var i=this;if(i.codeChecking)return;var n=p.isLogin();if(!n)return false;var a=i.$el.find(".verify_code_img");var r=i.$el.find(".verify_code_value");var o=i.$el.find(".form-validate");i.codeChecking=true;u.isNeedVerify({},function(t){r.val("");if("0"==t.code&&t.data){u.getVerifyCode({},function(e){if("0"==e.code){e.data=JSON.parse(e.data);r.attr("key",e.data.captchaKey);a.attr("src","data:image/jpeg;base64,"+e.data.captchaData)}});o.show();if(!s.isSupport()&&0==e(".ui-placeholder",o).length)new s(r,r.attr("placeholder"),{top:22})}else o.hide();i.codeChecking=false})},setRelyName:function(e){var t=this;var i='<div class="comment-atuser">'+e+"</div>";t.$el.find(".comment-atuser").remove();t.$el.find(".form-textarea").append(i);t.currentReply=e;t.$el.find(".input-count").html(0);t.$ta.val(e);t.setCursor(e.length,t.$ta)},setCursor:function(e,t){var i=t[0];e=e||0;var n=n||e;try{if(i.setSelectionRange){i.focus();i.setSelectionRange(e,n)}else if(i.createTextRange){var a=i.createTextRange();a.collapse(true);a.moveEnd("character",n);a.moveStart("character",e);a.select()}}catch(r){}},setArgs:function(t){this.submitArgs=e.extend({},this.parentSubmitArgs,t)},setface:function(){if(!f.check("quickreply"))return;var e=this;var t=f.globals.page;var i=[305355,310282,305135];var n=true;for(var a in i)if(i[a]==t.showid)n=false;if(n)return false;if(_){e.renderFace(e.isVipx?20:0);return}u.quickreply({vid:t.videoId,pid:t.showid,fid:t.folderId,uid:t.videoOwner,cid:t.catId},function(t){if("0"==t.code)if(t.data.rumors){_=t.data.rumors;e.renderFace(e.isVipx?20:0)}})},formSubmit:function(t){t.preventDefault();var i=this;i.closeFace();var n=i.submitArgs||i.parentSubmitArgs||{};if(i.isReply){n.flag=!e(t.currentTarget).closest(".form-toolbar").find(".reply-repeat").prop("checked");n.sourceCommentId=!n.flag?n.commentId:i.parentSubmitArgs.commentId}this.submitForm.commentNew(n)},"{submit} success":function(e){this.$ta.val("");this.find(".input-count").html(0);this.changeVerifyCode();this.submitArgs=null;this.$el.find(".comment-atuser").remove();this.trigger("submit:success",[e])},"{submit} error":function(e){this.trigger("submit:error",[e]);this.changeVerifyCode()},"{ta} input":function(t,i){var n=this;var a=n.$ta.val();var r=/^回复 @.*?:/;var o=r.exec(a);var s=o?o[0]:null;if(n.currentReply&&s!==n.currentReply){if(""!=a)n.$ta.val("");a="";n.$el.find(".comment-atuser").remove();n.currentReply=""}t=a.replace(r,"").replace(/(\r\n|\n|\r|\s)/g,"--").length;var l=e(".form-wordlimit .input-count",n.$el);l[t>i?"addClass":"removeClass"]("form-wordlimit-warning");l.html(t)},addFace2Ta:function(t){var i=e(t.currentTarget);var n="["+i.attr("title")+"]";this.editTa.insert(n);this.$ta.removeClass("defaultext");this.$ta.trigger("input")},addQuickreply:function(t){var n=e(t.currentTarget);var a=n.attr("title");this.editTa.insert(a);this.$ta.removeClass("defaultext");this.$ta.trigger("input");i("chuda_qheader_spot_dis",3,{expires:365});var r=n.closest(".dropmenu");r.find(".chuda_qheader_spot_dis").hide()},dropmenu:function(e){},closeFace:function(){this.$el&&this.$el.find(".faces-active").removeClass("faces-active").removeAttr("style").siblings(".faces-content").removeAttr("style");this.hasOpenFace=false},switchFace:function(t){var i=e(t.currentTarget);if(i.hasClass("tab_active"))return;var n=i.parents(".faces-content");var a=n.find(".faces");var r=n.find('[data-id="'+i.attr("title")+'"]');i.addClass("tab_active").siblings().removeClass("tab_active");a.hide();r.show()},openFace:function(t){var i=e(t.currentTarget);if(i.hasClass("faces-active")){this.closeFace();return}this.closeFace();this.hasOpenFace=true;var n=i.siblings(".faces-content");if(!n.length)return;i.addClass("faces-active");var a=i.outerHeight();var r=a-1.5;var o=this.facesConfig;var s={top:"top",bottom:"top",left:"left",right:"right"};var l={top:"bottom",bottom:"top",left:"right",right:"left"};var d=o.align.split(/\s+/);var u=o.rangeNode;if(u){var c=i.outerWidth();var f=n.outerWidth();var p=n.outerHeight();var h=i.offset();var m=h.top;var v=h.left;var g=u.offset();var y=g.top;var _=g.left;var b=u.width();var w=u.height();var k=m-y;var C=w-k-a;var T=v-_+c;var E=b-T+c;var x={top:p,bottom:p,left:f,right:f};var I={top:k,bottom:C,left:E,right:T};d.forEach(function(e,t){if(I[e]>x[e])return;if(I[l[e]]>x[l[e]])d[t]=l[e]})}var S={visibility:"visible"};S[l[d[0]]]=r;S[s[d[1]]]=0;n.css(S);i.css("border-"+d[0]+"-color","transparent")}});return w});define("module/comment/v3/commentPager",["tui/art","tui/view","tui/dialog","module/comment/v3/commentConfig"],function(t,i,n,a){var r=t.compile('<div class="comment-pager fix">\n<div class="comment-pager-state">\n第<span><%=currentPage%></span>页<%if(totalSize > 0){%>/共<span><%=totalPage%></span>页<%}%>\n</div>\n<ul class="comment-pager-turn">\n<li title="上一页">\n<%if(totalPage > 1 && currentPage > 1){%>\n<a data-page="<%=currentPage - 1%>" href="javascript:;">上一页</a>\n<%}else{%>\n<span>上一页</span>\n<%}%>\n</li>\n<li title="下一页">\n<%if(totalPage > 1 && totalPage > currentPage){%>\n<a data-page="<%=currentPage + 1%>" href="javascript:;" <%=getSpmConfig(\'nextpage\', currentPage + 1)%> >下一页</a>\n<%}else{%>\n<span>下一页</span>\n<%}%>\n</li>\n</ul>\n<ul class="comment-pager-page">\n<%\nvar start = currentPage - 4;\nvar end = currentPage + 5;\nif(start < 1){\nstart = 1;\n}\nif(end > totalPage){\nend = totalPage;\n}\n%>\n<%if(start > 1){%>\n<li><a data-page="1" href="javascript:;" <%=getSpmConfig(\'page\', 1)%> >1</a></li>\n<%}%>\n<%if(start - 1 > 1){%>\n<li>...</li>\n<%}%>\n<%for(var i = start; i <= end; i++){%>\n<%if(i == currentPage){%>\n<li><span><%=i%></span></li>\n<%}else{%>\n<li><a data-page="<%=i%>" href="javascript:;" <%=getSpmConfig(\'page\', i)%> ><%=i%></a></li>\n<%}%>\n<%}%>\n<%if(totalPage - end > 1){%>\n<li>...</li>\n<%}%>\n<%if(totalPage > end){%>\n<li><a data-page="<%=totalPage%>" href="javascript:;" <%=getSpmConfig(\'page\', totalPage)%> ><%=totalPage%></a></li>\n<%}%>\n</ul>\n</div>');var o=i.extend({initialize:function(){},events:{"click .comment-pager a":"changePage"},changePage:function(t){var i=this;var n=i.options.changePage;n&&n.call(i,e(t.currentTarget).data("page"));return false},render:function(t){return r(e.extend({currentPage:1,totalPage:10,totalSize:0,getSpmConfig:function(e,i){return a.getCommentTestSpmConfig(e,t.commentId+"_"+i,{num:i})}},t))}});return o});define("module/comment/v3/const",["module/comment/v3/face","module/comment/v3/commentConfig"],function(e,t){var i=Array.prototype.slice;var n="[0-9０-９]";var a="[0-5０-５]";var r="[:：]";var o="(?:分钟?)";var s=new RegExp(["("+n+"+"+o+")(?:("+a+"?"+n+")秒)?"+"(?:到|至)"+n+"+"+o+"(?:"+a+"?"+n+"秒)?","("+n+"+"+"(?:到|至))"+n+"+"+o+"(?:"+a+"?"+n+"秒)?","("+n+"+"+o+")("+a+"?"+n+")秒","("+n+"+"+o+")","("+n+"+)秒","("+n+"+"+r+")("+a+"?"+n+")(?!"+n+")"].join("|"),"g");var l={escapeHtml:function(e){var t={"&":"&#38;","<":"&#60;",">":"&#62;",'"':"&#34;","'":"&#39;","/":"&#47;"};var i=/&(?!#?\w+;)|<|>|"|'|\//g;return e?(e+"").replace(i,function(e){return t[e]||e}):e},face:function(t){return e.showFace(t)},url:function(e){return e.replace(/\[url\](.*?)\[\/url\]/gi,function(e,t){return t})},star:function(e,t){if(t)for(var i in t){var n=new RegExp(d(i),"g");e=e.replace(n,'<a href="'+t[i]+'" target="_blank">'+i+"</a>")}return e},at:function(e,i){if(i)for(var n in i)if("youku"!=n&&i[n])e=e.replace(new RegExp("@"+d(n),"g"),'<a href="'+t.globals.userDomain+i[n]+'" target="_blank">@'+n+"</a>");return e},removeRepeatAt:function(e,t){if(t&&t.userName){var i=new RegExp("回复 @"+d(t.userName)+" :s*","g");var n="回复 @"+t.userName+" :";if(!i.test(e))e=n+e;else e=e.replace(i,n);var a={};a[t.userName]=t.userCode;e=this.at(e,a)}return e},ht:function(e,t){if(t)for(var i in t)e=e.replace(new RegExp("#"+d(i)+"#","g"),'<a href="//gh.youku.com/topic_page/detail?id='+t[i]+'" target="_blank">#'+i+"#</a>");return e},timer:function(e){return e.replace(s,function(){var e=i.call(arguments);var t=0;e.slice(1,-2).forEach(function(e){e=(e||"").replace(/[\uff10-\uff19\uff1a]/g,function(e){return String.fromCharCode(e.charCodeAt(0)-65248)});t+=parseInt(e,10)*(/[到至分\:]/.test(e)?60:1)||0});return'<a title="点击从此时间点播放" href="#" class="seekTime" data-time="'+t+'">'+e[0]+"</a>"})},activityName:function(e,t){if(!e)return"";if(t)t='style="color:rgb('+(255&t>>16)+","+(255&t>>8)+","+(255&t)+');"';return'<span class="comment-user-activityname" '+(t||"")+">"+e+"_</span>"}};return l;function d(e){return String(e).replace(/[-[\]{}()*+?.,\\^$|#\s]/g,"\\$&")}});define("module/comment/v3/subcomment",["tui/art","tui/view","tui/util","module/comment/v3/const","module/comment/v3/model","module/comment/v3/form","module/comment/v3/utils","module/comment/v3/face","module/comment/v3/commentToolbar","module/comment/v3/commentPager","module/comment/v3/commentConfig"],function(t,i,n,a,r,o,s,l,d,u,c){var f=t.compile('<div class="comment-reply-container">\n<% var pagerHtml = data.totalPage > 1 ?\npager.render({ currentPage: data.currentPage, totalPage: data.totalPage, totalSize: data.totalSize, commentId: commentId }) :\n\'\';\n%>\n<%==pagerHtml%>\n<div class="comment-reply-list comment-list-box">\n<%if(data.replies.length > 0 ){%>\n<%data.replies.forEach(function(item,i){%>\n<div class="comment-item">\n<!--commentcon bg-->\n<div class="comment-content">\n<div class="comment-user-avatar">\n<a href="<%=userDomain%><%=item.user.userCode%>" target="_blank">\n<img class="img-small" _hz="" src="<%=item.user.avatarSmall%>">\n</a>\n</div>\n<div class="comment-section">\n<div class="comment-user-info">\n<a href="<%=userDomain%><%=item.user.userCode%>" target="_blank" class="<%if(item.user.userlevel && item.user.isVip){%>redname<%}%> " _hz="">\n<%==getActivityName(item.user.userActName, item.user.color)%><%=item.user.aliasName || item.user.userName%>\n</a>\n<%if(videoOwnerId == item.user.userId){%>\n<span class="comment-usertitle">频道主</span>\n<%}else if(suid==item.user.userId){%>\n<span class="comment-usertitle">楼主</span>\n<%}%>\n<%if(item.user.vipInfo){%>\n<%if(item.user.vipInfo.mmid=="100002"){%>\n<a href="http://vip.youku.com/" title="<%=item.user.vipInfo.name%>" target="_blank"><span class="vip-level-icon level-vip<%=item.user.vipInfo.vipGrade%>"  <%if(item.user.vipInfo.icon){%>style="background: url(<%=item.user.vipInfo.icon%>) 0px 0px no-repeat;height: 22px;"<%}%> ></span></a>\n<%}else if(item.user.vipInfo.mmid=="100004"){%>\n<a href="http://vip.youku.com/" title="<%=item.user.vipInfo.name%>" target="_blank"><span class="vip-level-icon level-lvip<%=item.user.vipInfo.vipGrade%>"  <%if(item.user.vipInfo.icon){%>style="background: url(<%=item.user.vipInfo.icon%>) 0px 0px no-repeat;height: 22px;"<%}%>></span></a>\n<%}else if(item.user.vipInfo.mmid=="100006"){%>\n<a href="http://vip.youku.com/" title="<%=item.user.vipInfo.name%>" target="_blank"><span class="vip-level-icon level-lvip<%=item.user.vipInfo.vipGrade%>" <%if(item.user.vipInfo.icon){%>style="background: url(<%=item.user.vipInfo.icon%>) 0px 0px no-repeat;height: 22px;"<%}%>></span></a>\n<%}%>\n<%}%>\n<%if(item.user.userLevel && item.user.userLevel>5){%>\n<a href="//lv.youku.com/page/grade/compare?uid=<%=item.user.userId%>" target="_blank" title="用户等级" class="user-grade-icon user-grade-lv<%=item.user.userLevel%>"></a>\n<%}%>\n<span class="comment-text"><%==textTransform(item.content,item)%></span>\n</div>\n</div>\n<%var toolbarHtml = !toolbar ? \'\' : toolbar.render({\nid: item.id,\nupCount: item.upCount,\ndownCount: item.downCount,\nuserId: item.user.userId,\nuserName: item.user.userName,\nshowSubReply: allowReply\n});%>\n<%==toolbarHtml%>\n<span class="comment-timestamp"><%=util.release(item.createTime)%></span>\n</div>\n<!--commentcon end-->\n</div>\n<%})%>\n<%}%>\n</div>\n<%==pagerHtml%>\n</div>');var p=t.compile('<%data.replies.forEach(function(item,i){%>\n<div class="comment-item">\n<!--commentcon bg-->\n<div class="comment-content">\n<div class="comment-user-avatar">\n<a href="<%=userDomain%><%=item.user.userCode%>" target="_blank">\n<img class="img-small" _hz="" src="<%=item.user.avatarSmall%>">\n</a>\n</div>\n<div class="comment-section">\n<div class="comment-user-info">\n<a href="<%=userDomain%><%=item.user.userCode%>" target="_blank" class="<%if(item.user.userlevel && item.user.isVip){%>redname<%}%> " _hz="">\n<%==getActivityName(item.user.userActName, item.user.color)%><%=item.user.aliasName || item.user.userName%>\n</a>\n<%if(videoOwnerId == item.user.userId){%>\n<span class="comment-usertitle">频道主</span>\n<%}else if(suid==item.user.userId){%>\n<span class="comment-usertitle">楼主</span>\n<%}%>\n<%if(item.user.vipInfo){%>\n<%if(item.user.vipInfo.mmid=="100002"){%>\n<a href="http://vip.youku.com/" title="<%=item.user.vipInfo.name%>" target="_blank"><span class="vip-level-icon level-vip<%=item.user.vipInfo.vipGrade%>"  <%if(item.user.vipInfo.icon){%>style="background: url(<%=item.user.vipInfo.icon%>) 0px 0px no-repeat;height: 22px;"<%}%> ></span></a>\n<%}else if(item.user.vipInfo.mmid=="100004"){%>\n<a href="http://vip.youku.com/" title="<%=item.user.vipInfo.name%>" target="_blank"><span class="vip-level-icon level-lvip<%=item.user.vipInfo.vipGrade%>"  <%if(item.user.vipInfo.icon){%>style="background: url(<%=item.user.vipInfo.icon%>) 0px 0px no-repeat;height: 22px;"<%}%>></span></a>\n<%}else if(item.user.vipInfo.mmid=="100006"){%>\n<a href="http://vip.youku.com/" title="<%=item.user.vipInfo.name%>" target="_blank"><span class="vip-level-icon level-lvip<%=item.user.vipInfo.vipGrade%>" <%if(item.user.vipInfo.icon){%>style="background: url(<%=item.user.vipInfo.icon%>) 0px 0px no-repeat;height: 22px;"<%}%>></span></a>\n<%}%>\n<%}%>\n<%if(item.user.userLevel && item.user.userLevel>5){%>\n<a href="//lv.youku.com/page/grade/compare?uid=<%=item.user.userId%>" target="_blank" title="用户等级" class="user-grade-icon user-grade-lv<%=item.user.userLevel%>"></a>\n<%}%>\n<span class="comment-text"><%==textTransform(item.content,item)%></span>\n</div>\n</div>\n<%var toolbarHtml = !toolbar ? \'\' : toolbar.render({\nid: item.id,\nupCount: item.upCount,\ndownCount: item.downCount,\nuserId: item.user.userId,\nuserName: item.user.userName,\nshowSubReply: allowReply\n});%>\n<%==toolbarHtml%>\n<span class="comment-timestamp"><%=util.release(item.createTime)%></span>\n</div>\n<!--commentcon end-->\n</div>\n<%})%>\n');var h=i.extend({initialize:function(e){this.sublist=[];this.parentModule=e.parentModule},clear:function(){this.sublist.forEach(function(e){e.remove()});this.sublist=[];return this},textTransform:function(e,t){var i=this;e=a.escapeHtml(e);e=a.removeRepeatAt(e,t.replyUser);c.check("text.star",function(){e=a.star(e,i.starLink)});c.check("text.at",function(){e=a.at(e,t.atUsers)});c.check("text.ht",function(){e=a.ht(e,t.topics)});e=a.timer(e);e=a.url(e);e=a.face(e);return e},render:function(t){var i=this;var r=e(t.el);if(e(".commnet-reply",r).length>0)return;var s='<div class="comment-reply fix"><div class="comment-form-container"></div></div>';var l=e(s).appendTo(r);var f=t.objectInfo.objectId;var h=t.objectInfo.objectType;var m;if(c.check("operate.reply")){m=new o({el:l.find(".comment-form-container"),isReply:true,submitArgs:{commentId:t.commentId,objectId:f,objectType:h},faces:{rangeNode:(i.parentModule||{parentModule:{}}).parentModule.$el}});m.bind("submit:success",function(t){if(0!=t.code)return;if(!t.data)return;e(".comment-reply-list",l).prepend(p({data:{replies:[{id:0,content:t.params.content,createTime:Date.now(),user:{userId:t.data.userId,userName:t.data.userName,aliasName:"我",avatarSmall:t.data.avatarMiddle,userlevel:{},isVip:true}}]},util:n,textTransform:i.textTransform.bind(i),userDomain:c.globals.userDomain,getActivityName:a.activityName})).find(".null").remove()});m.bind("remove:success",function(){l.remove()})}var v=new d({el:l,objectInfo:t.objectInfo,items:{showUp:true,showDown:true,showSubReply:true},commentReplySub:function(t){if(!m)return;var i=e(t.target);var n=i.data("id");var a="回复 @"+i.data("uname")+" :";m.setRelyName(a);m.setArgs({commentId:n})}});var g={app:"pc",commentId:t.commentId,objectId:f,objectType:h,currentPage:1,pageSize:10};var y=new u({el:l,changePage:function(e){g.currentPage=e;i.getSubCommentsContent(l,v,y,g,t.userId)}});y.changePage(1);i.sublist.push(l)},getSubCommentsContent:function(t,i,o,s,l){var d=this;d.trigger("load:before",[t]);r.replyList(s,function(r){if(0==r.code){var u=e(f({data:r.data,util:n,textTransform:d.textTransform.bind(d),toolbar:i,pager:o,suid:l,videoOwnerId:c.globals.page.videoOwner,allowReply:c.check("operate.reply"),userDomain:c.globals.userDomain,commentId:s.commentId,getActivityName:a.activityName}));var p=e(".comment-reply-container",t);if(p.length>0)p.replaceWith(u);else t.append(u);d.trigger("load:after",[t,r.data])}})}});return h});define("module/comment/v3/commentList",["tui/art","tui/view","tui/util","module/comment/v3/const","module/comment/v3/model","module/comment/v3/utils","module/comment/v3/commentImage","module/comment/v3/commentToolbar","module/comment/v3/subcomment","module/comment/v3/commentPager","module/comment/v3/commentConfig","module/comment/v3/commentLogin"],function(t,i,n,a,r,o,s,l,d,u,c,f){var p=t.compile('<%var pagerHtml= data.totalPage > 1 ? pager.render({currentPage:data.currentPage,totalPage:data.totalPage,totalSize:data.totalSize, commentId: 0}) : \'\';%>\n<div class="comment-pager-header">\n<%==pagerHtml%>\n</div>\n<%if(data.hot.length > 0 && data.currentPage == 1){%>\n<div class="comment-list-hot comment-list-box">\n<div class="comment-list-head">\n<h3 class="title">热门评论</h3>\n</div>\n<div class="comment-list-body">\n<%data.hot.forEach(function(item,i){%>\n<div class="comment-item" data-id="<%=item.id%>">\n<div class="comment-content">\n<div class="comment-user-avatar">\n<a href="<%=userDomain%><%=item.user.userCode%>" target="_blank"><img _hz="" src="<%=item.user.avatarMiddle%>"></a>\n</div>\n<div class="comment-section">\n<div class="comment-user-info">\n<a href="<%=userDomain%><%=item.user.userCode%>" class="<%if(item.user.vipInfo && [100002,100004,100006].indexOf(item.user.vipInfo.mmid) != -1){%>redname<%}%>" target="_blank">\n<%==getActivityName(item.user.userActName, item.user.color)%><%=item.user.aliasName || item.user.userName%>\n</a>\n<%if(videoOwnerId == item.user.userId){%>\n<span class="comment-usertitle">频道主</span>\n<%}%>\n<%if(item.user.vipInfo && [100002,100004,100006].indexOf(item.user.vipInfo.mmid) != -1){%>\n<a href="http://vip.youku.com/" title="<%=item.user.vipInfo.name%>" target="_blank">\n<span class="vip-level-icon" style="background: url(<%=item.user.vipInfo.icon%>);height: 22px;margin: 0;"></span>\n</a>\n<%}%>\n<%if(item.user.userLevel && item.user.userLevel>5){%>\n<a href="//lv.youku.com/page/grade/compare?uid=<%=item.user.userId%>" target="_blank" title="用户等级" class="user-grade-icon user-grade-lv<%=item.user.userLevel%>"></a>\n<%}%>\n<span class="comment-timestamp"><%=util.release(item.createTime)%></span>\n</div>\n<div class="comment-text">\n<p>\n<%if(item.flags && item.flags.isTop){%>\n<i class="comment-ico comment-ico-top"></i>\n<%}%>\n<%==textTransform(item.content, item)%>\n</p>\n<%if(item.parentComment && item.parentComment.content && item.parentComment.user){%>\n<p class="comment-source">\n<a href="<%=userDomain%><%=item.parentComment.user.userCode%>" target="_blank"  class="<%if(item.parentComment.isVip){%>redname<%}%>"><%=item.parentComment.user.userName%></a>:\n<%==textTransform(item.parentComment.content, item.parentComment)%>\n</p>\n<%}%>\n<%==commentImage.render({ picList: item.picList })%>\n</div>\n<% var toolbarHtml = !toolbar ? \'\' : toolbar.render({\nid: item.id,\nupCount: item.upCount, \ndownCount: item.downCount,\nreplyCount: item.replyCount,\nisTop: item.flags.isTop,\nuserId: item.user.userId, \nuserName: item.user.userName,\ncanDelete: userPermission.canDelete || loginUserInfo.yid == item.user.userId || loginUserInfo.userId == item.user.userId,\ncanSetTop: userPermission.canSetTop,\nshowReply: allowReply ? true : item.replyCount > 0\n})%>\n<%==toolbarHtml%>\n</div>\n<%if(item.flags && item.flags.isFame){%>\n<div class="starbg"></div>\n<%}%>\n</div>\n</div>\n<%});%>\n</div>\n</div>\n<%}%>\n<div class="comment-list-main comment-list-box">\n<div class="comment-list-head" <%if(data.currentPage != 1 || data.hot.length == 0){%>style="display:none;"<%}%>>\n<h3 class="title"><%=joinNewCommentTest ? \'大家都在聊\' : \'最新评论\'%></h3>\n</div>\n<div class="comment-list-body">\n<%if(data.comment.length>0){%>\n<%data.comment.forEach(function(item){%>\n<div class="comment-item" data-id="<%=item.id%>">\n<div class="comment-content">\n<div class="comment-user-avatar">\n<a href="<%=userDomain%><%=item.user.userCode%>" target="_blank"><img _hz="" src="<%=item.user.avatarMiddle%>"></a>\n</div>\n<div class="comment-section">\n<div class="comment-user-info">\n<a href="<%=userDomain%><%=item.user.userCode%>" class="<%if(item.user.vipInfo && [100002,100004,100006].indexOf(item.user.vipInfo.mmid) != -1){%>redname<%}%>" target="_blank">\n<%==getActivityName(item.user.userActName, item.user.color)%><%=item.user.aliasName || item.user.userName%>\n</a>\n<%if(videoOwnerId == item.user.userId){%>\n<span class="comment-usertitle">频道主</span>\n<%}%>\n<%if(item.user.vipInfo && [100002,100004,100006].indexOf(item.user.vipInfo.mmid) != -1){%>\n<a href="http://vip.youku.com/" title="<%=item.user.vipInfo.name%>" target="_blank">\n<span class="vip-level-icon" style="background: url(<%=item.user.vipInfo.icon%>);height: 22px;margin: 0;"></span>\n</a>\n<%}%>\n<%if(item.user.userLevel && item.user.userLevel>5){%>\n<a href="//lv.youku.com/page/grade/compare?uid=<%=item.user.userId%>" target="_blank" title="用户等级" class="user-grade-icon user-grade-lv<%=item.user.userLevel%>"></a>\n<%}%>\n<span class="comment-timestamp"><%=util.release(item.createTime)%></span>\n</div>\n<div class="comment-text">\n<p>\n<%if(item.flags && item.flags.isTop){%>\n<i class="comment-ico comment-ico-top"></i>\n<%}%>\n<%==textTransform(item.content, item)%>\n</p>\n<%if(item.parentComment && item.parentComment.content && item.parentComment.user){%>\n<p class="comment-source">\n<a href="<%=userDomain%><%=item.parentComment.user.userCode%>" target="_blank"  class="<%if(item.parentComment.isVip){%>redname<%}%>"><%=item.parentComment.user.userName%></a>:\n<%==textTransform(item.parentComment.content, item.parentComment)%>\n</p>\n<%}%>\n<%==commentImage.render({ picList: item.picList })%>\n</div>\n<% var toolbarHtml = !toolbar ? \'\' : toolbar.render({\nid: item.id,\nupCount: item.upCount, \ndownCount: item.downCount,\nreplyCount: item.replyCount,\nisTop: item.flags.isTop,\nuserId: item.user.userId, \nuserName: item.user.userName,\ncanDelete: userPermission.canDelete || loginUserInfo.yid == item.user.userId || loginUserInfo.userId == item.user.userId,\ncanSetTop: userPermission.canSetTop,\nshowReply: allowReply ? true : item.replyCount > 0\n})%>\n<%==toolbarHtml%>\n</div>\n<%if(item.flags && item.flags.isFame){%>\n<div class="starbg"></div>\n<%}%>\n</div>\n</div>\n<%});%>\n<%}else{%>\n<div class="comment-empty"><h3>暂无新评论～</h3></div>\n<%}%>\n</div>\n</div>\n<div class="comment-pager-footer">\n<%==pagerHtml%>\n</div>\n');var h=t.compile('<div class="comment-item" data-id="<%=item.id%>">\n<div class="comment-content">\n<div class="comment-user-avatar">\n<a href="<%=userDomain%><%=item.user.userCode%>" target="_blank"><img _hz="" src="<%=item.user.avatarMiddle%>"></a>\n</div>\n<div class="comment-section">\n<div class="comment-user-info">\n<a href="<%=userDomain%><%=item.user.userCode%>" class="<%if(item.user.vipInfo && [100002,100004,100006].indexOf(item.user.vipInfo.mmid) != -1){%>redname<%}%>" target="_blank">\n<%==getActivityName(item.user.userActName, item.user.color)%><%=item.user.aliasName || item.user.userName%>\n</a>\n<%if(videoOwnerId == item.user.userId){%>\n<span class="comment-usertitle">频道主</span>\n<%}%>\n<%if(item.user.vipInfo && [100002,100004,100006].indexOf(item.user.vipInfo.mmid) != -1){%>\n<a href="http://vip.youku.com/" title="<%=item.user.vipInfo.name%>" target="_blank">\n<span class="vip-level-icon" style="background: url(<%=item.user.vipInfo.icon%>);height: 22px;margin: 0;"></span>\n</a>\n<%}%>\n<%if(item.user.userLevel && item.user.userLevel>5){%>\n<a href="//lv.youku.com/page/grade/compare?uid=<%=item.user.userId%>" target="_blank" title="用户等级" class="user-grade-icon user-grade-lv<%=item.user.userLevel%>"></a>\n<%}%>\n<span class="comment-timestamp"><%=util.release(item.createTime)%></span>\n</div>\n<div class="comment-text">\n<p>\n<%if(item.flags && item.flags.isTop){%>\n<i class="comment-ico comment-ico-top"></i>\n<%}%>\n<%==textTransform(item.content, item)%>\n</p>\n<%if(item.parentComment && item.parentComment.content && item.parentComment.user){%>\n<p class="comment-source">\n<a href="<%=userDomain%><%=item.parentComment.user.userCode%>" target="_blank"  class="<%if(item.parentComment.isVip){%>redname<%}%>"><%=item.parentComment.user.userName%></a>:\n<%==textTransform(item.parentComment.content, item.parentComment)%>\n</p>\n<%}%>\n<%==commentImage.render({ picList: item.picList })%>\n</div>\n<% var toolbarHtml = !toolbar ? \'\' : toolbar.render({\nid: item.id,\nupCount: item.upCount, \ndownCount: item.downCount,\nreplyCount: item.replyCount,\nisTop: item.flags.isTop,\nuserId: item.user.userId, \nuserName: item.user.userName,\ncanDelete: userPermission.canDelete || loginUserInfo.yid == item.user.userId || loginUserInfo.userId == item.user.userId,\ncanSetTop: userPermission.canSetTop,\nshowReply: allowReply ? true : item.replyCount > 0\n})%>\n<%==toolbarHtml%>\n</div>\n<%if(item.flags && item.flags.isFame){%>\n<div class="starbg"></div>\n<%}%>\n</div>\n</div>\n');
var m=t.compile('\n<% var pagerHtml = data.totalPage > 1 ? \npager.render({ currentPage: data.currentPage, totalPage: data.totalPage, totalSize: data.totalSize }) :\n\'\';\n%>\n<%==pagerHtml%>\n<div class="comment-list-box">\n<div class="comment-list-head comment-myreply-tab">\n<a data-usertype="myComment" class="<%if(userType==\'myComment\'){%> active<%}%>">我收到的评论回复<%if(myComment){%>(<%=myComment%>)<%}%></a>\n<a data-usertype="myVideoComment" class="<%if(userType==\'myVideoComment\'){%> active<%}%>">我收到的视频评论<%if(myVideoComment){%>(<%=myVideoComment%>)<%}%></a>\n</div>\n<%if(data.userComment.length>0){%>\n<!--body begin-->\n<div class="comment-list-body">\n<%data.userComment.forEach(function(item,i){%>\n<!--一条回复内容 begin-->	\n<div class="comment-item">\n<div class="comment-content">\n<div class="comment-user-avatar">\n<a href="<%=userDomain%><%=item.user.userCode%>" target="_blank"><img _hz="" src="<%=item.user.avatarMiddle%>"></a>\n</div>\n<div class="comment-section">\n<div class="comment-user-info">\n<a href="<%=userDomain%><%=item.user.userCode%>" class="<%if(item.user.vipInfo && [100002,100004,100006].indexOf(item.user.vipInfo.mmid) != -1){%>redname<%}%>" target="_blank"><%=item.user.userName%></a>\n<%if(item.user.vipInfo){%>\n<%if(item.user.vipInfo.mmid=="100002"){%>\n<a href="http://vip.youku.com/" title="<%=item.user.vipInfo.name%>" target="_blank"><span  <%if(item.user.vipInfo.icon){%>style="background: url(<%=item.user.vipInfo.icon%>) 0px 0px no-repeat;height: 22px;"<%}%> class="vip-level-icon level-vip<%=item.user.vipInfo.vipGrade%>"></span></a>\n<%}else if(item.user.vipInfo.mmid=="100004"){%>\n<a href="http://vip.youku.com/" title="<%=item.user.vipInfo.name%>" target="_blank"><span  <%if(item.user.vipInfo.icon){%>style="background: url(<%=item.user.vipInfo.icon%>) 0px 0px no-repeat;height: 22px;"<%}%> class="vip-level-icon level-lvip<%=item.user.vipInfo.vipGrade%>"></span></a>\n<%}else if(item.user.vipInfo.mmid=="100006"){%>\n<a href="http://vip.youku.com/" title="<%=item.user.vipInfo.name%>" target="_blank"><span <%if(item.user.vipInfo.icon){%>style="background: url(<%=item.user.vipInfo.icon%>) 0px 0px no-repeat;height: 22px;"<%}%> class="vip-level-icon level-vip<%=item.user.vipInfo.vipGrade%>" ></span></a>\n<%}%>\n<%}%>\n<%if(item.user.userLevel && item.user.userLevel>5){%>\n<a href="//lv.youku.com/page/grade/compare?uid=<%=item.user.userId%>" target="_blank" title="用户等级" class="user-grade-icon user-grade-lv<%=item.user.userLevel%>"></a>\n<%}%>\n<span class="comment-timestamp"><%=util.release(item.createTime)%> </span>\n</div>\n<div class="comment-text">\n<p>\n<%==textTransform(item.content, item)%>\n</p>\n</div>\n<div class="comment-section comment-myreply">\n<div class="comment-text">\n<%if(item.parentComment){%>\n我的评论：<%==textTransform(item.parentComment.content, item)%>\n<%}%>\n</div>\n<div class="comment-myreply-source">\n<%if(item.videoInfo && item.videoInfo.thumburl){%>\n<a class="source-video-img" href="//v.youku.com/v_show/id_<%=item.videoInfo.videoId%>"><img src="<%=item.videoInfo.thumburl%>" alt="视频截图"></a>\n<%if(item.videoInfo.videoId){%>\n<p class="source-video-name">来自视频：<a href="//v.youku.com/v_show/id_<%=item.videoInfo.videoId%>"><%=item.videoInfo.title%></a></p>\n<%}%>\n<%}%>\n</div>\n</div>\n</div>\n</div>\n</div>\n<!--一条回复内容 end-->\n<%});%>\n</div>\n<!--body end-->\n<%}else{%>\n<div class="comment-empty"><h3>暂无评论～</h3></div>\n<%}%>\n</div>\n<%==pagerHtml%>\n');var v=t.compile('\n<% var pagerHtml = data.totalPage > 1 ? \npager.render({ currentPage: data.page, totalPage: data.totalPage, totalSize: data.pageResult.totalSize }) :\n\'\';\n%>\n<%==pagerHtml%>\n<%if(data.pageResult.data){%>\n<div class="comment-list-box">\n<div class="comment-list-body comment-list-db">\n<%data.pageResult.data.forEach(function(item,i){%>\n<%if(i < data.lastpagenumber){%>\n<div class="comment-item <%if(item.islastone){%>comment_last<%}%>">\n<div class="comment-user-info">\n<a href="<%=item.author.alt%>" target="_blank"><%=item.author.name%></a>\n<label><i class="comment-ico comment-ico-db"></i></label>\n</div>\n<div class="comment-text"><%=item.content%></div>\n<div class="panel"><span class="comment-timestamp"><%=item.created_at%></span></div>\n</div>\n<%}%>\n<%});%>\n<%if(data.cometoDouBanUrl){%>\n<div class="more"><a href="<%=data.cometoDouBanUrl%>" target = "_blank">去豆瓣查看更多</a></div>\n<%}%>\n</div>\n</div>\n<%}else{%>\n<div class="comment-empty"><h3>暂无豆瓣评论～</h3></div>\n<%}%>\n<%==pagerHtml%>\n');var g={2:"myComment",4:"myVideoComment"};var y=i.extend({initialize:function(t){var i=this;i.parentModule=t.parentModule;i.scroll=e.extend({container:"html,body",scrollTop:function(e){return e.offset().top}},t.scroll);i.objectInfo=t.objectInfo;i.userPermission=t.userPermission;i.pager=new u({el:i.$el,changePage:function(e){i.loadParam.currentPage=e;i.load(i.loadParam,"changePage")}});i.commentImage=new s({el:i.$el});var n=new d({parentModule:i});n.bind("load:before",function(t){if(!c.check("commentOpen"))e(i.scroll.container).animate({scrollTop:i.scroll.scrollTop(t.closest(".comment-item"))},500)});i.toolbar=new l({el:i.$el,objectInfo:i.objectInfo,items:{showUp:true,showDown:true,showReply:true,showDelete:true,showSetTop:true,showInform:false},commentReply:function(t){n.starLink=i.starLink;var a=e(t.target);var r=a.closest(".comment-item");var o=e(".comment-reply",r).length>0;n.clear();if(!o)n.render({el:r,objectInfo:i.objectInfo,commentId:a.data("id"),userId:a.data("uid")});return false},commentDeleteCallback:function(e){i.removeItem(e)},commentTopCallback:function(){i.loadParam.currentPage=1;i.load(i.loadParam,"setTop")}});f.bind("login:after",function(e){i.updateDiffItem()})},events:{"click .comment-empty a":"refresh","click a.seekTime":"seekTime","click .comment-myreply-tab a":"changeMyReply"},seekTime:function(t){if(t&&t.preventDefault){t.preventDefault();t=e(t.currentTarget).data("time")}t=parseInt(t);if(t&&window.ykPlyr&&e.isFunction(window.ykPlyr.PlayerSeek)){window.ykPlyr.PlayerSeek(t);window.scroll(0,0)}},refresh:function(){this.load(this.loadParam)},textTransform:function(e,t){var i=this;e=a.escapeHtml(e);c.check("text.star",function(){e=a.star(e,i.starLink)});c.check("text.at",function(){e=a.at(e,t.atUsers)});c.check("text.ht",function(){e=a.ht(e,t.topics)});e=a.timer(e);e=a.url(e);e=a.face(e);return e},load:function(e,t,i){var n=this;n.loadParam=e;n.trigger("load:before",[e.currentPage,e.listType,t]);n.$el.html('<div class="comment-empty comment-loading"></div>');if("db"==e.listType){n.dataComments=null;n.loadDbComment(e,t);return}if("mycomment"==e.listType){n.dataComments=null;n.loadMyComment(e,t);return}n.loadComment(e,t,i)},loadComment:function(e,t,i){var o=this;if("0"==o.objectInfo.objectId||""==o.objectInfo.objectId)return false;r.commentList({app:"pc",objectId:o.objectInfo.objectId,objectType:o.objectInfo.objectType,listType:e.listType||0,currentPage:e.currentPage||1,pageSize:e.pageSize||30},function(r,s){if(0!=r.code){o.$el.html('<div class="comment-empty">似乎出问题了,点击<a href="javascript:;">刷新</a>一下看看吧~</div>');return}if(!c.check("text.hotComment"))r.data&&(r.data.hot=[]);if(!c.check("commentOpen")&&c.isJoinCommentTest()){if("init"==t)window.goldlog&&window.goldlog.record("/yt/ykcomment.play.commentNewAlgorithm","EXP","type=init_"+(s?"new":"old")+"&showid="+c.globals.page.showid+"&videocode="+c.globals.page.videoId2,"H1512895196");r.data.hot=[].concat(r.data.hot).filter(function(e){return e&&e.flags&&e.flags.isTop})}o.dataComments=r.data;o.$el.html(p({data:r.data,util:n,textTransform:o.textTransform.bind(o),videoOwnerId:c.globals.page.videoOwner,loginUserInfo:f.getUserInfo()||{},userPermission:o.userPermission,commentImage:o.commentImage,toolbar:o.toolbar,pager:o.pager,allowReply:c.check("operate.reply"),userDomain:c.globals.userDomain,joinNewCommentTest:1==c.isJoinCommentTest(),getActivityName:a.activityName}));i&&i();o.trigger("load:after",[r.data,e.listType,t])})},loadDbComment:function(e,t){var i=this;r.getDbComment({app:"pc",page:e.currentPage,videoId:i.objectInfo.objectId,showId:c.globals.page.showid},function(e){if(0!=e.code){i.$el.html('<div class="comment-empty">似乎出问题了,点击<a href="javascript:;">刷新</a>一下看看吧~</div>');return}i.$el.html(v({data:e.data.con,util:n,textTransform:i.textTransform.bind(i),pager:i.pager}));i.trigger("load:after",[e.data.con,"db",t])})},loadMyComment:function(e,t){var i=this;var a={app:"pc",userType:e.userType||2,currentPage:e.currentPage||1,pageSize:e.pageSize||30};r.getUserComment(a,function(e){if(0!=e.code){i.$el.html('<div class="comment-empty">似乎出问题了,点击<a href="javascript:;">刷新</a>一下看看吧~</div>');return false}var r=g[a.userType];if(1==a.currentPage)if("myComment"==r)i.myCommentNum=e.data.totalSize;else if("myVideoComment"==r)i.myVideoCommentNum=e.data.totalSize;i.$el.html(m({data:e.data,util:n,textTransform:i.textTransform.bind(i),userType:r,myComment:i.myCommentNum,myVideoComment:i.myVideoCommentNum,pager:i.pager,userDomain:c.globals.userDomain}));i.trigger("load:after",[e.data,"mycomment",t])})},changeMyReply:function(t){var i=this;var n=e(t.currentTarget);var a=n.data("usertype");for(var r in g)if(a==g[r]){a=r;break}i.loadParam.userType=a;i.loadParam.currentPage=1;i.load(i.loadParam)},removeItem:function(t){var i=this;e('[data-id="'+t+'"]',i.$el).remove();var n=e(".comment-list-main .comment-list-body",i.$el);if(0===n.children().length)n.append('<div class="comment-empty"><h3>暂无新评论～</h3></div>')},add:function(t){var i=this;i.$el.find(".comment-list-main .comment-list-body").prepend(h({item:{user:{aliasName:"我",userId:-1,userName:t.userName,avatarMiddle:t.userImage},picList:t.picList,content:t.content,createTime:Date.now()},util:n,textTransform:i.textTransform.bind(i),commentImage:i.commentImage,userDomain:c.globals.userDomain,getActivityName:a.activityName}));i.trigger("add:after",[]);e(".comment-empty",i.$el).remove()},scrollTop:function(t){var i=this;var n=i.$el;if(2==t&&0==(n=e(".comment-list-main",i.$el)).length)n=i.$el;if(3==t&&0==(n=e(".comment-list-hot",i.$el)).length)n=i.$el;e(i.scroll.container).animate({scrollTop:i.scroll.scrollTop(n)},500)},updateDiffItem:function(){var t=this;if(!t.dataComments)return;var i=f.getUserInfo();var n=t.dataComments.comment.concat(t.dataComments.hot).filter(function(e){return e.user.userId==i.userId||e.user.userId==i.yid||t.userPermission.canDelete||t.userPermission.canSetTop});n.forEach(function(n){var a=e('.comment-item[data-id="'+n.id+'"] > .comment-content .comment-handle',t.$el);var r=t.toolbar.render({id:n.id,upCount:n.upCount,downCount:n.downCount,replyCount:n.replyCount,isTop:n.flags.isTop,userId:n.user.userId,userName:n.user.userName,canDelete:t.userPermission.canDelete||n.user.userId==i.userId||n.user.userId==i.yid,canSetTop:t.userPermission.canSetTop,showReply:c.check("operate.reply")?true:n.replyCount>0});if(a.html()!=e(r).html())a.replaceWith(r)})}});return y});define("tui/popup",[],function(){var t=!("minWidth"in e("html")[0].style);var i=!t;function n(){this.destroyed=false;this.__popup=e("<div />").css({display:"none",position:"absolute",outline:0}).attr("tabindex","-1").html(this.innerHTML).appendTo("body");this.__backdrop=this.__mask=e("<div />").css({opacity:.7,background:"#000"}).append(e("<iframe />").attr("frameborder",0).css({position:"absolute",top:0,left:0,width:"100%",height:"100%",background:"#000",opacity:0}));this.node=this.__popup[0];this.backdrop=this.__backdrop[0]}e.extend(n.prototype,{node:null,backdrop:null,fixed:false,destroyed:true,open:false,returnValue:"",autofocus:true,align:"bottom left",innerHTML:"",className:"ui-popup",setHtml:function(e){var t=this.__popup;if(t)t.html(e);return this},show:function(a){if(this.destroyed)return this;var r=this.__popup;var o=this.__backdrop;this.__activeElement=this.__getActive();this.open=true;this.follow=a||this.follow;if(!this.__ready){r.addClass(this.className).attr("role",this.modal?"alertdialog":"dialog").css("position",this.fixed?"fixed":"absolute");if(!t)e(window).on("resize",e.proxy(this.reset,this));if(this.modal){var s={position:"fixed",left:0,top:0,width:"100%",height:"100%",overflow:"hidden",userSelect:"none",zIndex:this.zIndex||n.zIndex};r.addClass(this.className+"-modal");if(!i)e.extend(s,{position:"absolute",width:e(window).width()+"px",height:e(document).height()+"px"});o.css(s).attr({tabindex:"0"}).on("focus",e.proxy(this.focus,this));this.__mask=o.clone(true).attr("style","").insertAfter(r);o.addClass(this.className+"-backdrop").insertBefore(r);this.__ready=true}if(!r.html())r.html(this.innerHTML)}r.addClass(this.className+"-show").show();o.show();this.reset().focus();this.__dispatchEvent("show");return this},showModal:function(){this.modal=true;return this.show.apply(this,arguments)},close:function(e){if(!this.destroyed&&this.open){if(void 0!==e)this.returnValue=e;this.__popup.hide().removeClass(this.className+"-show");this.__backdrop.hide();this.open=false;this.blur();this.__dispatchEvent("close")}return this},remove:function(){if(this.destroyed)return this;this.__dispatchEvent("beforeremove");if(n.current===this)n.current=null;this.__popup.remove();this.__backdrop.remove();this.__mask.remove();if(!t)e(window).off("resize",this.reset);this.__dispatchEvent("remove");for(var i in this)delete this[i];return this},reset:function(){var e=this.follow;if(e)this.__follow(e);else this.__center();this.__dispatchEvent("reset");return this},focus:function(){var t=this.node;var i=this.__popup;var a=n.current;var r=this.zIndex=n.zIndex++;if(a&&a!==this)a.blur(false);if(!e.contains(t,this.__getActive())){var o=i.find("[autofocus]")[0];if(!this._autofocus&&o)this._autofocus=true;else o=t;this.__focus(o)}i.css("zIndex",r);n.current=this;i.addClass(this.className+"-focus");this.__dispatchEvent("focus");return this},blur:function(){var e=this.__activeElement;var t=arguments[0];if(false!==t)this.__focus(e);this._autofocus=false;this.__popup.removeClass(this.className+"-focus");this.__dispatchEvent("blur");return this},addEventListener:function(e,t){this.__getEventListener(e).push(t);return this},removeEventListener:function(e,t){var i=this.__getEventListener(e);for(var n=0;n<i.length;n++)if(t===i[n])i.splice(n--,1);return this},__getEventListener:function(e){var t=this.__listener;if(!t)t=this.__listener={};if(!t[e])t[e]=[];return t[e]},__dispatchEvent:function(e){var t=this.__getEventListener(e);if(this["on"+e])this["on"+e]();for(var i=0;i<t.length;i++)t[i].call(this)},__focus:function(e){try{if(this.autofocus&&!/^iframe$/i.test(e.nodeName))e.focus()}catch(t){}},__getActive:function(){try{var e=document.activeElement;var t=e.contentDocument;var i=t&&t.activeElement||e;return i}catch(n){}},__center:function(){var t=this.__popup;var i=e(window);var n=e(document);var a=this.fixed;var r=a?0:n.scrollLeft();var o=a?0:n.scrollTop();var s=i.width();var l=i.height();var d=t.width();var u=t.height();var c=(s-d)/2+r;var f=382*(l-u)/1e3+o;var p=t[0].style;p.left=Math.max(parseInt(c),r)+"px";p.top=Math.max(parseInt(f),o)+"px"},__follow:function(t){var i=t.parentNode&&e(t);var n=this.__popup;if(this.__followSkin)n.removeClass(this.__followSkin);if(i){var a=i.offset();if(a.left*a.top<0)return this.__center()}var r=this;var o=this.fixed;var s=e(window);var l=e(document);var d=e(this.rangeNode);var u=0;var c=0;var f=0;var p=0;var h=d.offset();if(h){u=h.left;c=h.top;p=d.width();f=d.height()}var m=s.width();var v=s.height();var g=l.scrollLeft();var y=l.scrollTop();var _=n.width();var b=n.height();var w=i?i.outerWidth():0;var k=i?i.outerHeight():0;var C=this.__offset(t);var T=C.left;var E=C.top;var x=o?T-g:T;var I=o?E-y:E;var S=v+y;var A=f+c;var P=m+g;var L=p+u;var D=o?0:g>u?g:u;var R=o?0:y>c?y:c;var O=D-_+(P>L?u<g?L-g:p:u>g?P-u:m);var M=R-b+(S>A?c<y?A-y:f:c>y?S-c:v);var N={};var j=this.align.split(" ");var U=this.className+"-";var F={top:"bottom",bottom:"top",left:"right",right:"left"};var $={top:"top",bottom:"top",left:"left",right:"left"};var z=[{top:I-b,bottom:I+k,left:x-_,right:x+w},{top:I,bottom:I-b+k,left:x,right:x-_+w}];var V={left:x+w/2-_/2,top:I+k/2-b/2};var B={left:[D,O],top:[R,M]};e.each(j,function(e,t){if(z[e][t]>B[$[t]][1])t=j[e]=F[t];if(z[e][t]<B[$[t]][0])j[e]=F[t]});if(!j[1]){$[j[1]]="left"===$[j[0]]?"top":"left";z[1][j[1]]=V[$[j[1]]]}U+=j.join("-")+" "+this.className+"-follow";r.__followSkin=U;if(i)n.addClass(U);N[$[j[0]]]=parseInt(z[0][j[0]]);N[$[j[1]]]=parseInt(z[1][j[1]]);n.css(N)},__offset:function(t){var i=t.parentNode;var n=i?e(t).offset():{left:t.pageX,top:t.pageY};t=i?t:t.target;var a=t.ownerDocument;var r=a.defaultView||a.parentWindow;if(r==window)return n;var o=r.frameElement;var s=e(a);var l=s.scrollLeft();var d=s.scrollTop();var u=e(o).offset();var c=u.left;var f=u.top;return{left:n.left+c-l,top:n.top+f-d}}});n.zIndex=1024;n.current=null;return n});define("module/comment/v3/postsContent",["tui/art","tui/view","tui/popup","tui/dialog","module/comment/v3/model","module/comment/v3/commentToolbar","module/comment/v3/commentList","module/comment/v3/form","module/comment/v3/utils","module/comment/v3/commentConfig","module/comment/v3/commentLogin"],function(t,i,n,a,r,o,s,l,d,u,c){n.zIndex=2e4;var f=t.compile('<div class="posts-content">\n<div class="posts-item">\n<div class="posts-title">\n<%=data.title%>\n</div>\n<div class="posts-userinfo posts-spacing">\n<a href="<%=userDomain%><%=data.user.userCode%>" class="<%if(data.user.vipInfo && [100002,100004,100006].indexOf(data.user.vipInfo.mmid) != -1){%>redname<%}%>" target="_blank"><%=data.user.userName%></a>\n<span class="posts-usertitle"><%=videoOwnerId == data.user.userId ? \'频道主\' : \'楼主\'%></span>\n<%if(data.user.vipInfo && [100002,100004,100006].indexOf(data.user.vipInfo.mmid) != -1){%>\n<a href="http://vip.youku.com/" title="<%=data.user.vipInfo.name%>" target="_blank">\n<span class="vip-level-icon" style="background: url(<%=data.user.vipInfo.icon%>);height: 22px;margin: 0;"></span>\n</a>\n<%}%>\n<%if(data.user.userLevel && data.user.userLevel>5){%>\n<a href="http://lv.youku.com/page/grade/compare?uid=<%=data.user.userId%>" target="_blank" title="用户等级" class="user-grade-icon user-grade-lv<%=data.user.userLevel%>"></a>\n<%}%>\n<span class="posts-timestamp"><%=data.createTimeFormat.replace(\'发表于\',\'\')%></span>\n</div>\n<div class="posts-text">\n<%==escapePostsHtml(data.content)%>\n</div>\n<div class="posts-handle fix">\n<div class="posts-share" style="display:none;">\n<span class="posts-share-title">分享</span>\n<a href="javascript:;" class="posts-share-btn icon-weixin"></a>\n<a href="javascript:;" class="posts-share-btn icon-weibo"></a>\n<a href="javascript:;" class="posts-share-btn icon-qzone"></a>\n<a href="javascript:;" class="posts-share-btn icon-qq"></a>\n</div>\n<% var toolbarHtml = toolbar.render({ \nid: data.postId,\nupCount: data.upCount, \ndownCount: data.downCount,\nreplyCount: data.commentCount, \nuserId: data.user.userId,\nuserName: data.user.userName,\n})%>\n<%==toolbarHtml%>\n</div>\n</div>\n<div class="posts-comment">\n<div class="posts-comment-form"></div>\n<div class="posts-comment-list"></div>\n</div>\n</div>');var p=i.extend({initialize:function(e){var t=this;t.objectInfo=e.objectInfo;t.param=e||{};t.initCommon()},scrollForm:function(){var e=this;var t=e.form;if(!t)return;var i=e.$el;i.scrollTop(i.scrollTop()+t.$el.get(0).getBoundingClientRect().top);t.focus()},eventsPopup:{"click .posts-content-popup-close":function(){this.popup&&this.popup.remove()}},eventsPage:{},initPage:function(){this.$el.html('<div class="posts-cotent-loading">')},remove:function(){self.popup&&self.popup.remove();self.form&&self.form.remove();self.form=null;self.popup=null;self.$el=null},togglePlay:function(t,i){e("html,body").css({overflow:t?"":"hidden"});var n=window.ykPlyr;if(n&&e.isFunction(n.PlayerPause))n.PlayerPause(i)},initPopup:function(){var t=this;var i=new n;i.clickbackdropclose=true;i.fixed=true;i.className="posts-content-popup";i.setHtml('<div class="posts-content-popup-body"><a class="iconfont posts-content-popup-close"></a><div class="posts-cotent-loading"></div></div>');var a=document.getElementById("movie_player");var r;i.onshow=function(){if(a&&a.isPause)r=a.isPause();t.togglePlay(false,true)};i.onremove=function(){t.togglePlay(true,void 0==r?false:r);t.remove()};t.popup=i;t.events=t.eventsPopup;t.setElement(e(".posts-content-popup-body",e(i.node)),true);e(i.node).on("click",function(e){if(e.target===e.currentTarget)i&&i.remove()});i.showModal()},initCommon:function(){var e=this;e.userPermission={canSetTop:false,canDelete:false}},render:function(t){var i=this;i.param.el?i.initPage():i.initPopup();if(!i.$el){console.error("not found contentNode");return}r.getPostsContent({app:"pc",objectId:i.objectInfo.objectId,objectType:i.objectInfo.objectType,postId:t},function(n){if(0!=n.code)return;i.param.el&&n.data.title&&(document.title=n.data.title);i.toolbar=new o({el:i.$el,objectInfo:i.objectInfo,items:{showUp:true,showDown:true,showReply:true},commentReply:function(){i.scrollForm();return false}});e(".posts-cotent-loading",i.$el).replaceWith(f({data:n.data,toolbar:i.toolbar,videoOwnerId:u.globals.page.videoOwner,escapePostsHtml:i.escapePostsHtml.bind(i),userDomain:u.globals.userDomain}));var a=i.form=new l({el:e(".posts-comment-form",i.$el),submitArgs:{objectId:t,objectType:2},picUploadId:"posts",faces:{rangeNode:i.$el}});a.bind("submit:success",function(e){if(0!=e.code)return;r.add({userName:e.data.userName,userImage:e.data.avatarMiddle,picList:e.picList,content:e.params.content},function(){})});var r=new s({el:e(".posts-comment-list",i.$el),parentModule:i,objectInfo:{objectId:t,objectType:2},userPermission:{canDelete:(c.getUserInfo()||{}).userId==n.data.user.userId,canSetTop:false},scroll:{container:i.$el,scrollTop:function(e){return i.$el.scrollTop()+e[0].getBoundingClientRect().top}}});r.load({listType:0,currentPage:1})})},escapePostsHtml:function(e){var t=this;e=d.escapePostsHtml(e);e=t.parseActiveMark(e);return e},parseActiveMark:function(t){var i=this;var n;t=t.replace(/\[activity\s+([^\]]+)\]/,function(e,t){n=t||0;return""});if(n){t='<p class="posts-activity"></p>'+t;r.getActivityInfo({activityId:n},function(t){if(0!=t.code)return;var o=[];(t.data.roleList||[]).forEach(function(e){if(!e||void 0===e.id)return;o.push('<span><a class="role-bgimg"  href="javascript:;" data-id="'+n+'" data-role="'+e.id+'">'+e.roleName+"</a></span>")});if(o.length>0)o.push("<span>已领取昵称的人数："+t.data.count+"</span>");e(".posts-activity",i.$el).on("click","a",function s(t){if(!c.isLogin())return c.login(function(){s(t)});var i=e(t.target);r.addActivityName({activityId:i.data("id"),roleId:i.data("role")},function(e){var t;switch(e.code){case 0:t="你已经成功领取应援昵称："+e.data+"，快来给你的爱豆应援吧。";break;case 5010:t="不要贪心哦，你已经领取过昵称了，直接去说些什么吧。";break;default:t=e.message}a.alert({zIndex:20010,content:t})})}).html(o.join(""))})}return t}});return p});define("module/comment/v3/posts",["tui/art","tui/view","tui/popup","module/comment/v3/model","module/comment/v3/postsContent","module/comment/v3/commentToolbar","module/comment/v3/commentImage","module/comment/v3/utils","module/comment/v3/commentConfig"],function(t,i,n,a,r,o,s,l,d){var u=t.compile('<%data.forEach(function(item,i){%>\n<div class="posts-item" data-id="<%=item.postId%>">\n<div class="posts-userphoto">\n<a href="<%=userDomain%><%=item.user.userCode%>" target="_blank">\n<img src="<%=item.user.avatarLarge%>">\n</a>\n</div>\n<div class="posts-section">\n<div class="posts-userinfo">\n<a href="<%=userDomain%><%=item.user.userCode%>" class="<%if(item.user.vipInfo && [100002,100004,100006].indexOf(item.user.vipInfo.mmid) != -1){%>redname<%}%>" target="_blank"><%=item.user.userName%></a>\n<% if(videoOwnerId == item.user.userId){%>\n<span class="posts-usertitle">频道主</span>\n<%}%>\n<%if(item.user.vipInfo && [100002,100004,100006].indexOf(item.user.vipInfo.mmid) != -1){%>\n<a href="http://vip.youku.com/" title="<%=item.user.vipInfo.name%>" target="_blank">\n<span class="vip-level-icon" style="background: url(<%=item.user.vipInfo.icon%>);height: 22px;margin: 0;"></span>\n</a>\n<%}%>\n<%if(item.user.userLevel && item.user.userLevel>5){%>\n<a href="//lv.youku.com/page/grade/compare?uid=<%=item.user.userId%>" target="_blank" title="用户等级" class="user-grade-icon user-grade-lv<%=item.user.userLevel%>"></a>\n<%}%>\n<span class="posts-timestamp"><%=item.createTimeFormat.replace(\'发表于\',\'\')%></span>\n</div>\n<div class="posts-title posts-spacing">\n<a href="javascript:;"><%=item.title%></a>\n</div>\n<div class="posts-text">\n<%==escapePostsHtml(item.digest)%>\n</div>\n<div class="posts-image">\n<%==commentImage.render({ picList: item.picList })%>\n</div>\n<%if(item.stamp){%>\n<div class="posts-tag">\n<img src="<%=item.stamp%>" alt="">\n</div>\n<%}%>\n<% var toolbarHtml = toolbar.render({ \nid: item.postId,\nupCount: item.upCount, \ndownCount: item.downCount,\nreplyCount: item.commentCount,\nuserId: item.user.userId,\nuserName: item.user.userName,\n})%>\n<%==toolbarHtml%>\n</div>\n</div>\n<%})%>');var c=i.extend({initialize:function(t){var i=this;i.objectInfo=t.objectInfo;i.postsContent=new r({objectInfo:i.objectInfo});i.commentImage=new s({el:i.$el});i.toolbar=new o({el:i.$el,objectInfo:i.objectInfo,items:{showUp:true,showDown:true,showReply:true},commentReply:function(e){i.showContent(e);return false}});e(window).on("resize",function(){setTimeout(function(){i.computeContentFold(true)},200)});if(t.el&&true!==t.lazyLoad)i.loadPosts(3)},events:{"click .posts-fold-btn":"showContent","click .posts-title a":"showContent","click .posts-more a":"loadMore"},loadMore:function(t){var i=this;var n=e(t.target).parent();n.addClass("posts-more-loading");i.loadPosts(10,"",function(){n.removeClass("posts-more-loading")})},refresh:function(e){this.listType=e;this.lastPostId=0;this.loadPosts(3,"html")},loadPosts:function(t,i,n){var r=this;a.getPosts({app:"pc",objectId:r.objectInfo.objectId,objectType:r.objectInfo.objectType,listType:r.listType||0,lastPostId:r.lastPostId,limit:t},function(t){if(0==t.code){r.lastPostId=t.data.lastPostId;var a=e(">.posts-list,>.posts-more",r.$el);if(0===a.length)a=e('<div class="posts-list"></div><div class="posts-more"><a href="javascript:;">查看更多</a></div>').appendTo(r.$el);a.eq(0)[i||"append"](u({data:t.data.posts,toolbar:r.toolbar,videoOwnerId:d.globals.page.videoOwner,commentImage:r.commentImage,escapePostsHtml:l.escapePostsHtml,userDomain:d.globals.userDomain}))}n&&n();r.trigger("load:after",[t.data&&t.data.posts])})},showContent:function(t){this.postsContent.render(e(t.target).closest(".posts-item").data("id"))},computeContentFold:function(t){var i=this;var n=i.$el.find(".posts-text");var a=Math.floor(14*1.8);var r=Math.floor(n.width()/14);n.each(function(i,n){var o=e(n);if(true!==t&&e(".posts-fold-btn",o).length>0)return true;var s=o.outerHeight();if(o.get(0).scrollHeight-s>1){var l=o.find(">p,>br");var d;o.find(".posts-fold-btn").remove();l.each(function(t,i){var n=e(i);var o=i.nodeName.toLowerCase();if(n.position().top+(n.height()||a)<s){"p"===o&&(d=n);return true}if("br"===o)n=d;if(!n)return;var l=n.html();var u=Math.floor((s-n.position().top)/a*r-6);u=Math.min(u,l.length);var c=new RegExp("(.{"+u+"})(.*)");n.html(l.replace(c,'$1<a href="javascript:;" data-id="" class="posts-fold-btn posts-fold-btn-show">&nbsp;&nbsp;阅读全文<br/><br/><br/><br/></a>$2'));return false})}})}});return c});define("module/comment/v3/starComming",["tui/util/codec"],function(t){var i={init:function(e){if(!e.storage)return false;var t=e.storage.starreview;if(t.length>0)this.dowhat(t);else return false},dowhat:function(t){var i=this;for(var n in t){var a=t[n]["pk_id"];if(a){var r=this.inputTest(t[n]);if(r<0)e("#starCommingPannel_"+a).remove();else i.createDOM(t[n],r)}}},createDOM:function(e,i){var n='<em class="ico-comstar"></em>';var a=e["content"];if("inComming"==i)a=e["content2"];else if("afterComming"==i)a=e["content3"];var r='<div id = "starCommingPannel_'+e["pk_id"]+'" class="comment-Starhint">'+'<div class="starhint-close" style="display:none;" onclick= "starComming.closeClick(this);"></div>'+"<dl>"+'<dt><a href="//i.youku.com/u/'+t.encodeUid(e["starid"])+'" target="_blank"><img src="'+e["icon"]+'"></a></dt>'+'<dd><a href="//i.youku.com/u/'+t.encodeUid(e["starid"])+'" target="_blank">'+e["starname"]+"</a>"+n+"<br><span>"+e["role"]+"</span></dd>"+"</dl>"+'<div class="starhintDetail">'+"<p><span>"+a+"</span></p>"+'<a href="'+e["link"]+'" target="_blank">去看看</a>'+"</div>"+"</div>";jQuery("#videocomment").before(r)},getVIDFromURL:function(e){if("string"!=typeof e)return false;var i=e.match(/v_show\/id_([\w=]+)(\.*?)/);i=i[1]?t.decode64(i[1].substr(1))>>2:false;return i},inputTest:function(e){var t=-1;if("undefined"==typeof e["pk_id"]||0==e["pk_id"])return-1;if("undefined"==typeof e["status"]||0==e["status"])return-1;var i=1e3*e["begintime"];var n=1e3*e["starbgtime"];var a=1e3*e["starendtime"];var r=1e3*e["expiretime"];if(i>n||n>a||a>r)return-5;var o=(new Date).getTime();if(o>r)return-6;if(o<i)return-10;if(o>=i&&o<=n)t="beforeComming";else if(o>=n&&o<a)t="inComming";else if(o>=a&&o<=r)t="afterComming";else if(o>r)t="starCommingOver";return t}};return i});define("module/comment/v3/comment",["tui/view","tui/art","tui/util","module/comment/v3/model","module/comment/v3/form","module/cms/dataStore","module/comment/v3/starComming","module/comment/v3/commentList","module/comment/v3/posts","module/comment/v3/cmtegg","module/comment/v3/commentConfig","module/comment/v3/commentLogin"],function(t,i,n,a,r,o,s,l,d,u,c,f){var p=i.compile('<div class="comment-area <%=videoClass%>" <%=getSpmConfig(\'comment\')%> >\n<div id="commentAction" class="comment-area-form"></div>\n<div id="videocomment" class="comment-area-box">\n<div class="comment-tab">\n<ul class="comment-tab-left">\n<li data-type="all" class="current comment-show">全部评论<em class="num" id="allCommentNum"></em></li>\n<li data-type="db">豆瓣评论</li>\n<li data-type="owner">频道主说</li>\n<li data-type="star">明星说</li>\n</ul>\n<ul class="comment-tab-right">\n<li data-type="my">我的评论消息</li>\n<li data-type="input" <%=getSpmConfig(\'commentinput\')%> ><i class="icon-publish-comment"></i>发表评论</li>\n</ul>\n</div>\n<div class="comment-new-tooltip" style="display:none;">\n<a style="display:block;" charset="hz-4001208" href="javascript:;">有新评论，刷新看看</a>\n</div>\n<div class="comment-area-list">\n<div id="videoPostslist" class="posts-list-area comment-list-box">\n<div class="comment-list-head">\n<h3 class="title">热门<%=isShowVideo > 0 ? \'影评\' : \'长评\'%></h3>\n</div>\n<div class="comment-list-body">\n</div>\n</div>\n<div id=\'videoCommentlist\'></div>\n</div>\n<div class="forbid forbidden_comment" style="display:none">\n<h3>当前视频暂不支持评论。</h3>\n</div>\n<div id="commentPublish" class="comment-tooltip">\n<a href="javascript:;">发表评论</a>\n</div>\n</div>\n</div>');var h=e(window);var m={all:0,owner:1,star:2,db:"db",my:"mycomment"};var v={"频道主说":"owner","豆瓣评论":"db","明星说":"star"};var g=t.extend({hasLoaded:false,comstatus:3e4,comstatusNum:1,initialize:function(t){var i=this;i.slefext(t);i.$el.html(p({videoClass:c.globals.videoClass||"",isShowVideo:c.globals.page.showid>0,getSpmConfig:function(e){return c.getCommentTestSpmConfig(e,0)}}));i.$tabList=e(".comment-tab li",i.$el);if(c.check("operate.input")){i.form=new r({el:"#commentAction",gift:true,submitArgs:i.objectInfo,picUploadId:"comment",faces:{rangeNode:i.$el}});i.modelEvents(i.form,"form")}else e("#commentPublish").remove();var a=i.commentList=new l({el:"#videoCommentlist",objectInfo:i.objectInfo,userPermission:i.userPermission,parentModule:i,scroll:{scrollTop:function(t){if(t.is("#videoCommentlist"))t=e(".comment-area-list",i.$el);return t.offset().top-130}}});a.bind("load:before",function(){e(".comment-area-list",i.$el).removeClass("comment-list-hasposts")}).bind("load:after",function(t,r,o){if(0==r&&0!=t.comment.length){e(".comment-new-tooltip",i.$el).hide();if(1==t.currentPage){i.lastid=t.comment[0].id;var s=t.comment[0].createTime;var l=new Date(s);var d=new Date;var u=d.getTime()-l.getTime();i.lasttime=parseInt(u/(24*60*1e3*60));e("#allCommentNum").html("("+n.split(t.totalSize)+")")}}else i.lasttime=15;
if(c.check("posts")){i.hasCommentPager=t.totalPage>1;i.showPosts=[0,1].indexOf(r)!=-1&&1==t.currentPage;i.togglePosts()}if(!c.check("commentOpen")&&"add"!=o&&"init"!=o)a.scrollTop(["commentnew","setTop"].indexOf(o)+2)}).bind("add:after",function(){if(!c.check("commentOpen"))a.scrollTop(2)});if(c.check("posts")){i.posts=new d({el:"#videoPostslist .comment-list-body",objectInfo:i.objectInfo,lazyLoad:true});i.posts.bind("load:after",function(e){i.hasPostsData=e&&e.length>0;i.togglePosts()})}i.lazyLoad();i.commentEgg();if(!c.check("commentOpen"))window.goldlog&&window.goldlog.record("/yt/ykcomment.play.commentInit","EXP","objectId="+i.objectInfo.objectId,"H1505507056")},togglePosts:function(){var t=this;var i=t.$el;if(!c.check("posts"))return;var n=t.showPosts&&t.hasPostsData;var a=e(".comment-area-list",t.$el);a[n?"addClass":"removeClass"]("comment-list-hasposts");a[!t.hasCommentPager?"addClass":"removeClass"]("comment-list-nopager");if(a.hasClass("comment-list-hasposts"))t.posts&&t.posts.computeContentFold();if(0==e(".comment-list-hot",i).length)e(".comment-list-main .comment-list-head",i)[n?"show":"hide"]()},events:{"click .comment-tab li":"tabChange","click .comment-new-tooltip a":"commentNewNotic","click #commentPublish":function(){this.scrollForm()}},"{form} submit:success":function(e){var t=this;var i=function(){if(!e.data)return false;t.commentList.add({userName:e.data.userName,userImage:e.data.avatarMiddle,picList:e.picList,content:e.params.content})};var n=t.$tabList.filter('[data-type="all"]');if(!n.hasClass("current")){t.$tabList.removeClass("current");n.addClass("current");t.commentList.load({listType:0,currentPage:1},"add",i)}else i()},scrollForm:function(){var t=this;var i=t.form;if(!i)return;e("html,body").scrollTop(i.$el.offset().top-130);t.form.focus()},slefext:function(e){var t=this;var i=c.globals.page;if(void 0==i.objectType)i.objectType=1;t.objectInfo={objectId:i.videoId,objectType:i.objectType};t.userPermission={canDelete:(f.uid()||-1)==i.videoOwner,canSetTop:false};f.bind("login:after",function(){t.userPermission.canDelete=t.userPermission.canDelete||f.uid()==i.videoOwner});t.getStarActivity();a.switchEnv()},reset:function(e){var t=this;if(e==c.globals.page.videoId)return;c.globals.page.videoId=e;if(!t.hasLoaded)return;t.objectInfo.objectId=e;t.form&&t.form.reset(e);t.getStarActivity();t.commentEgg();t.$tabList.filter('[data-type="all"]').click()},tabChange:function(t){var i=this;var n=e(t.currentTarget);var a=n.data("type");if("input"==a&&i.form){i.scrollForm();return}if("my"==a&&!f.isLogin()){f.login(function(){i.tabChange(t)});return}i.$tabList.removeClass("current");n.addClass("current");i.load(a,1,"tab")},lazyLoad:function(e){var t=this;var i=t.$el;if(!i.length)return;function n(){var e=i.offset().top;if(h.scrollTop()+h.height()>e&&!t.hasLoaded){t.init();h.off("scroll.commentControlLazyLoad")}}h.on("scroll.commentControlLazyLoad",function(){n()});n()},commentNewNotic:function(t){var i=this;e(t.currentTarget).parent().hide(200);i.load("all",1,"commentnew");i.comstatusNum=1;if(!i.updateCommentTsTimer)i.updateCommentTs()},getInfo:function(){var e=this;a.getInfo({objectId:e.objectInfo.objectId,app:"pc"},function(t){if(0==t.code){var i=e.userPermission;i.canDelete=i.canDelete||t.data.pgc;i.canSetTop=i.canSetTop||t.data.pgc||t.data.canSetTop;e.commentList.updateDiffItem()}})},getStarActivity:function(){var e=this;var t=c.globals.page;var i={folderid:t.folderId,showid:t.showid,videoid:t.videoId,toppicid:t.catId,client:"pc"};e.dataStore=o.getInstance(i)},getStarInfo:function(){if(!c.check("text.star"))return;var e=this;var t=c.globals.page;a.getPersonInfo({showId:t.showid||0,app:"pc",videoId:t.videoId,catId:t.catId||0},function(t){if(0==t.code)e.commentList.starlink=t.data})},load:function(e,t,i){var n=this;var a=["all","owner"].indexOf(e);if(a!=-1&&"commentnew"!=i)n.posts&&n.posts.refresh(a);n.commentList.load({listType:m[e],currentPage:t},i)},commentTabBanner:function(){if(!c.check("tabFixed"))return;var t=this;var i=e(".comment-tab",t.$el);var n=t.$tabList.filter('[data-type="input"]');var a={satae:"stable",tab_innerOffsetTop:false,test:function(){var e=parseInt(h.scrollTop());if(!a.tab_innerOffsetTop)a.tab_innerOffsetTop=i.offset().top-81;if(e<a.tab_innerOffsetTop)a.stable();else a.fixed()},fixed:function(){if("stable"!=a.satae)return;a.satae="fixed";c.check("operate.input")&&n.show();i.addClass("comment-tab-fixed");var e=i.parent().width();if(i.width()!=e)i.css("width",e);a.tab_innerOffsetTop=i.offset().top-81},stable:function(){if("fixed"!=a.satae)return;a.satae="stable";n.hide();i.removeClass("comment-tab-fixed");a.tab_innerOffsetTop=false},bindScroll:function(){a.test();h.on("scroll",a.test)}};a.bindScroll()},loadTab:function(){var e=this;a.navigationBar({app:"pc",objectId:e.objectInfo.objectId},function(t){var i=[];if(0==t.code&&t.data.length>0){if(96==c.globals.page.catId)t.data.push({name:"豆瓣评论"});i=t.data.map(function(e){return v[e.name]})}i.forEach(function(t){c.check("tab."+t)&&e.$tabList.filter('[data-type="'+t+'"]').addClass("comment-show")})});c.check("tab.my",function(){e.$tabList.filter('[data-type="my"]').addClass("comment-show")})},updateCommentTs:function(){var t=this;if(t.lasttime&&t.lasttime>=15)return false;a.objectCommentStatus({app:"pc",objectId:t.objectInfo.objectId,objectType:t.objectInfo.objectType,listType:"0",lastCommentId:t.lastid||0},function(i){if(0==i.code&&i.data.newCount>0){e(".comment-new-tooltip",t.$el).show();clearTimeout(t.updateCommentTsTimer);t.updateCommentTsTimer=null}});t.comstatusNum++;if(t.comstatusNum>10)t.comstatusNum=10;clearTimeout(t.updateCommentTsTimer);t.updateCommentTsTimer=setTimeout(function(){t.updateCommentTs()},t.comstatus*t.comstatusNum)},commentEgg:function(){var e=this;if(!c.check("egg")||!e.form)return;var t=c.globals.page;new u({form:e.form,params:{client:"pc",folderid:t.folderId,showid:t.showid,videoid:t.videoId,toppicid:t.catId}})},init:function(){var e=this;e.hasLoaded=true;f.init();e.getInfo();e.getStarInfo();e.loadTab();setTimeout(function(){e.updateCommentTs()},e.comstatus);e.commentTabBanner();setTimeout(function(){e.load("all",1,"init");s.init(e.dataStore)},1e3)}});return g});define("page/find/play/comment",["module/comment/v3/comment","module/comment/v3/commentConfig","module/comment/v3/commentLogin","module/login/login"],function(e,t,i,n){var a=["test.comment.youku.com","video-prepub.youku.com","video-develop.youku.com","video-develop.inner.youku.com"].indexOf(window.location.hostname)>=0;t.init({},{page:window.PageConfig,appId:"100-DDwODVkv",appSecret:window.location.search.indexOf("type=test")>0?"24b556b2e1e8194280173e5d6b4c0875":"6c4aa6af6560efff5df3c16c704b49f1",commentSource:"20000",isTestEnv:a});i.loginFunc=function(){n.login()};n.bind("login:success",function(){i.trigger("login:success")});new e({el:"#module_basic_comment"})})}(window.jQuery);;l{      YNmYNm=YPm   ?    :http://js.ykimg.com/youku/dist/js/page/find/play/comment_30.js necko:classified 1 strongly-framed 1 request-method GET request-Accept-Encoding gzip, deflate response-head HTTP/1.1 200 OK
Server: Tengine
Content-Type: text/javascript
Content-Length: 144046
Date: Sat, 24 Jun 2017 08:10:22 GMT
Expires: Mon, 26 Jun 2017 08:10:22 GMT
Cache-Control: max-age=172800
Accept-Ranges: bytes
Etag: "3937331892"
Last-Modified: Tue, 20 Jun 2017 06:18:32 GMT
Timing-Allow-Origin: *, *
Strict-Transport-Security: max-age=0
Vary: Accept-Encoding
Via: cache8.l2nu17-1[0,304-0,H], cache15.l2nu17-1[0,0], cache15.cn600[0,200-0,H], cache2.cn600[0,0]
Age: 488
X-Cache: HIT TCP_MEM_HIT dirn:6:1096022179
x-swift-savetime: Sat, 24 Jun 2017 08:13:52 GMT
x-swift-cachetime: 300
eagleid: 01bddb4214982923109794468e
 original-response-headers Server: Tengine
Content-Type: text/javascript
Content-Length: 144046
Connection: keep-alive
Date: Sat, 24 Jun 2017 08:10:22 GMT
Expires: Mon, 26 Jun 2017 08:10:22 GMT
Cache-Control: max-age=172800
Accept-Ranges: bytes
Etag: "3937331892"
Last-Modified: Tue, 20 Jun 2017 06:18:32 GMT
Timing-Allow-Origin: *, *
Strict-Transport-Security: max-age=0
Vary: Accept-Encoding
Via: cache8.l2nu17-1[0,304-0,H], cache15.l2nu17-1[0,0], cache15.cn600[0,200-0,H], cache2.cn600[0,0]
Age: 488
X-Cache: HIT TCP_MEM_HIT dirn:6:1096022179
x-swift-savetime: Sat, 24 Jun 2017 08:13:52 GMT
x-swift-cachetime: 300
eagleid: 01bddb4214982923109794468e
 uncompressed-len 0 net-response-time-onstart 140 net-response-time-onstop 141  2