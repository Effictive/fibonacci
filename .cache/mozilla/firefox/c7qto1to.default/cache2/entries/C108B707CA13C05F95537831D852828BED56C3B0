/**
 * @modified $Author: gaopeng $
 * @version $Rev: 3b7ea9bbe3cbfb47035cbfb4fe9e9accb0f4abdf $
 */
!function(e,t,n){t.config({enable_ozma:true});n("tui/xDomainRequest",[],function(){var t=e.ajaxSettings.xhr();var n=!!t&&"withCredentials"in t;if(n||!e.ajaxTransport||!window.XDomainRequest)return e;var i=/^(https?:)?\/\//i;var a=/^get|post$/i;var o=new RegExp("^(//|"+location.protocol+")","i");e.ajaxTransport("* text html xml json",function(t,n,s){if(!t.crossDomain||!t.async||!a.test(t.type)||!i.test(t.url)||!o.test(t.url))return;var r=null;return{send:function(i,a){var o="";var s=(n.dataType||"").toLowerCase();r=new XDomainRequest;if(/^\d+$/.test(n.timeout))r.timeout=n.timeout;r.ontimeout=function(){a(500,"timeout")};r.onload=function(){var t="Content-Length: "+r.responseText.length+"\r\nContent-Type: "+r.contentType;var n={code:200,message:"success"};var i={text:r.responseText};try{if("html"===s||/text\/html/i.test(r.contentType))i.html=r.responseText;else if("json"===s||"text"!==s&&/\/json/i.test(r.contentType))try{i.json=e.parseJSON(r.responseText)}catch(o){n.code=500;n.message="parseerror"}else if("xml"===s||"text"!==s&&/\/xml/i.test(r.contentType)){var c=new window.ActiveXObject("Microsoft.XMLDOM");c.async=false;try{c.loadXML(r.responseText)}catch(o){c=void 0}if(!c||!c.documentElement||c.getElementsByTagName("parsererror").length){n.code=500;n.message="parseerror";throw new Error("Invalid XML: "+r.responseText)}i.xml=c}}catch(l){throw l}finally{a(n.code,n.message,i,t)}};r.onprogress=function(){};r.onerror=function(){a(500,"error",{text:r.responseText})};if(n.data)o="string"===e.type(n.data)?n.data:e.param(n.data);if("post"==t.type.toLowerCase()&&t.xhrFields&&true===t.xhrFields.withCredentials)o=o+"&cookie="+encodeURIComponent(document.cookie);r.open(t.type,t.url);r.send(o)},abort:function(){if(r)r.abort()}}})});n("module/comment/v3/utils",["module/comment/v3/model","tui/cookie","tui/net"],function(t,n){var i={escapePostsHtml:function(e){return e.replace(/<((?!(?:\/?(p|b|font))|br|img).*?)>/gi,"&#60;$1&#62;")},recordGoldlog:function(t,i){i.t=Date.now();n.getRequest("http://gm.mmstat.com/yt/"+t+"?"+e.param(i))}};return i});n("tui/plupload/plupload",[],function(){var t="uploader",n=t+1e17*Math.random(),i=e.noop,a={mode:"html5",action:"",name:"file",formData:null,multiple:false,auto:true,showQueue:false,fileSizeLimit:0,fileTypeDesc:"",fileTypeExts:"",maxChunkSize:512*1e3,maxConnections:2,preview:false,num:1e3,onInit:i,onClearQueue:i,onSelected:i,onCancel:i,onError:i,onStart:i,onProgress:i,onSuccess:i,onComplete:i,onAllComplete:i,onMouseOver:i,onMouseOut:i,onMouseClick:i,onAddQueue:function(e,t){var n='<li data-id="'+e.name+"_"+e.id+'"><div class="img-item">';if(this.options.preview)n+='<a href="javascript:;"  class="f-preview picbox '+this.id+"_preview_"+e.id+'"><img src="http://oss-comments.youku.com/pic/35ND0vgl/1481541888456.png"></a>';n+='<div class="opacity-dom"><a href="javascript:;" class="pic-icon">x</a></div>'+'<div class="img-load "><img src="http://oss-comments.youku.com/pic/WObxvPcs/1481541857541.gif"><div class="f-progress-bg"></div></div>'+"</div></li>";return n}},o={600:"Installation error",601:'Please select "{1}" format file',602:"The file size must be less than {1}"},s={};!function(e){var t=e.split(/,/),n,i,a;for(n=0;n<t.length;n+=2){a=t[n+1].split(/ /);for(i=0;i<a.length;i++)s[a[i]]=t[n]}}("image/x-icon,ico,"+"image/bmp,bmp,"+"image/gif,gif,"+"image/jpeg,jpeg jpg jpe,"+"image/photoshop,psd,"+"image/png,png,"+"image/svg+xml,svg svgz,"+"image/tiff,tiff tif,"+"text/plain,asc txt text diff log,"+"text/html,htm html xhtml,"+"text/xml,xml,"+"text/css,css,"+"text/csv,csv,"+"text/rtf,rtf,"+"audio/mpeg,mpga mpega mp2 mp3,"+"audio/x-wav,wav,"+"audio/mp4,m4a,"+"audio/ogg,oga,"+"audio/webm,webma,"+"video/mpeg,mpeg mpg mpe,"+"video/quicktime,qt mov,"+"video/mp4,mp4,"+"video/x-m4v,m4v,"+"video/x-flv,flv,"+"video/x-ms-wmv,wmv,"+"video/avi,avi,"+"video/ogg,ogv,"+"video/webm,webmv,"+"video/vnd.rn-realvideo,rv,"+"application/msword,doc dot,"+"application/pdf,pdf,"+"application/pgp-signature,pgp,"+"application/postscript,ps ai eps,"+"application/rtf,rtf,"+"application/vnd.ms-excel,xls xlb,"+"application/vnd.ms-powerpoint,ppt pps pot,"+"application/zip,zip,"+"application/x-rar-compressed,rar,"+"application/x-shockwave-flash,swf swfl,"+"application/vnd.openxmlformats-officedocument.wordprocessingml.document,docx,"+"application/vnd.openxmlformats-officedocument.wordprocessingml.template,dotx,"+"application/vnd.openxmlformats-officedocument.spreadsheetml.sheet,xlsx,"+"application/vnd.openxmlformats-officedocument.presentationml.presentation,pptx,"+"application/vnd.openxmlformats-officedocument.presentationml.template,potx,"+"application/vnd.openxmlformats-officedocument.presentationml.slideshow,ppsx,"+"application/x-javascript,js,"+"application/json,json,"+"application/java-archive,jar war ear,"+"application/vnd.oasis.opendocument.formula-template,otf,"+"application/octet-stream,exe");var r=function(){};r.extend=function(e){var t=this.prototype,n,i,a,o=t,s;if("function"===typeof e)e=e.call(t);a=e.__construct;while(!a){a=o.constructor;o=o.__super()}i=new this("!-");for(s in e)i[s]=e[s];n=function(){if("!-"!==arguments[0])a.apply(this,arguments)};i.constructor=n;i.__super=function(e,n){return e?t[e].apply(this,n?n:arguments.callee.caller.arguments):t};n.prototype=i;n.extend=arguments.callee;return n};var c=r.extend(function(){function i(e,t,n){var i="progress"===t,a;if(e&&e.timeStamp){a=e.timeStamp;if(String(a).length>13)a=+String(a).substr(0,13)}else a=+new Date;this.timeStamp=a;this.type=t;this.loaded=i?e.loaded:0;this.total=i?e.total:0;this.lengthComputable=i?e.lengthComputable:false;this.file=n||e.file;if(i)this.originalEvent=e;if(e.data)this.data=e.data}function a(e,t){this.id=e;this.name=t.name;this.size=t.size;this.type=!t.type?s[t.name.split(".").pop()]:t.type.length<6?s[t.type]:t.type;this.lastModifiedDate=new Date(+t.lastModifiedDate);this.originalFile=t;if(t.error)this.error=t.error}function o(e){var t=e.code||+e.message,n={600:"Installation Error",601:"Type Error",602:"Size Error"};if(t){this.code=t;e.name=e.name||n[t]||"HTTP Error";e.message=e.message||t}if(e.file)this.file=e.file;this.type="error";this.name=d(e.name||"Error");this.message=e.params?d.apply(null,[e.message].concat(e.params)):d(e.message)}function r(e){var t=this.queue,n=t.length;while(n--)if(t[n].id===e)return t[n]}function u(e){var t=e.substr(e.lastIndexOf(".")+1).toLowerCase();return this.acceptExts[t]}function p(e,t){return l(1e3*e/t)+"/s"}function f(t,n){var i=e("."+this.id+"_preview_"+t.id).parent(),a=i.find(".f-progress-bg");a.animate({width:n},200);i.find(".f-progress").text(n)}return{__construct:function(i,a){var o=i[n],s=t+"_",r;if(void 0!==o){s+=o;r=window[s];r&&r.destroy()}else{o=c.guid++;s+=o;i[n]=o}this.id=s;this.options=e.extend({},c.defaults,a);this.element=i;this.init();window[s]=this},init:function(){var t=this,n=e(t.element),i=t.options,a=n.outerWidth(),o=n.outerHeight(),s="width:"+a+"px;height:"+o+"px;",r="z-index:"+n.css("z-index")+";",c="margin:0;padding:0;border:0;cursor:pointer;font-size:200px;filter:alpha(opacity=0);opacity:0;";if(i.showQueue){if("string"===typeof i.showQueue)t.$queue=e(i.showQueue).addClass("upload-queue");else{n.after('<div class="upload-queue" id="'+t.id+'_queue"></div>');t.$queue=e("#"+t.id+"_queue")}if(i.preview)t.$queue.addClass("upload-preview")}var l=n.css("left"),m=n.css("top"),u=n.css("margin-left"),d=n.css("margin-top");if("absolute"===n.css("position"))r+="left:"+l+";top:"+m+";margin-left:"+u+";margin-top:"+d+";";else{r+="margin-left:-"+(a+(0^parseInt(n.css("margin-right")))+0^parseInt(l))+"px;";r+="margin-top:"+(0^parseInt(d)+0^parseInt(m))+"px;"}t.$browseEl=e('<span class="upload-el" style="position:absolute;overflow:hidden;'+s+r+'">'+t.create(c+s)+"</span>");n.after(t.$browseEl);t.$el=n;t.browse=e("#"+t.id)[0];t.queue=[];t.loadIndex=-1;t.acceptExts=function(t){if("*"===t)return t;var n={};e.each(t.split("|").join(",").split(","),function(e,t){n[t]=1});return n}(i.fileTypeExts);i.onInit.call(t)},setOption:function(t,n){var i=this.options;if("string"===typeof t)i[t]=n;else if("object"===typeof t)e.extend(i,t)},start:function(){var e=this,t=e.queue.length,n;e.loadIndex++;if(e.loadCount===t)e.onAllComplete();else if(e.loadIndex<t){n=e.queue[e.loadIndex];if(n.error||n.abort)e.start();else e.upload(n)}},remove:function(t){if(this.$queue)e("#"+this.id+"___"+t).delay(1e3).fadeOut(500).remove()},destroy:function(){this.$browseEl&&this.$browseEl.remove();this.$queue&&this.$queue.remove();delete window[this.id]},getFile:function(e){return this.validId(e)?this.files[e]:null},validId:function(e){var t=this.queue.length;while(t--)if(this.queue[t].id===e)return true},getDataURL:function(e){var t=this;if(window.File&&e instanceof File){if(window.FileReader){var n=new FileReader;n.onload=function(n){e.dataURL=this.result;t.setPreview(e)};n.readAsDataURL(e)}}else if(e.dataURL&&/^data:.*;base64/i.test(e.dataURL))t.setPreview(e)},setPreview:function(t){var n=this,i=n.options;e("."+this.id+"_preview_"+t.id).last().html('<img src="'+t.dataURL+'">')},onSelected:function(t){var n=this,i=n.options,s,r=i.fileTypeExts.split("|").join(","),c=m(i.fileSizeLimit);n.queue=[];n.files={};n.loadIndex=-1;n.loadCount=0;e.each(t,function(e,t){var l;s=new a(+e,t);t.id=e;if(i.preview)n.getDataURL(t);if("*"!==n.acceptExts&&!u.call(n,t.name)){n.onError({code:601,params:[r]},false);return}if(c>0&&s.size>c){s.error="Size Error";l=new o({code:602,params:[i.fileSizeLimit.toUpperCase()],file:s});n.onError(l,false)}n.files[e]=t;n.queue[e]=s});if(false===i.onSelected.call(n,n.queue))return;if(n.$queue){var l="",d=n.queue.length;e.each(n.queue,function(e,t){l+=i.onAddQueue.call(n,t,t.error)});n.$queue.append(l)}if(i.auto)n.start()},onStart:function(e){var t=this,n=e.file;e=new i(e,"loadstart",n);e.originalFile=t.files[n.id];n._t=e.timeStamp-1;n._l=0;c.uploading=true;t.options.onStart.call(t,e)},onProgress:function(e){var t=this,n=e.file||t.queue[e.id];e=new i(e,"progress",n);e.originalFile=t.files[n.id];if(e.lengthComputable){e.speed=p(e.loaded-n._l,e.timeStamp-n._t);if(t.$queue)f.call(t,n,Math.round(100*e.loaded/e.total).toFixed(1)+"%");n._t=e.timeStamp;n._l=e.loaded}t.options.onProgress.call(t,e)},onCancel:function(e){this.remove(e);this.queue[e].abort=true;this.options.onCancel.call(this,this.queue[e])},onClearQueue:function(){this.queue=[];if(this.$queue)this.$queue[0].innerHTML="";this.browse.style.display="";c.uploading=false;this.options.onClearQueue.call(this)},onError:function(t,n){var i=this.options,a=t.id||null,s=a?t.file||r.call(this,a):null;t=new o(t);if(i.language&&t.code&&i.language[t.code])t.message=i.language[t.code];if(null!==a){if(this.$queue)e("#"+this.id+"___"+a).addClass("upload-error").find(".f-progress").text(t.name);if(false!==n)this.onComplete(t)}this.options.onError.call(this,t)},onSuccess:function(e){e=new i(e,"load",this.queue[e.id]);f.call(this,e.file,"100%");this.options.onSuccess.call(this,e);this.onComplete(e)},onComplete:function(e){e=new i(e,"loadend");this.loadCount++;this.options.onComplete.call(this,e);this.start()},onAllComplete:function(){var e=this;c.uploading=false;e.files={};e.queue=[];e.options.onAllComplete.call(e)},onMouseOver:function(){this.$el.addClass("upload-btn-over");this.options.onMouseOver.call(this,this.$btn)},onMouseOut:function(){this.$el.removeClass("upload-btn-over");this.options.onMouseOut.call(this,this.$btn)},onMouseClick:function(){this.$el.trigger("click");this.options.onMouseClick.call(this,this.$btn)}}});if(!!(window.FormData&&(new XMLHttpRequest).upload))c.html5=c.extend(function(){var t={loadstart:"onStart",progress:"onProgress",error:"onError",load:"onSuccess",loadend:"onComplete"};function n(){var e=[],t=this.options.fileTypeExts.replace("|",",").split(","),n,i=t.length,a;if(i){for(n=0;n<i;n++){a=t[n];if(s[a])e.push("csv"===a?".csv":s[a])}return e.join(",")}}function i(){this.xhr=this.xhr||new XMLHttpRequest;return this.xhr}return{create:function(e){return'<input type="file" title="" class="uploader"'+' id="'+this.id+'"'+' style="'+e+'"'+' accept="'+n.call(this)+'"'+(this.options.multiple?" multiple":"")+">"},upload:function(n){var a=this,o=a.options,s,r,c;c=n.originalFile;if(!c)return;r=new FormData;r.append(o.name,c);if(o.formData)e.each(e.isFunction(o.formData)?o.formData.call(a):o.formData,function(e,t){r.append(e,t)});s=i.call(a);s.open(o.method||"POST",o.action,true);s.onreadystatechange=function(){if(4===s.readyState)if(200===s.status)a.onSuccess({file:n,data:s.responseText});else a.onError({file:n,code:s.status})};s.upload.onloadstart=s.upload.onprogress=s.upload.onerror=function(e){e.file=n;a[t[e.type]](e)};e.each({"Cache-Control":"no-cache","X-Requested-With":"XMLHttpRequest"},function(e,t){s.setRequestHeader(e,t)});s.withCredentials=true;s.send(r)},cancel:function(e){var t=this,n=t.queue;if(void 0===e||"*"===e){if(t.xhr&&t.xhr.readyState>0)t.xhr.abort();t.onClearQueue()}else{if(!n.length)return;if(t.xhr&&t.xhr.readyState>0&&t.queue[e])t.xhr.abort();t.onCancel(e)}},destroy:function(){if(this.browse)this.browse.parentNode.removeChild(this.browse);this.xhr=null;this.__super("destroy")}}});a.swf=function(){var e=document.getElementsByTagName("script"),t=e[0],n=t&&t.getAttribute("src"),i;if(!n)n="";i=n.split("/").slice(0,-1).join("/");if(i)i+="/";i="";return i+"uploader.swf"}();c.flash=c.extend(function(){var t=!!window.ActiveXObject,n=t&&!navigator.msDoNotTrack,i=+new Date;function a(e){if(!e.src)return;var n=e.src+(e.src.indexOf("?")!==-1?"&":"?")+"__="+i,a="",o={type:"application/x-shockwave-flash"},s={wmode:"transparent",allowScriptAccess:"always"},r=function(e){var t,n="";for(t in e)n+=" "+t+'="'+e[t]+'"';return n};!function(t){var n=t.length,i,a={};while(n--)a[t[n]]=1;for(i in e)if(a[i])o[i]=e[i];else s[i]=e[i]}("width height id class style".split(" "));s.src=n;if(t){o.codebase="http://download.macromedia.com/pub/shockwave/cabs/flash/swflash.cab#version=9,0,28,0";o.classid="clsid:d27cdb6e-ae6d-11cf-96b8-444553540000";a+="<object"+r(o)+">";for(var c in s)a+='<param name="'+c+'" value="'+s[c]+'">';a+="</object>"}else a+="<embed"+r(s)+r(o)+">";return a}function o(e){if(t){e.style.display="none";!function(){if(4===e.readyState){for(var t in e)if("function"===typeof e[t])e[t]=null;e.parentNode.removeChild(e)}else setTimeout(arguments.callee,15)}()}else e.parentNode.removeChild(e)}return{create:function(t){var i=this.options,o={id:this.id,path:function(){var e=location.pathname.split("/");e.pop();return e.join("/")+"/"}(),action:i.action,field:i.name,src:i.swf,desc:i.fileTypeDesc,ext:i.fileTypeExts};if(i.multiple)o.multiple=1;if(i.debug)o.debug=1;if(i.preview){o.preview=1;if(n)o.previewSize=31*1024}if(i.method)o.method=i.method;return a({src:i.swf,style:t,id:this.id,"class":"uploader",flashvars:e.param(o)})},upload:function(t){var n=this,i=n.options;if(i.formData)n.browse.setData(e.param(e.isFunction(i.formData)?i.formData.call(n):i.formData));var a=t.size/1024/1024;var o=a>1?1e3:100;if(a>2)o=2e3;else if(a>3)o=3e3;setTimeout(function(){try{n.browse.startUpload(""+t.id)}catch(e){}},o)},cancel:function(e){var t=this.queue;if(t.length)if(!e)e=t[0].id;this.browse.cancelUpload(e)},destroy:function(){o(this.browse);this.__super("destroy")}}});e(function(){var n=e("body");n.on("change."+t,":file."+t,function(){if(!this.value)return;window[this.id].onSelected(this.files);this.value=""}).on("click."+t,":file."+t,function(){window[this.id].onMouseClick()});n.on("mouseenter."+t,"div.upload-btn-wrap",function(){window[this.firstChild.id].onMouseOver()}).on("mouseleave."+t,"div.upload-btn-wrap",function(){window[this.firstChild.id].onMouseOut()});n.on("click."+t,"a.upload-cancel",function(t){var n=e(this).closest(".queue"),i=n.attr("id").split("___");if(n.hasClass("upload-error"))n.remove();else window[i[0]].cancel(i[1]);t.preventDefault()})});function l(e){var t=-1;if(e){do{e/=1024;t++}while(e>1024)}else{t++;e=0}return e.toFixed(2)+["KB","M","G","T"][t]}function m(e){var t={k:1024,m:1048576,g:1073741824},n;if("string"===typeof e){n=/([0-9\.]+)([mgk])/.exec(e.toLowerCase());e=+n[1];e*=t[n[2]]}return e}function u(e,t){var n=e.length,i,a;if(n>t){a=4+1+(n-e.lastIndexOf(".")-1);i=t-a-3;if(i%2)i-=1;e=e.substr(0,i)+"..."+e.substr(-a)}return e}function d(t){if(!t)return"";if("object"===typeof t)return e.extend(o,t);var n=o[t]||t,i=arguments;if(i.length>1)for(var a=1,s=i.length;a<s;a++)n=n.replace("{"+a+"}",i[a]);return n}c.guid=0;c.uploading=false;c.defaults=a;c.mimes=s;c.lang=o;c.i18n=d;c.stringifySize=l;c.parseSize=m;c.getShortName=u;e.uploader=c;e.fn.uploader=function(i){var o=arguments,s=this[0][n],r;if(void 0!==s)r=t+"_"+s;if(!o.length)return r?window[r]:null;if("string"===typeof i&&"on"!==i.substr(0,2)){if(r)window[r][i].apply(window[r],Array.prototype.slice.call(o,1))}else{this.off("remove."+t).on("remove."+t,function(){window[this[n]].destroy()});i=e.extend({},a,i);i.fileTypeExts=i.fileTypeExts.replace(/ /g,"");if(!c[i.mode])i.mode="flash";this.each(function(){new c[i.mode](this,i)})}return this};d({400:"(400)请求无效",404:"(404)请求的资源不存在",500:"(500)内部服务器错误",501:"(501)未执行",502:"(502)连接超时",600:"初始化上传发生错误",601:"请选择“{1}”格式的文件",602:"文件不能大于{1}"});return c});n("module/comment/v3/uploadimg",["tui/plupload/plupload"],function(t){var n={uploadst:[],errpic:0,mupload:function(n,i,a){var o=this;var s="."+n.id+"FormContent";var r=new t["flash"](e("#"+n.id+n.num)[0],{action:i+"/ycp/public/common/uploadPic",mode:"flash",name:"imageFiles",multiple:true,auto:false,swf:a+"/youku/dist/embed/swf/uploader.swf",preview:true,showQueue:"#"+n.id+"imgitem ul",fileSizeLimit:"5M",fileTypeDesc:"选择图片文件",fileTypeExts:"jpg,jpeg,gif,png",onInit:function(e){},onSelected:function(t){e(s+" .form-textarea-picdom").addClass("form-textarea-pic");if(o.uploadst.indexOf(n.id)<0){o.uploadst.push(n.id);o.mupload({id:n.id,num:1},i,a)}e(s+" .cont-imgupload").show();setTimeout(function(){r.start()},1e3);o.uploadAuto(s,1e3)},onCancel:function(e){},onStart:function(e){},onProgress:function(e){},onError:function(t){setTimeout(function(){e(s+" .cont-imgitem li").each(function(n){if(e(this).attr("data-id")==t.file.name+"_"+t.file.id)e(this).remove()});o.showError(s,t.message);o.uploadAuto(s)},1e3)},onSuccess:function(t){var n=JSON.parse(t.data);if(0==n.code)e(s+" .cont-imgitem li").each(function(i){if(e(this).attr("data-id")==t.file.name+"_"+t.file.id){e(this).addClass("img-itemload").attr({"data-src":n.data[0].picUrl,"data-arr":JSON.stringify(n.data[0])});e(this).find(".picbox img").attr("src",n.data[0].picUrl+"?x-oss-process=image/format,jpg/resize,m_fill,h_100,w_100")}});else{e(s+" .cont-imgitem li").each(function(n){if(e(this).attr("data-id")==t.file.name+"_"+t.file.id)e(this).remove()});if(n.code==-3008)o.showError(s,"您选择的图片尺寸太小，请上传质量更高的图片");else o.showError(s,n.message)}},onComplete:function(e){},onAllComplete:function(t){o.uploadAuto(s);if(e(s+" .cont-imgitem ul li").length>9){o.showError(s,"上传的文件已经超过9张，发表只会取前9张！");o.uploadAuto(s,1e3)}else if(e(s+" .cont-imgitem ul li").length>=9)o.uploadAuto(s,1e3)},onClearQueue:function(){}})},uploadAuto:function(t,n){if(1e3==n){e(t+" .upload-el").css({left:"-1000px"});e(t+" .ui-upload-a").addClass("ui-upload-ative")}else{e(t+" .upload-el").css({left:"auto"});e(t+" .ui-upload-a").removeClass("ui-upload-ative")}},showError:function(t,n){var i=e(t).find(".form-tooltip");i.find(".tips").html(n);i.show();setTimeout(function(){i.fadeOut()},2e3)}};return n});n("module/comment/v3/commentConfig",["tui/cookie"],function(t){var n={commentOpen:false,tabFixed:true,posts:true,tab:{my:true,hot:true,db:true,owner:true,star:true},text:{hotComment:true,at:true,ht:true,star:true},operate:{reply:true,input:true,top:true,inform:true},egg:true,quickreply:true,gift:true,picUpload:true};var i={globals:{userDomain:"//i.youku.com/i/"},init:function(t,i){e.extend(true,n,t);e.extend(true,this.globals,i)},check:function(t,i,a){if(1==arguments.length){i=t;t=true}else if(2==arguments.length&&e.isFunction(i)){a=i;i=t;t=true}if(!t)return false;var o=i.split(".");var s=n[o[0]];if(!s)return false;if(o.length>1&&!s[o[1]])return false;e.isFunction(a)&&a();return true},isJoinCommentTest:function(){if(["307775"].indexOf(this.globals.page.showid)===-1)return false;return 2},getCommentTestSpmConfig:function(t,n,i){var a=this.isJoinCommentTest();if(false===a)return"";if("comment"==t)return"data-spm=comment"+a;var o=e.extend({type:t,showid:this.globals.page.showid,videocode:this.globals.page.videoId2},i);return"data-spm-click=gostr=/yt/ykcomment.play.commentNewAlgorithm;locaid=d"+t+"_"+n+";"+e.param(o)}};return i});n("tui/encrypt/md5",[],function(){function e(e,t){var s=e[0],r=e[1],c=e[2],l=e[3];s=n(s,r,c,l,t[0],7,-680876936);l=n(l,s,r,c,t[1],12,-389564586);c=n(c,l,s,r,t[2],17,606105819);r=n(r,c,l,s,t[3],22,-1044525330);s=n(s,r,c,l,t[4],7,-176418897);l=n(l,s,r,c,t[5],12,1200080426);c=n(c,l,s,r,t[6],17,-1473231341);r=n(r,c,l,s,t[7],22,-45705983);s=n(s,r,c,l,t[8],7,1770035416);l=n(l,s,r,c,t[9],12,-1958414417);c=n(c,l,s,r,t[10],17,-42063);r=n(r,c,l,s,t[11],22,-1990404162);s=n(s,r,c,l,t[12],7,1804603682);l=n(l,s,r,c,t[13],12,-40341101);c=n(c,l,s,r,t[14],17,-1502002290);r=n(r,c,l,s,t[15],22,1236535329);s=i(s,r,c,l,t[1],5,-165796510);l=i(l,s,r,c,t[6],9,-1069501632);c=i(c,l,s,r,t[11],14,643717713);r=i(r,c,l,s,t[0],20,-373897302);s=i(s,r,c,l,t[5],5,-701558691);l=i(l,s,r,c,t[10],9,38016083);c=i(c,l,s,r,t[15],14,-660478335);r=i(r,c,l,s,t[4],20,-405537848);s=i(s,r,c,l,t[9],5,568446438);l=i(l,s,r,c,t[14],9,-1019803690);c=i(c,l,s,r,t[3],14,-187363961);r=i(r,c,l,s,t[8],20,1163531501);s=i(s,r,c,l,t[13],5,-1444681467);l=i(l,s,r,c,t[2],9,-51403784);c=i(c,l,s,r,t[7],14,1735328473);r=i(r,c,l,s,t[12],20,-1926607734);s=a(s,r,c,l,t[5],4,-378558);l=a(l,s,r,c,t[8],11,-2022574463);c=a(c,l,s,r,t[11],16,1839030562);r=a(r,c,l,s,t[14],23,-35309556);s=a(s,r,c,l,t[1],4,-1530992060);l=a(l,s,r,c,t[4],11,1272893353);c=a(c,l,s,r,t[7],16,-155497632);r=a(r,c,l,s,t[10],23,-1094730640);s=a(s,r,c,l,t[13],4,681279174);l=a(l,s,r,c,t[0],11,-358537222);c=a(c,l,s,r,t[3],16,-722521979);r=a(r,c,l,s,t[6],23,76029189);s=a(s,r,c,l,t[9],4,-640364487);l=a(l,s,r,c,t[12],11,-421815835);c=a(c,l,s,r,t[15],16,530742520);r=a(r,c,l,s,t[2],23,-995338651);s=o(s,r,c,l,t[0],6,-198630844);l=o(l,s,r,c,t[7],10,1126891415);c=o(c,l,s,r,t[14],15,-1416354905);r=o(r,c,l,s,t[5],21,-57434055);s=o(s,r,c,l,t[12],6,1700485571);l=o(l,s,r,c,t[3],10,-1894986606);c=o(c,l,s,r,t[10],15,-1051523);r=o(r,c,l,s,t[1],21,-2054922799);s=o(s,r,c,l,t[8],6,1873313359);l=o(l,s,r,c,t[15],10,-30611744);c=o(c,l,s,r,t[6],15,-1560198380);r=o(r,c,l,s,t[13],21,1309151649);s=o(s,r,c,l,t[4],6,-145523070);l=o(l,s,r,c,t[11],10,-1120210379);c=o(c,l,s,r,t[2],15,718787259);r=o(r,c,l,s,t[9],21,-343485551);e[0]=d(s,e[0]);e[1]=d(r,e[1]);e[2]=d(c,e[2]);e[3]=d(l,e[3])}function t(e,t,n,i,a,o){t=d(d(t,e),d(i,o));return d(t<<a|t>>>32-a,n)}function n(e,n,i,a,o,s,r){return t(n&i|~n&a,e,n,o,s,r)}function i(e,n,i,a,o,s,r){return t(n&a|i&~a,e,n,o,s,r)}function a(e,n,i,a,o,s,r){return t(n^i^a,e,n,o,s,r)}function o(e,n,i,a,o,s,r){return t(i^(n|~a),e,n,o,s,r)}function s(t){if(/[\x80-\xFF]/.test(t))t=unescape(encodeURI(t));txt="";var n=t.length,i=[1732584193,-271733879,-1732584194,271733878],a;for(a=64;a<=t.length;a+=64)e(i,r(t.substring(a-64,a)));t=t.substring(a-64);var o=[0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0];for(a=0;a<t.length;a++)o[a>>2]|=t.charCodeAt(a)<<(a%4<<3);o[a>>2]|=128<<(a%4<<3);if(a>55){e(i,o);for(a=0;a<16;a++)o[a]=0}o[14]=8*n;e(i,o);return i}function r(e){var t=[],n;for(n=0;n<64;n+=4)t[n>>2]=e.charCodeAt(n)+(e.charCodeAt(n+1)<<8)+(e.charCodeAt(n+2)<<16)+(e.charCodeAt(n+3)<<24);return t}var c="0123456789abcdef".split("");function l(e){var t="",n=0;for(;n<4;n++)t+=c[15&e>>8*n+4]+c[15&e>>8*n];return t}function m(e){for(var t=0;t<e.length;t++)e[t]=l(e[t]);return e.join("")}function u(e){return m(s(e))}function d(e,t){return 4294967295&e+t}return u});n("module/comment/v3/model",["tui/encrypt/md5","module/domain","module/comment/v3/commentConfig","module/comment/v3/uploadimg","module/comment/v3/utils","tui/cookie","tui/xDomainRequest"],function(t,n,i,a,o,s){var r="//p.comments.youku.com";var c="//js.ykimg.com";var l="//api.hdyy.tudou.com";function m(){if(i.globals.isTestEnv){r="//pre.comments.youku.com";l="//10.25.34.49:8080/int-api";c="//jstest.ykimg.com"}if(window.location.href.indexOf("type=test")>0)r="//ptest.comments.youku.com"}var u=function(e){return t(i.globals.appId+"&"+i.globals.appSecret+"&"+e)};function d(t){var n=0;var i=t.success;var a=t.error;delete t.success;delete t.error;t.success=function(e){if(!e){t.error();return}i&&i.apply(this,Array.prototype.slice.call(arguments))};t.error=function(i){n++;if(n<=0)e.ajax(t);else a&&a.apply(this,Array.prototype.slice.call(arguments))};t.cache="undefined"===typeof t.cache||t.cache;if(!t.jsonpCallback&&"jsonp"==t.dataType.toLocaleLowerCase()){var o=t.url.split("/");t.jsonpCallback="n_"+o[o.length-1].replace(/[^\w]+/g,"_")}e.ajax(t)}function p(){}var f={};var v={add:function(e,t){var n=f[e];if(!n)n=f[e]={loading:false,value:null,queue:[]};n.queue.push(t);if(n.value)this.run(n);return!!(n.loading||n.value)},run:function(e){e.queue.forEach(function(t){t&&t(e.value)});e.loading=false;e.queue=[];setTimeout(function(){e.value=null},6e4)},loading:function(e){f[e]&&(f[e].loading=true)},val:function(e,t){var n=f[e];if(n){n.value=t;this.run(n)}}};var h={submit:function(t,n){try{var i=e.ajaxSettings.xhr();var a=!!i&&"withCredentials"in i;if(!a)o.recordGoldlog("/ykcomment.cmt_submit_type.submitType",{type:window.XDomainRequest?1:0});if(!a&&!window.XDomainRequest){n({code:-99999,message:"您当前浏览器版本过低，请使用更高版本浏览器。"});return}}catch(s){}d({url:r+"/ycp/public/common/add?app="+t.app+"&sign="+t.sign+"&time="+t.time,data:t,dataType:"json",type:"post",contentType:"text/plain",xhrFields:{withCredentials:true},success:function(e){n(e)},error:function(){n({code:-1})}})},commentList:function(e,t){var n="/ycp/comment/pc/commentList";var a=false;if(1===i.isJoinCommentTest()){a=true;n="/ycp/comment/pc/sort/commentList"}d({url:r+n,data:e,dataType:"jsonp",jsonp:"jsoncallback",success:function(e){t&&t(e,a)},error:function(){t({code:-1})}})},getDbComment:function(e,t){d({url:r+"/ycp/comment/pc/getDbComment",data:e,dataType:"jsonp",jsonp:"jsoncallback",success:function(e){t&&t(e)},error:function(e){t({code:-1})}})},replyList:function(e,t){d({url:r+"/ycp/comment/pc/replyList",data:e,dataType:"jsonp",jsonp:"jsoncallback",success:function(e){t&&t(e)},error:function(e){t({code:-1})}})},setTop:function(e,t){d({url:r+"/ycp/comment/pc/setTop",data:e,dataType:"jsonp",jsonp:"jsoncallback",success:function(e){t&&t(e)},error:function(e){t({code:-1})}})},getInfo:function(e,t){d({url:r+"/ycp/comment/pc/getInfo",data:e,dataType:"jsonp",jsonp:"jsoncallback",success:function(e){t&&t(e)},error:function(e){t({code:-1})}})},objectCommentStatus:function(e,t){d({url:r+"/ycp/comment/pc/objectCommentStatus",data:e,dataType:"jsonp",jsonp:"jsoncallback",success:function(e){t&&t(e)},error:function(e){t({code:-1})}})},navigationBar:function(e,t){d({url:r+"/ycp/comment/pc/navigationBar",data:e,dataType:"jsonp",jsonp:"jsoncallback",success:function(e){t&&t(e)},error:function(e){t({code:-1})}})},getPersonInfo:function(e,t){d({url:r+"/ycp/comment/pc/getPersonInfo",data:e,dataType:"jsonp",jsonp:"jsoncallback",success:function(e){if(e&&e.data&&e.data.length>0){var n={};e.data.forEach(function(e){for(var t in e)n[t]=e[t]});e.data=n}t&&t(e)},error:function(e){t({code:-1})}})},getUserComment:function(e,t){d({url:r+"/ycp/comment/pc/getUserComment",data:e,dataType:"jsonp",jsonp:"jsoncallback",success:function(e){t&&t(e)},error:function(e){t({code:-1})}})},updown:function(e,t){d({url:r+"/ycp/comment/pc/updown?utdid="+s("juid"),data:e,dataType:"jsonp",jsonp:"jsoncallback",success:function(e){t&&t(e)},error:function(e){t({code:-1})}})},deleted:function(e,t){d({url:r+"/ycp/comment/pc/delete",data:e,dataType:"jsonp",jsonp:"jsoncallback",success:function(e){t&&t(e)},error:function(e){t({code:-1})}})},tipOffNew:function(e,t){d({url:r+"/ycp/tipOffNew.srv",data:e,dataType:"jsonp",jsonp:"jsoncallback",success:function(e){t&&t(e)},error:function(e){t({code:-1})}})},isNeedVerify:function(e,t){d({url:r+"/ycp/public/verify/isNeedVerify",data:e,dataType:"jsonp",jsonp:"jsoncallback",success:function(e){t&&t(e)},error:function(e){t({code:-1})}})},getVerifyCode:function(e,t){d({url:r+"/ycp/public/verify/getVerifyCode",data:e,dataType:"jsonp",jsonp:"jsoncallback",success:function(e){t&&t(e)},error:function(e){t({code:-1})}})},checkVerifyCode:function(e,t){d({url:r+"/ycp/public/verify/checkVerifyCode",data:e,dataType:"jsonp",jsonp:"jsoncallback",success:function(e){t&&t(e)},error:function(e){t({code:-1})}})},getPicFlag:function(e,t){d({url:r+"/ycp/public/common/getPicFlag.action",data:e,dataType:"jsonp",jsonp:"jsoncallback",success:function(e){t&&t(e)},error:function(e){t({code:-1})}})},mupload:function(e){a.mupload(e,r,c)},quickreply:function(e,t){d({url:l+"/hd/api/comments/quickreply",data:e,dataType:"jsonp",jsonp:"jsoncallback",success:function(e){t&&t(e)},error:function(e){t({code:-1})}})},getPosts:function(e,t){d({url:r+"/ycp/comment/pc/postList",data:e,dataType:"jsonp",jsonp:"jsoncallback",success:function(e){t&&t(e)},error:function(e){t({code:-1})}})},getPostsContent:function(e,t){d({url:r+"/ycp/comment/pc/getPostInfo",data:e,dataType:"jsonp",jsonp:"jsoncallback",success:function(e){t&&t(e)},error:function(e){t({code:-1})}})},getUserInfo:function(e,t){var n="login_getuserinfo";var i=v.add(n,t);if(i)return;v.loading(n);d({url:r+"/ycp/public/common/getUserInfo",data:e,dataType:"jsonp",jsonp:"jsoncallback",success:function(e){v.val(n,e)},error:function(e){t({code:-1})}})},getActivityInfo:function(e,t){d({url:r+"/ycp/public/common/getActivityRole",data:e,dataType:"jsonp",jsonp:"jsoncallback",success:function(e){t&&t(e)},error:function(e){t({code:-1})}})},addActivityName:function(e,t){d({url:r+"/ycp/public/common/addActName",data:e,dataType:"jsonp",jsonp:"jsoncallback",success:function(e){t&&t(e)},error:function(e){t({code:-1})}})}};var g={web_cms_module_pv:function(e,t){d({url:"//p.l.youku.com/web_cms_module_pv",data:e,dataType:"jsonp",jsonp:"__callback",success:function(e){t(e)}})},hasGiftForComment:function(e,t){d({url:"//www.youku.com/QVideo/~ajax/hasGiftForComment",dataType:"jsonp",jsonp:"__callback",data:{__ap:JSON.stringify(e)},success:function(e){t(e)}})},getUinfo:function(e){var t="login_getuinfo";var n=v.add(t,e);if(n)return;v.loading(t);d({url:"//lv.youku.com/api/grade/get_uinfo",dataType:"jsonp",success:function(e){v.val(t,e)}})},show_valid:function(e){var t="show_valid";var n=v.add(t,e);if(n)return;v.loading(t);d({url:"http://vip.youku.com/member/show_valid_member.jsonp?version=2",dataType:"jsonp",success:function(e){v.val(t,e)}})}};var b={load:d,createCrossIframe:p,switchEnv:m};for(var y in h){if(!e.isFunction(h[y]))continue;!function(t){b[t]=function(n,a){if(!n)n={};if(e.isFunction(n)){a=n;n={}}var o=~~(Date.now()/1e3);n.app=i.globals.appId;n.sign=u(o);n.time=o;return h[t](n,a)}}(y)}e.extend(b,g);return b});n("module/comment/v3/commentLogin",["tui/event","tui/cookie","module/comment/v3/model"],function(t,n,i){var a=e.extend(new t,{_userInfo:null,isLogin:function(){var e=decodeURIComponent(n("P_gck")||"").split("|")[1];return!!(n("yktk")||e&&"NA"!==e||0)},uid:function(){var e=this.getUserInfo()||{};return e.yid||e.userId||0},getUserInfo:function(){return this._userInfo},login:function(t){var n=this;n.unbind(".loginoncecallback").one("login:after.loginoncecallback",t);e.isFunction(n.loginFunc)&&n.loginFunc(function(){n.trigger("login:success")});return n},init:function(){this._loadUserInfo()},_loadUserInfo:function(){var e=this;if(!e.isLogin())return;i.getUserInfo(function(t){if(0!=t.code)return;e._userInfo=t.data;e.trigger("login:after",[t.data])})}});a.bind("login:success",function(){a._loadUserInfo()});return a});n("module/cms/dataStore",["tui/event"],function(t){var n;var i=t.extend({initialize:function(e){var t=this;i.superClass.initialize.call(t);t.fetch(e)},get:function(e){if(!this.storage)return null;return this.storage[e]||null
},fetch:function(t){var n=this;var i=e.ajax({url:"//cmstool.youku.com/cms/tool/pub/get_putdata.json?securemode=2",data:t,dataType:"jsonp"});i.done(function(e){n.storage=e.data})}});i.getInstance=function(e){if(n)return n;else return n=new i(e)};return i});n("tui/view",["tui/event"],function(t){var n="ontouchstart"in window||navigator.maxTouchPoints>0||navigator.msMaxTouchPoints>0;var i=0;var a;var o=".delegateEvents";var s=function(n){this.clsid=i++;this._configure(n||{});this._ensureElement();this.initialize.apply(this,arguments);this.delegateEvents();e.extend(this,new t)};var r={};var c=["el","id","attrs","className","tagName","model"];var l=/^(\S+)\s*(.*)$/;e.extend(s.prototype,{tagName:"div",initialize:function(){},render:function(){return this},get:function(e){return r[e]||null},find:function(e){return this.$el.find(e)},remove:function(){this.$el.remove();this.undelegateEvents();this.unbind();return this},create:function(t,n,i){var a=document.createElement(t);if(n)e(a).attr(n);if(i)e(a).html(i);return a},setElement:function(t,n){if(this.$el)this.undelegateEvents();this.$el=t instanceof e?t:e(t);this.el=this.$el[0];if(false!==n)this.delegateEvents();return this},delegateEvents:function(t){if(!(t||(t=this.events)))return;this.undelegateEvents();for(var n in t){var i=t[n];if(!e.isFunction(i))i=this[t[n]];if(!i)continue;var a=n.match(l);var s=a[1],r=a[2];i=i.bind(this);s=this._ensureTouch(s,r);s+=o+this.clsid;if(""===r)this.$el.on(s,i);else this.$el.on(s,r,i)}return this},undelegateEvents:function(e,t){var e=e?this._ensureTouch(e):"";this.$el.off(e+o+this.clsid,t);return this},modelEvents:function(t,n){n="{"+(e.trim(n)||"mod")+"} ";for(var i in this)if(0===i.indexOf(n))t.bind(i.slice(n.length),this[i],this)},_configure:function(t){if(this.options)t=e.extend({},this.options,t);for(var n=0,i=c.length;n<i;n++){var a=c[n];if(t[a])this[a]=t[a]}this.options=t},_ensureElement:function(){if(this.el)this.setElement(this.el,false);else{var e=this.attrs||{};if(this.id)e.id=this.id;if(this.className)e["class"]=this.className;this.setElement(this.create(this.tagName,e),false)}},_ensureTouch:function(e,t){if(n&&window.tudouClickStat){if(("click"==e||"tap"==e||"singleTap"==e)&&""!==t){var i=e+o+this.clsid;this.$el.on(i,t,function(e){if(!tudouClickStat.getStatTarget(e.target)){if(void 0===e.pageX)e.pageX=e.pageY=0;if(a)clearTimeout(a);a=setTimeout(function(){tudouClickStat.send(e,{},function(){},true)},10)}})}return e}switch(e){case"tap":case"singleTap":return"click";case"doubleTap":return"dblclick"}return e},_clearTimer:function(){var e=arguments;for(var t=0,n=e.length;t<n;t++){var i=e[t];if(i){clearTimeout(i);clearInterval(i)}}return null}});s.create=function(e,t){if(e&&!r[e])return r[e]=new this(t);return new this(t)};s.instance=function(e,t){if(e&&!r[e])return r[e]=t;return r[e]||null};s.destroy=function(e){if(e){if(r[e]){r[e].remove();delete r[e]}}else for(var t in r)arguments.callee(t)};s.extend=function(t,n){var i=this;var a=function(){i.apply(this,arguments)};e.extend(a,i,n);var o=function(){this.constructor=a};o.prototype=i.prototype;a.prototype=new o;e.extend(a.prototype,t);a.superClass=i.prototype;return a};return s});n("module/comment/v3/cmtegg",["tui/view","module/cms/dataStore"],function(t,n){var i=t.extend({initialize:function(e){var t=this;var i=e.params;t.modelEvents(e.form,"form");t.dataStore=n.getInstance(i)},boom:function(t,n){var i=this;var a=e(window).scrollTop()-222;var o=e("#videoCommentlist .comment-list-main");if(o.length>0)a=o.offset().top-300;if("png"==n||"gif"==n){var s='<img src="'+t+'">';i.$egg=e('<div style="z-index:99;position:absolute;left:50%;margin-left:-430px;top:50%; margin-top:'+a+'px;width:860px;height:444px;background:transparent;">'+s+"</div>");e(document.body).append(i.$egg)}else{var r='<object type="application/x-shockwave-flash" data="'+t+'" width="100%" height="100%"><param name="wmode" value="transparent"><param name="movie" value="'+t+'" width="100%" height="100%"><embed src="'+t+'" width="100%" height="100%" border="0" align="center" wmode="transparent"></object>';i.$egg=e('<div style="z-index:99;position:absolute;left:50%;margin-left:-430px;top:50%; margin-top:'+a+'px;width:860px;height:444px;background:transparent;">'+r+"</div>");e(document.body).append(i.$egg)}setTimeout(function(){i.$egg.remove()},11e3)},"{form} submit:success":function(e){var t=this;var n=t.dataStore.get("comment");if(!n)return;var i=n[0];if(i)n=n[0];else n=n.show?n.show:n.folder;if(n&&n.content.length>0){var a=JSON.parse(n.content);if(!a||a.length<=0)return;for(var o=0,s=a.length;o<s;o++){if(a[o].keywordContent.length<=0)continue;var r=new RegExp(a[o].keywordContent.replace(",","|"));if(r.test(e.params.content)){t.boom(a[o].keywordlink,a[o].keywordtype);break}}}}});return i});n("module/comment/v3/commentImage",["tui/art","tui/dialog","module/comment/v3/model","tui/view"],function(t,n,i,a){var o=t.compile('<% if(picList && picList.length > 0) { %>\n<div class="comment-image">\n<div class="comment-img-view" style="display:none">\n<div class="comment-img-stage">\n<span class="smallcursor" data-count="<%=picList.length%>" data-index="0">\n<img alt="" />\n</span>\n<i node-type="loading" class="W_loading"></i>\n</div>\n<div class="comment-img-choose fix">\n<ul class="fix">\n<%picList.forEach(function(pic,i){%>\n<li data-index="<%=i%>">\n<a class="<%if(i==0){%>active<%}%>" href="javascript:;">\n<img src="<%=pic.picUrl%>?x-oss-process=image/format,jpg/resize,m_fill,h_100,w_100"  data-msrc="<%=pic.picUrl%>" data-width="<%=pic.width%>" data-height="<%=pic.height%>">\n</a>\n</li>\n<%})%>\n</ul>\n</div>\n</div>\n<% var isShowBig = !(picList.length == 1 && picList[0].width<300 && picList[0].height<300); %>\n<div class="comment-img-list">\n<ul class="fix comment-img-<%=picList.length%> <%if(isShowBig){%>bigcursor<%}%>">\n<%picList.forEach(function(pic,i){%>\n<li class="li_<%=i%>" data-index="<%=i%>">\n<%if(picList.length==1){%>\n<img src="<%=pic.picUrl%><%if(isShowBig){%>?x-oss-process=image/format,jpg/resize,m_lfit,h_300,w_300<%}%>">\n<%}else{%>\n<img src="<%=pic.picUrl%>?x-oss-process=image/format,jpg/resize,m_fill,h_100,w_100">\n<%}%>\n<%if(pic.picUrl.indexOf(\'.gif\')>0){%>\n<span class="gif-icon">GIF</span>\n<%}%>\n</li>\n<%})%>\n</ul>\n</div>\n</div>\n<% } %>');var s=a.extend({initialize:function(e){},render:function(e){return o(e||{})},events:{"click .comment-image .comment-img-list li":"txtpic","click .comment-image .comment-img-choose li":"txtpicslid","click .comment-image .comment-img-stage span":"txtpicsmallck","mousemove .comment-image .comment-img-stage span":"txtpicsmallms"},txtpic:function(t){var n=this;var i=e(t.currentTarget);if(!i.closest("ul").hasClass("bigcursor"))return;var a=i.closest(".comment-image");a.find(".comment-img-list").hide();a.find(".comment-img-view").show();n.imgloadfn(i,i.index())},txtpicslid:function(t){var n=this;var i=e(t.currentTarget);n.imgloadfn(i,i.index())},txtpicsmallck:function(t){var n=this;var i=e(t.currentTarget);var a=i.closest(".comment-image");var o=parseInt(i.data("index"),10);var s=parseInt(i.data("count"),10);if(i.hasClass("leftcursor"))o>0&&n.imgloadfn(i,o-1);else if(i.hasClass("rightcursor"))o<s-1&&n.imgloadfn(i,o+1);else if(i.hasClass("smallcursor")){a.find(".comment-img-list").show();a.find(".comment-img-view").hide()}},txtpicsmallms:function(t){var n=e(t.currentTarget);var i=parseInt(n.data("index"),10);var a=parseInt(n.data("count"),10);var o=n.width();if(t.offsetX<.33*o){if(!n.hasClass("leftcursor")&&i>0)n.removeClass("rightcursor smallcursor").addClass("leftcursor")}else if(t.offsetX>.66*o){if(!n.hasClass("rightcursor")&&i<a-1)n.removeClass("leftcursor smallcursor").addClass("rightcursor")}else if(!n.hasClass("smallcursor"))n.removeClass("rightcursor leftcursor").addClass("smallcursor")},imgloadfn:function(e,t){var n=e.closest(".comment-image");var i=n.find(".comment-img-choose li");var a=i.eq(t);var o=n.find(".comment-img-stage span");var s=o.find("img");if(i.length>1){i.removeClass("active");a.addClass("active")}else i.hide();var r=a.find("img");var c=imgW=r.data("width");var l=imgH=r.data("height");var m=r.data("msrc");if(m){if(Math.max(c,l)>=600){var u=c>=l;var d=(u?c:l)/600;if(u){c=600;l=Math.floor(l/d)}else{c=Math.floor(c/d);l=600}}o.addClass("comment-img-loading").css({width:c>100?c:100,height:l>100?l:100});s.hide();var p="?x-oss-process=image/resize,w_200";if(imgW<600)if(imgH<600)if(imgW>imgH){p="?x-oss-process=image/resize,w_"+imgW;if(imgH<200)p="?x-oss-process=image/resize,h_200"}else{p="?x-oss-process=image/resize,w_"+imgW;if(imgH<200)p="?x-oss-process=image/resize,h_200"}else p="?x-oss-process=image/resize,w_600";else if(imgW>=600)if(imgH<600){p="?x-oss-process=image/resize,w_600";if(imgH<200)p="?x-oss-process=image/resize,m_lfit,w_600,h_200"}else p="?x-oss-process=image/resize,w_600";m+=p;var f=new Image;f.onload=function(){s.attr("src",m).show();o.removeAttr("style").removeClass("comment-img-loading").data("index",t);if(t<=0||t>=i.length-1)o.removeClass("rightcursor leftcursor").addClass("smallcursor")};f.src=m}}});return s});n("module/comment/v3/commentToolbar",["tui/art","tui/view","tui/dialog","module/comment/v3/model","module/comment/v3/commentConfig","module/comment/v3/commentLogin"],function(t,n,i,a,o,s){var r=Array.prototype.slice;var c=t.compile('<div class="comment-handle">\n<%if(showUp){%>\n<a href="javascript:;" data-id="<%=id%>" class="comment-handle-btn comment-handle-up" <%=getSpmConfig(\'top\')%> ><%=upCount || \'\'%></a>\n<%}%>\n<%if(showDown){%>\n<a href="javascript:;" data-id="<%=id%>" class="comment-handle-btn comment-handle-down" <%=getSpmConfig(\'down\')%> ><%=downCount || \'\'%></a>\n<%}%>\n<%if(showReply){%>\n<a href="javascript:;" data-id="<%=id%>" data-uid="<%=userId%>" class="comment-handle-btn comment-handle-reply" <%=getSpmConfig(\'commentreplyicon\')%> ><%if(replyCount>0){%>(<%=replyCount%>)<%}%></a>\n<%}%>\n<%if(showSubReply){%>\n<a href="javascript:;" data-id="<%=id%>" data-uname="<%=userName%>" class="comment-handle-btn comment-handle-subreply">回复</a>\n<%}%>\n<%if(canDelete && showDelete){%>\n<a href="javascript:;" data-id="<%=id%>" class="comment-handle-btn comment-handle-delete">删除</a>\n<%}%>\n<%if(canSetTop && showSetTop){%>\n<a href="javascript:;" data-id="<%=id%>" class="comment-handle-btn comment-handle-top"><%=isTop ? \'取消置顶\' : \'置顶\'%></a>\n<%}%>\n<%if(showInform){%>\n<a href="javascript:;" data-id="<%=id%>" class="comment-handle-btn comment-handle-inform">举报</a>\n<%}%>\n</div>');var l=n.extend({initialize:function(t){var n=this;n.objectInfo=t.objectInfo;n.items=e.extend({showUp:false,showDown:false,showReply:false,showSubReply:false,showDelete:false,showSetTop:false,showInform:false},t.items);["commentUp","commentDown","commentDelete","commentTop","commentReply","commentReplySub","commentDeleteCallback","commentTopCallback"].forEach(function(i){e.isFunction(t[i])&&(n[i]=t[i])})},render:function(t,n){t=e.extend({id:0,upCount:0,downCount:0,replyCount:0,userId:0,userName:"",isTop:false,canSetTop:false,canDelete:false,getSpmConfig:function(e){return o.getCommentTestSpmConfig(e,t.id)}},this.items,t,n);if(!o.check("operate.top"))t.showSetTop=false;return c(t)},events:{"click .comment-handle .comment-handle-up":"commentUp","click .comment-handle .comment-handle-down":"commnetDown","click .comment-handle .comment-handle-reply":"commentReply","click .comment-handle .comment-handle-subreply":"commentReplySub","click .comment-handle .comment-handle-delete":"commentDelete","click .comment-handle .comment-handle-inform":"commentInform","click .comment-handle .comment-handle-top":"commentTop"},commentUp:function(e){this.setSupport(e.target,1,"顶",".comment-handle-down");return false},commnetDown:function(e){this.setSupport(e.target,2,"踩",".comment-handle-up");return false},setSupport:function(t,n,i,o){var c=this;var l=s.isLogin();if(!l){var m=r.call(arguments);s.login(function(){c.setSupport.apply(c,m)});return}var u=e(t);if(u.hasClass("active"))return;var d=u.siblings(o);var p=u.data("id");var f=parseInt(u.text(),10)||0;a.updown({app:"pc",type:n,commentId:p,objectId:c.objectInfo.objectId,objectType:c.objectInfo.objectType},function(e){switch(parseInt(e.code,10)){case 0:d.removeClass("active");u.text(f+1).addClass("active");break;case 1:if(f<=0)f=1;d.removeClass("active");u.text(f+"您已经"+i+"过了").addClass("active");break;case 2:var t=(parseInt(d.text(),10)||0)-1;d.text(t>0?t:"").removeClass("active");u.text(f+1).addClass("active")}})},commentReplySub:function(e){return false},commentReply:function(e){return false},commentDelete:function(t){var n=this;var s=e(t.target);var r='<div style="text-align:center;"><div class="title"><i class="icon icon-prompt-warning"></i><span>你确定要删除该评论吗</span></div><p class="prompt">如果该评论下有其他回复也将一起删除</p></div>';var c=s.parent();new i({target:o.check("commentOpen")?c:null,hasMask:!o.check("commentOpen"),width:300,zIndex:20010,content:r,className:"yk-prompt-dialog",buttons:[{className:"prompt-btn prompt-btn-primary",name:"删 除",callback:function(r){r.preventDefault();var l=s.data("id");a.deleted({app:"pc",commentId:l,objectId:n.objectInfo.objectId,objectType:n.objectInfo.objectType},function(a){if(0==a.code){i.alert({target:o.check("commentOpen")?c:null,hasMask:!o.check("commentOpen"),zIndex:20010,content:"删除成功"});e.isFunction(n.commentDeleteCallback)&&n.commentDeleteCallback(l,t)}else i.alert({target:o.check("commentOpen")?c:null,hasMask:!o.check("commentOpen"),zIndex:20010,content:"删除失败，请重试"})});this.close()}},{className:"prompt-btn",name:"取消",callback:function(e){e.preventDefault();this.close()}}]});return false},commentTop:function(t){var n=this;var r=e(t.target);var c=r.parent();var l=s.isLogin();if(!l){s.login(function(){n.commentTop(t)});return}if(n.submit)return;n.submit=true;var m={app:"pc",objectId:n.objectInfo.objectId,objectType:n.objectInfo.objectType,commentId:r.data("id"),type:"置顶"==r.text()?1:2};a.setTop(m,function(a){n.submit=false;if(0!=a.code){i.alert({target:o.check("commentOpen")?c:null,hasMask:!o.check("commentOpen"),zIndex:20010,content:a.message});return}i.alert({target:o.check("commentOpen")?c:null,hasMask:!o.check("commentOpen"),zIndex:20010,content:"操作成功！"});r.text(1==m.type?"取消置顶":"置顶");e.isFunction(n.commentTopCallback)&&n.commentTopCallback(t)});return false},commentInform:function(t){var n=this;var s=e(t.currentTarget);var r=s.parent();var c='<div><div class="title"><span>匿名举报不会对您有任何影响，请选举举报原因：</span></div>'+'<p class="prompt">'+'<input type="radio" name="tip" value="1" id="gg"><label for="gg" class="prompt_rad">广告</label>'+'<input type="radio" name="tip" id="sq" value="2"><label for="sq" class="prompt_rad">色情</label>'+'<input type="radio" name="tip" id="mm" value="3"><label for="mm" class="prompt_rad">骚扰谩骂</label>'+'<input type="radio" name="tip" id="dy" value="4"><label for="dy" class="prompt_rad">地域攻击</label>'+'<input type="radio" name="tip" id="ey" value="5"><label for="ey" class="prompt_rad">恶意灌水</label>'+'<input type="radio" name="tip" id="qt" value="6"  checked="checked"><label for="qt" class="prompt_rad">其他</label>'+"</p>"+'<p class="prompt"><textarea class="defaultext" name="content" placeholder="请输入举报原因（至少5个字）！"></textarea></p></div>';new i({target:o.check("commentOpen")?r:null,hasMask:!o.check("commentOpen"),width:580,content:c,className:"yk-prompt-dialog yk-tip-dialog ",title:"举报",buttons:[{className:"prompt-btn prompt-tip-primary",name:"提交",callback:function(t){t.preventDefault();var c=s.data("id");var l="6";var m=e(".yk-tip-dialog .defaultext").val();e(".yk-tip-dialog input[name=tip]").each(function(){if(this.checked)l=e(this).val()});var u={app:"pc",objectId:n.objectInfo.objectId,objectType:n.objectInfo.objectType,commentId:c,memo:m,reason:l};if(!m){i.alert({target:o.check("commentOpen")?r:null,hasMask:!o.check("commentOpen"),zIndex:20010,content:"请填写举报原因"});return false}a.tipOffNew(u,function(e){if("0"==e.code){var t=i.alert({target:o.check("commentOpen")?r:null,hasMask:!o.check("commentOpen"),zIndex:20010,content:"提交成功，请等待客服审核"});setTimeout(function(){t.close()},1e3)}});this.close()}},{className:"prompt-btn prompt-close",name:"取消",callback:function(e){e.preventDefault();this.close()}}]});return false}});return l});n("module/comment/v3/giftarea",[],function(){"use strict";var t={getUserPageLink:function(e){if(!e||!uc_domain||"function"!=typeof encodeUid)return-1;return"//"+uc_domain+"/u/"+encodeUid(e)},PlayerPause:function(){return t.PlayerController(1)},PlayerStart:function(){return t.PlayerController(0)},playerShow:function(){if(!_player())return-1;_player().style.height="100%";_player().style.width="100%"},playerHide:function(){if(!_player())return-1;_player().style.height="0px";_player().style.width="0px"},PlayerController:function(e){if("function"==typeof PlayerPause){PlayerPause(e);return}return-1},islogin:function(){return islogin()},VideoOwner:function(){if(!video_owner)return-1;return video_owner},giftPannelSetContent:function(e,t,n){if(!e&&!t&&!jQuery("#giftForCommentPannel"))return-1;if(n)jQuery("#giftForCommentPannel").append('<img class = "YK_interact_plugins_container_lazyLodingImg"  src = "'+n+'" />');if("function"==typeof e)e(t)},giftPannelHide:function(){return giftForComment.hidePannel()},qwindowSetContent:function(e,t,n){if(!e&&!t)return-1;if(!this.qwindow)this.qwindowInit();var i=n?'<img src = "'+n+'" />':"";this.qwindow.setContent("html",'<div id= "giftWindowForPay" style = "height:100%; width:100%; background:#FFF;">'+i+"</div>");if("function"==typeof e)e(t)},qwindowShow:function(){if(!this.qwindow)this.qwindowInit();this.qwindow.hideHandle();this.qwindow.dom.winbg.className="";this.qwindow.show()},qwindowHide:function(){if(!this.qwindow)return-1;this.qwindow.hide()},qwindowDestroy:function(){if(!this.qwindow)return-1;this.qwindow.destroy()},changeWindowSize:function(e,t){this.windowsize.width=e;this.winbdow.height=t},qwindow:false,windowsize:{width:200,height:200},qwindowInit:function(){if(!this.qwindow)this.qwindow=new Qwindow({size:{width:this.windowsize.width,height:this.windowsize.height},content:{type:"html",value:""}});return},commitComment:function(n){if(jQuery("#verify_code_value").is(":visible")){e("content").value=n;return false}if(!e("content"))return-1;if(!n)return-2;t.CommentStorate=n;var i=window.videoId;var a=n.replace("：",":");e("content").focus();var o=e("content").value;e("content").value=a;pre="";try{var s="4000481";if(2==parseInt(playmode))s="4000495";if(3==parseInt(playmode))s="4000488"}catch(r){}var c="1_1";if(2==parseInt(playmode))c="1_7";if(3==parseInt(playmode))c="1_4";window.flagId="";window.is_quote=true;var l="";Nova.QComments.comment({videoId:i,content:a,verify_code:l,reply_cid:"",soure_id:"",log_source_id:c,cmt_type:5,sync_ucenter:0,sync_renren:0,sync_sina:0,sync_tencent:0,sync_messenger:0,sync_qzone:0,sync_kaixin:0},t.commentsCallBack);VideoComments.isInputting=false;if(o)e("content").value=o;jQuery("content").blur();return false},CommentStorate:"",PayState:false,getPayState:function(){return t.PayState},setPayState:function(e){t.PayState=e;return e},verify_code_comment:function(){if(t.getPayState()&&jQuery("#verify_code_img").is(":visible"))return jQuery("#verify_code_img").clone();return false},commentsCallBack:function(n,i){if(!isNaN(n)){if(n<0){if(""!=t.CommentStorate){e("content").value=t.CommentStorate;jQuery("content").blur()}return}}else{if(null==n){e("content").value=t.CommentStorate;jQuery("content").blur();return}window.commentsCallBack(n,i)}},gotGiftBtn:function(){if(jQuery("#giftForCommentTab a").length+jQuery("#giftForCommentPannel").length<2)return-1;if(!jQuery("#commentAction"))return-2;var e=jQuery("#commentAction").offset().top-300;var t={scrollTop:e};jQuery("html,body").animate(t,1e3)}};return t});n("module/comment/v3/gift",["tui/view","tui/art","tui/util","module/comment/v3/model","module/comment/v3/giftarea","module/comment/v3/commentConfig"],function(t,n,i,a,o,s){var r={1:"103",2:"101",3:"100",4:"104",5:"102"};var c=t.extend({initialize:function(){var t=this;var n=t.page=s.globals.page;if(!n||!n.videoOwner)return;if(e("#ck_giftForComment").length>0)return;t.owner=n.videoOwner;a.hasGiftForComment({owner:n.videoOwner},function(e){t.giftForCommentShow(e)})},events:{"click #ck_giftForComment":"showAndHidePannel"},showAndHidePannel:function(t){var n=this;var i=e(t.currentTarget);if(i.hasClass("show")){n.hidePannel();return}var a=e("#commentAction .comment-form .form-user-avatar").outerWidth(true);var o=e("#giftForCommentPannel");o.css({"margin-left":a});i.addClass("show");o.show();if(!n.gifts)n.gifts=new window.YOUKU.API.Interact.GiftModule("6a4afb296a89b285",n.owner,o,e("#player")[0],function(){},function(){n.hidePannel()},"1"==n.page.playmode?7:6,function(){},{pvid:n.page.videoId,showId:n.page.showid,pageType:r[n.page.playmode]});if(n.gifts)n.gifts.sendShowTracking()},hidePannel:function(){e("#ck_giftForComment").removeClass("show");e("#giftForCommentPannel").hide()},giftForCommentShow:function(t){var n=this;if(t<0)return-1;if(t.haveGiftForComment){var i=e('<div class="form-cell form-gift"><a id="ck_giftForComment" href="javascript:;"></a></div><div id="giftForCommentPannel" class="form-gift-content"></div>');e("#commentAction .comment-form").append(i);n.setElement(i,true);window.__define=window.define;window.define=null;e.ajax({url:"//hudong.pl.youku.com/jsapi/interact/giftModule.js?_="+(new Date).toLocaleDateString().replace(/[\/-]/g,"_"),cache:false,dataType:"script",success:function(){window.define=window.__define;window.__define=null}})}}});return c});n("module/comment/v3/submit",["tui/view","tui/net","module/comment/v3/model","module/comment/v3/commentConfig","module/comment/v3/commentLogin"],function(t,n,i,a,o){var s={0:"发送成功。","-1":"服务器开小差，请稍后在试。","-2":"服务器开小差，请稍后在试。","-3":"服务器开小差，请稍后在试。","-4":"你没有操作权限，有疑问请联系客服400 810 0580","-5":"你的手速太快啦，亲稍后再试","-7":"您的评论含有网站禁止内容，请修改，谢谢！","-8":"内容不能为空。","-9":"请输入验证码","-10":"验证码输入错误，请重新输入。","-11":"请将文字减少到300字以内。","-12":"您还未购买本节目，请购买观看后再发表评论。","-13":"当前视频不存在。","-14":"当前视频被设置为禁止评论。","-20":"试图伪造明星评论被禁止，请重试","-30":"请输入回复内容后再发布","-100":"请先登录。","-400":"您已经发表了该评论，谢谢！","-450":"您的评论含有网站禁止内容，请修改，谢谢！","-130":"当前用户被禁止发布评论。","-131":"当前视频被禁止评论。","-2004":"服务器开小差，请稍后在试。","-2006":"评论内容包含不恰当内容，请修改。","-2007":"你被禁言了，有疑问请联系客服400 810 0580","-2082":"验证码输入错误，请重新输入。","-2008":"该视频禁止评论"};var r=t.extend({initialize:function(e){var t=this;t.playmode=e.playmode;t.$ta=t.find("textarea")},events:{},checkCommentsContent:function(){var t=this;var n=e.trim(t.$ta.val());var i=t.$el.find(".form-wordlimit .input-count").text();if("0"==i){t.showError(s[-8]);return false}var a=n.replace(/^回复 @.*?:/,"").replace(/(\r\n|\n|\r|\s)/g,"--").length;if(a<1||a>parseInt(t.$ta.data("maxlength"))){t.showError(s[a<1?-8:-11]);return false}var o=t.$el.find(".form-validate");var r=o.find(".verify_code_value").val();if("none"!==o.css("display")&&r.length<3){t.showError(s[-9]);return false}return true},commentNew:function(t,n){var r=e.extend({},t);var c=this;if(!o.isLogin()){o.login(function(){c.commentNew(t)});return false}var l=r.commentId||"";var m=r.sourceCommentId||"";var u=r.objectId||a.globals.page.videoId;var d=r.objectType||1;var p=r.picUploadId||"comment";var f=r.flag;if(!c.checkCommentsContent())return false;if(c.isSubmiting){c.showError("正在提交！");return}var v=e.trim(c.$ta.val());var h=v.replace(/^回复 @.*?[:：]/,"");var g=f?"":0;var b=c.$el.find(".verify_code_value").val();var y=c.$el.find(".verify_code_value").attr("key");t={app:"pc",objectId:u,objectType:d,content:h,source:a.globals.commentSource};if(l){t.commentId=l;if(0===g)t.flag=g;if(m)t.sourceCommentId=m}if(b){t.captchaCode=b;t.captchaKey=y}c.isSubmiting=true;var w=e("."+p+"FormContent .cont-imgitem ul li");c.picList=[];if(w.length>0){t.picUrl="";w.each(function(n){if(n<9){if(w.length-1==n)t.picUrl+=e(this).attr("data-src");else t.picUrl+=e(this).attr("data-src")+",";c.picList.push(JSON.parse(e(this).attr("data-arr")))}})}setTimeout(function(){c.isSubmiting=false},1e4);i.submit(t,function(n){c.isSubmiting=false;if(0==n.code){n.data=c.data;n.params=t;n.params.content=v;n.picList=c.picList;c.trigger("success",[n]);c.showError(s[0]);w.remove();e("."+p+"FormContent .form-textarea-picdom").removeClass("form-textarea-pic").find("textarea").css({height:"auto"});e("."+p+"FormContent .upload-el").css({left:"auto"});e("."+p+"FormContent .ui-upload-a").removeClass("ui-upload-ative")}else if(n.code==-6001)window.ykPlyr.trigger("authenPhone",["authenFromComment",{url:n.data.url,wrap:c.find(".comment-form"),cancleCb:function(){c.showError("未绑定手机，发送失败。")},authenCb:function(){}}]);else{c.showError(s[n.code]||n.message);c.trigger("error",[]);return false}})},setVipGrade:function(e){var t=this;t.data=e},showError:function(e){var t=this.$el.find(".form-tooltip");t.find(".tips").html(e);t.show();setTimeout(function(){t.fadeOut()},2e3)}});return r});n("tui/countTextArea",["tui/event"],function(t){var n=/MSIE 9/i.test(navigator.userAgent);function i(e,t){var n=t.val();e.trigger("input",[n.length,parseInt(t.attr("data-maxlength"))])}var a=t.extend({initialize:function(t){var o=this;a.superClass.initialize.apply(o,arguments);if("string"==e.type(t))t=e(t);if(window.addEventListener){t.bind("input",function(){i(o,t)});if(n)t.bind("keydown cut paste",function(e){switch(e.type){case"keydown":if(46!=e.keyCode&&8!=e.keyCode)return;default:setTimeout(function(){i(o,t)},0)}})}else t.bind("propertychange",function(){i(o,t)})}});return a});n("tui/placeholder_dom",["tui/event"],function(t){var n=t.extend({initialize:function(t,i,a){var o=this;n.superClass.initialize.call(this);i=i||"";a=e.extend({left:4,top:2},a);var s=e(t);var r=e('<span class="ui-placeholder" data-role="placeholder">'+i+"</span>");r.css({position:"absolute",left:s[0].offsetLeft+a.left,top:s[0].offsetTop+a.top});s.parent().append(r);s.focus(function(){r.hide()}).blur(function(){if(""==s.val())r.show()});s.bind("input propertychange",function(){r[""==s.val()?"show":"hide"]()});r.click(function(e){s.focus()});r[""==s.val()?"show":"hide"]();o.input=s;o.txt=i;o.element=r},changeTxt:function(e){this.txt=e||"";this.element.text(this.txt)},getTxt:function(){return this.txt}});n.isSupport=function(){var e=document.createElement("input");return"placeholder"in e};return n});n("tui/autolinetextarea",["tui/event","tui/art"],function(t,n){var i=e.support.boxModel&&e.support.leadingWhitespace;var a=e("<div>");var o=t.extend({initialize:function(t,s,r){var c=this,l=s;o.superClass.initialize.apply(c,arguments);e(document.body).append(a);a.css({position:"absolute","white-space":"pre-wrap",top:0,left:"-99999em",width:t.width(),"font-family":t.css("font-family"),"line-height":t.css("line-height"),"font-size":t.css("font-size")});if(void 0===s)s=t.height();function m(e){a.html(n.helpers.$escape(t.val()).replace(/\n/g,"<br/>&nbsp;"));var i=a.height();if(t.parent().hasClass("form-textarea-pic"))s=168;else s=l;if(void 0!==s)i=Math.max(s,i);if(void 0!==r)i=Math.min(r,i);t.css("height",i)}if(window.addEventListener){t.bind("input",m);if(i)t.bind("keydown cut paste",m)}else t.bind("keydown contextmenu",m)}});return o});n("tui/edittextarea",["tui/class"],function(t){var n=t({initialize:function(t){if("string"==e.type(t))t=e(t);this.ta1=t},getCursor:function(){var e=this.ta1[0];if(!document.selection)return e.selectionStart;var t=document.selection.createRange(),n=document.body.createTextRange();n.moveToElementText(e);for(var i=0;n.compareEndPoints("StartToStart",t)<0;i++)n.moveStart("character",1);return i},getSelection:function(){var e=this.ta[0],t,n,i;if(!document.selection){t=e.selectionStart;n=e.selectionEnd;return{start:t,end:n,text:e.value.substring(t,n)}}var a=document.selection.createRange(),o=document.body.createTextRange();o.moveToElementText(e);i=a.text;if(!i)return{start:0,end:0,text:""};for(t=0;o.compareEndPoints("StartToStart",a)<0;t++)o.moveStart("character",1);return{start:t,end:t+i.length,text:i}},setCursor:function(e,t){var n=this.ta1[0];e=e||0;t=t||e;try{if(n.setSelectionRange){n.focus();n.setSelectionRange(e,t)}else if(n.createTextRange){range=n.createTextRange();range.collapse(true);range.moveEnd("character",t);range.moveStart("character",e);range.select()}}catch(i){}},insert:function(e,t){var n=this.ta1[0],i=this.ta1.val();t=void 0!==t?t:this.getCursor(n);if(void 0===t)t=i.length;n.focus();if(!document.selection){this.ta1.val(i.substr(0,t)+e+i.substr(t,i.length-t));this.setCursor(t+e.length)}else{var a=document.selection.createRange();a.text=e}}});return n});n("module/comment/v3/face",[],function(){var e={data_vip:{"万万表情":{"绑架":"w_bangjia","不赞同":"w_buzantong","呆怒":"w_dainu","呆左":"w_daizuo","呆右":"w_daiyou","导演":"w_daoyan","敌视":"w_dishi","嘟嘴":"w_duzui","富二代":"w_fuerdai","鼓掌":"w_guzhang","交叉腿":"w_jiaochatui","交叉腿右":"w_jiaochatuiyou","交叉腿左":"w_jiaochatuizuo","叫兽":"w_jiaoshou","抠鼻":"w_koubi","哭泣":"w_kuqi","拉链":"w_lalian","刘备":"w_liubei","没":"w_mei","牛逼":"w_niubi","闪剑":"w_shanjian","帅":"w_shuai","挑眉":"w_tiaomei","呕吐":"w_outu","吐舌头":"w_tushetou","悟空":"w_wukong","香蕉":"w_xiangjiao","笑":"w_xiao","疑惑":"w_yiwen","怨念":"w_yuannian","大赞":"w_dazan","主持人":"w_zhuchiren","紫金钵":"w_zijinbo"},"泡芙小姐":{"泡芙-拜托":"p_baituobaituo","泡芙-点赞":"p_dianzan","泡芙-翻白眼":"p_fanbaiyan","泡芙-飞吻":"p_feiwen","泡芙-尴尬":"p_ganga","泡芙-get":"p_get","泡芙-鬼脸":"p_guilian","泡芙-鼓掌":"p_guzhang","泡芙-好困":"p_haokun","泡芙-哼":"p_heng","泡芙-惊讶":"p_jingya","泡芙-哭笑不得":"p_kuxiaobude","泡芙-么么哒":"p_memeda","泡芙-ok":"p_ok","泡芙-呸":"p_pei","泡芙-生气":"p_shengqi","泡芙-挑眉毛":"p_tiaomeimao","泡芙-偷笑":"p_touxiao","泡芙-无聊":"p_wuliao","泡芙-想到点子":"p_xiangdaodianzi","泡芙-嫌弃":"p_xianqi","泡芙-喜欢你":"p_xihuani","泡芙-有鬼":"p_yougui","泡芙-约吗":"p_yuema"},"暴走漫画":{"暴走-阿布":"b_abu","暴走-呵呵":"b_hehe","暴走-把持不住":"b_bachibuzhu","暴走-暴走":"b_baozou","暴走-兵库北":"b_binkubei","暴走-呆":"b_dai","暴走-逗我":"b_douwo","暴走-额":"b_e","暴走-放弃治疗":"b_fangqizhiliao","暴走-感累不爱":"b_ganleibuai","暴走-孤独一生":"b_guduyisheng","暴走-寒":"b_han","暴走-基佬":"b_jilao","暴走-金馆长":"b_jinguanzhang","暴走-惊":"b_jing","暴走-毛腿肩上扛":"b_maotuijianshangkang","暴走-内牛满面":"b_neiniumanmian","暴走-怕怕":"b_papa","暴走-软妹纸":"b_ruanmeizhi","暴走-兔美":"b_tumei","暴走-膝盖中箭":"b_xigaizhongjian","暴走-笑cry":"b_xiaocry","暴走-斜看":"b_xiekan","暴走-熊孩纸":"b_xionghaizhi","暴走-熊吉":"b_xiongji","暴走-姚明":"b_yaoming","暴走-吔屎":"b_chishi","暴走-有点意思":"b_youdianyisi","暴走-赞":"b_zan","暴走-作死":"b_zuosi"}},data_normal:{"默认表情":{"赞":"o1","稀饭":"o2","愤怒":"o3","吐":"o4","无语":"o5","难过":"o6","汗":"o7","搞笑":"o8","牛":"o9","强":"o10"},"步步惊心":{"八爷暴怒":"bb_bybn","八爷呵呵":"bb_byhh","八爷泪流成河":"bb_byllch","八爷么么哒":"bb_bymmd","八爷什么鬼":"bb_bysmg","解树不哭":"bb_jsbk","解树发怒":"bb_jsfn","解树好尴尬":"bb_jshgg","解树花痴":"bb_jshc","解树震惊了":"bb_jszj","四爷发飙":"bb_syfb","四爷害羞了":"bb_syhxl","四爷黑线":"bb_syhx","四爷求抱抱":"bb_syqbb","四爷吻我":"bb_syww"},"终极一班":{"汪大东_放电":"zj_fangdian","汪大东_怒":"zj_nu","雷婷_女王":"zj_nvwang","雷婷_害羞":"zj_haixiu","裘球_机智":"zj_qiuqiu","裘球_萌萌哒":"zj_mmda","辜战_困":"zj_kun","辜战_逗我":"zj_douwo","止戈_花痴":"zj_huachi","止戈_疑惑":"zj_yihuo","金宝三_可怜":"zj_kelian","断肠人_兴奋":"zj_xingfen","执_扮鬼脸":"zj_zhi","流尘_汗":"zj_liucheng","太阳_嘿嘿嘿":"zj_taiyang"},"极限挑战":{"搞怪":"j_gaoguai","耍酷":"j_shuaku","神算子":"j_shensuanzi","么么哒":"j_memeda","笑cry":"j_xiaocry","财迷":"j_caimi","贱萌":"j_jianmeng","小猪卖萌":"j_maimeng","卖萌":"j_maimeng1","羞涩":"j_xiuse"},"琅琊榜":{"苏兄看不懂":"l_kanbudong","苏兄笑cry":"l_xiaocry","苏兄委屈":"l_weiqu","苏兄爱你":"l_aini","苏兄尴尬":"l_ganga","苏兄么么哒":"l_sumemeda","苏兄想静静":"l_xiangjingjing","苏兄拜拜":"l_baibai","飞流么么哒":"l_memeda","飞流不开心":"l_bukaixin","飞流路过":"l_luguo","飞流最酷":"l_zuiku","飞流呆呆":"l_daidai","飞流不哭":"l_buku","飞流吓死了":"l_xiasi"},"小丈夫":{"广场舞女王":"x_gcwnw","老爸不明白":"x_lbbmb","老妈嫌弃":"x_lmxq","甜甜拜拜":"x_ttbb","小贝撩妹":"x_xblm","小贝么么哒":"x_xbmmd","小山女王":"x_xsnw","姚澜不开心":"x_ylbkx","姚澜女神":"x_ylns","袁帅怕怕":"x_yspp"},"快捷回复":{}}};var t={};function n(e,t){var i=t||{};for(var a in e)if("object"!==typeof e[a])e[a]&&(i[a]=e[a]);else n(e[a],i);return i}t=n(e);return{showFace:function(e){var n=t;for(var i in n){var a=new RegExp("\\[("+i+")\\]","g");e=e.replace(a,function(e,t){return'<span class="gface gface_'+n[t]+'_show" title="'+t+'"></span>'})}return e},all:function(){return e}}});n("module/comment/v3/form",["tui/art","tui/cookie","module/comment/v3/face","tui/view","tui/edittextarea","tui/autolinetextarea","tui/placeholder_dom","tui/countTextArea","module/comment/v3/submit","module/comment/v3/model","module/comment/v3/gift","module/comment/v3/commentConfig","module/comment/v3/commentLogin"],function(t,n,i,a,o,s,r,c,l,m,u,d,p){var f=t.compile('<div class="comment-form <%if(isReply){%>comment-form-reply<%}%>">\n<%if(!isReply && userInfo){%>\n<div class="form-cell form-user-avatar">\n<a href="<%=userDomain%><%=userInfo.userCode%>" target="_blank">\n<img title="<%=userInfo.userName%>" src="//static.youku.com/user/img/avatar/50/55.jpg">\n</a>\n</div>\n<%}%>\n<div class="form-cell form-content <%=picUploadId%>FormContent">\n<div class="form-user-info">\n<%if(userInfo){%>\n<a href="<%=userDomain%><%=userInfo.userCode%>" target="_blank"><%=userInfo.userName%></a>\n<%}else{%>\n<a href="javascript:;" class="form-user-login" hzCharset="hz-4003764-1000494" charset="404-0-1">登录</a>\n<span>|</span>\n<a href="https://account.youku.com/register.htm" target="_blank">注册</a>\n<%}%>\n</div>\n<div class="form-wordlimit"><span class="form-wordlimit-input input-count">0</span><span class="form-wordlimit-upper">/300</span></div>\n<div class="form-textarea form-textarea-picdom">\n<textarea data-maxlength="300" name="content" <%if(!isReply){%>placeholder="看点槽点，不吐不快！别憋着，马上大声说出来吧！"<%}%> <%=getSpmConfig(!isReply ? \'commentboxclick\' : \'commentreplybox\')%> ></textarea>\n<%if(!isReply  && picUpload){%>\n<div class="cont-imgbox">\n<div class="cont-imgbox-box fix">\n<div class="cont-imgitem " id="<%=picUploadId%>imgitem">\n<ul class="fix"></ul>\n</div>\n<div class="cont-imgupload">\n<div class="upload_div handle">\n<span class="ui-upload-a"   id="<%=picUploadId%>1">\n+\n</span>\n</div>\n</div>\n</div>\n</div>\n<%}%>\n</div>\n<div class="form-toolbar">\n<div class="form-toolbar-right">\n<div class="form-tool form-action">\n<%if(isReply){%>\n<a href="javascript:;" class="form-btn form-btn-small form-btn-submit form-btn-blue" <%=getSpmConfig(\'commentreply\')%>>回复</a>\n<a href="javascript:;" class="form-btn form-btn-small form-btn-cancle">取消</a>\n<%} else {%>\n<a href="javascript:;" class="form-btn form-btn-large form-btn-submit" <%=getSpmConfig(\'commententerclick\')%> >发表评论</a>\n<%}%>\n</div>\n<div class="form-tooltip" style="display:none">\n<div class="com_overlay_con">\n<div class="tips"></div>\n</div>\n</div>\n</div>\n<div class="form-toolbar-left">\n<%if(false && isReply){%>\n<div class="tool">\n<input class="reply-repeat" type="checkbox" />\n<label style = "cursor: pointer;">回复并转发</label>\n</div>\n<%}%>\n<div class="form-tool faces-normal-tool"></div>\n<div class="form-tool faces-vip-tool"></div>\n<%if(!isReply && picUpload){%>\n<div class="form-tool pic_tool">\n<a href="javascript:;" id="<%=picUploadId%>0" class="ui-upload-a">\n<span class="upload-icon"></span>\n<span>图片</span>\n</a>\n<div id="<%=picUploadId%>queue"></div>\n</div>\n<%}%>\n</div>\n<div class="form-validate" style="display:none;">\n验证码: <input class="defaultext verify_code_value" type="text" name="verify_code_value" placeholder="输入右图的字符" />\n<img class="key verify_code_img"/>\n<span>看不清, <a class="change_verify_code" href="javascript:;">点此刷新</a></span>\n</div>\n</div>\n</div>\n</div>\n');
var v=t.compile('<a href="javascript:;" class="faces-btn" title="表情">\n<span class="faces-icon faces-icon-normal"></span><span>表情</span>\n</a>\n<div class="faces-content">\n<div class="insert_emoticon">\n<%for(var o in data){%>\n<div class="faces" data-id="<%=o%>" <%if(o !== init){%> style="display:none;"<%}%>>\n<div class="faces_con faces_con_<%=indexList.indexOf(o)%>">\n<%if(o =="快捷回复" && setrumors){%>\n<%for(var mors in setrumors){%>\n<p title="<%=setrumors[mors]%>"  data-test="<%=setrumors[mors]%>" data-stat-role="ck"><%=setrumors[mors]%></p>\n<%}%>\n<%}else{%>\n<% \nvar list = data[o];\nfor(var k in list){%>\n<a href="javascript:;" title="<%=k%>" data-test="<%=k%>" class="gface_<%=list[k]%>"><%if(list[k]){%><i></i><%}%></a>\n<%}%>\n<%}%>\n</div>\n</div>\n<%}%>\n<div class="emot_tab clearfix">\n<div class="switch_toobar">\n<% \nvar count = 0;\nfor( var item=0; item < indexList.length; item++){ count++\n%>\n<a href="javascript:;"  class="<%if(indexList[item] === init){%>tab_active<%}%>" style="<%if(indexList[item]===initnone){%>display:none;<%}%>" title="<%=indexList[item]%>">\n<i class="general_tab_<%=count%>"></i>\n<%if(indexList[item]==="快捷回复" && hasNew){%>\n<span class="chuda_qheader_spot chuda_qheader_spot_dis" style="top: 10px;right: 4px; display:block;"></span>\n<%}%>\n</a>\n<%}%>\n</div>\n<a class="next disabled"></a>\n<a class="pre disabled"></a>\n</div>\n</div>\n<iframe class="mask" frameborder="0" scrolling="no"></iframe>\n</div>');var h=t.compile('<a href="javascript:;" class="faces-btn" title="vip表情">\n<span class="faces-icon faces-icon-vip"></span><span>会员表情</span>\n</a>\n<div class="faces-content">\n<div class="vip_insert_emoticon">\n<%for(var o in data){%>\n<div class="faces" data-id="<%=o%>" <%if(o !== init){%> style="display:none;"<%}%> >\n<% if(!isVip){ %>\n<% var face = nonVip[o]; %>\n<% if(face){ %>\n<div class="non_vip">\n<div class="non_vip_wrap clearfix">\n<img src="<%=face.img%>" />\n<div>\n<p><%=face.name%>表情系列<span>（VIP会员专享）</span></p>\n<a href="//cps.youku.com/redirect.html?id=00014725" target="_blank" class="vip_btn">开通VIP会员</a>\n</div>\n</div>\n</div>\n<% } %>\n<% }else{ %>\n<div class="faces_title clearfix">\n<span><%=o%>（原创表情，动画系列）</span>\n<a href="//cps.youku.com/redirect.html?id=000145d1" target="_blank">续费会员</a>\n<em>优酷会员免费</em>\n</div>\n<div class="faces_con faces_con_<%=indexList.indexOf(o)%>">\n<% var list = data[o]; %>\n<% for(var k in list){ %>\n<a href="javascript:;" title="<%=k%>" class="gface_<%=list[k]%>"><i></i></a>\n<%}%>\n</div>\n<%}%>\n</div>\n<%}%>\n<div class="vip_emot_tab">\n<a class="pre disabled"></a>\n<div class="switch_toobar">\n<% var count = 0;%>\n<% for( var item in data){ %>\n<% count++ %>\n<a href="javascript:;" <%if(item === init){%>class="tab_active"<%}%> title="<%=item%>">\n<i class="vip_tab_<%=count%>"></i>\n</a>\n<%}%>\n</div>\n<a class="next disabled"></a>\n</div>\n</div>\n<iframe class="mask" frameborder="0" scrolling="no"></iframe>\n</div>');var g=t.compile("<%if(data.vipInfo && data.vipInfo.vipGrade){%>\n<%\nvar arrVipMMId = [ 0, 100004, 100002, 100006 ];\nvar arrVipCss = [ 'level-expired', 'level-lvip', 'level-vip', 'level-lvip'];\nvar arrVipName = [ '会员已过期', '优酷土豆白银会员：VIP', '优酷土豆黄金会员：VIP', '优酷土豆钻石会员：VIP'];\nvar curVipIndex = arrVipMMId.indexOf(data.vipInfo.mmid);\ncurVipIndex = curVipIndex < 0 ? 0 : curVipIndex;\nvar css = arrVipCss[curVipIndex] + data.vipInfo.vipGrade;\nvar txt = arrVipName[curVipIndex] + data.vipInfo.vipGrade;\nvar sty = data.vipInfo.icon ? ('background: url(' + data.vipInfo.icon + ') 0px 0px no-repeat;height: 22px;') : '';\n%>\n<a href=\"http://vip.youku.com/\" title=\"<%=txt%>\" target=\"_blank\"><span class=\"vip-level-icon <%=css%>\" style=\"<%=sty%>\"></span></a>\n<%}%>\n<a href=\"//lv.youku.com/page/grade/compare?uid=<%=data.userId%>\" target=\"_blank\" title=\"用户等级\" class=\"user-grade-icon user-grade-lv<%=data.userLevel%>\"></a>");var b={objectId:0,objectType:1,flag:1,commentId:0,sourceCommentId:0};var y;var w=[];var _=a.extend({initialize:function(t){var n=this;n.facesConfig=e.extend({},{rangeNode:null,align:"bottom left"},t.faces);n.isReply=t.isReply;n.parentSubmitArgs=e.extend({},b,t.submitArgs,{picUploadId:t.picUploadId});var i=p.getUserInfo();n.$el.html(f({userInfo:i,isReply:n.isReply,picUpload:d.check("picUpload"),picUploadId:t.picUploadId,userDomain:d.globals.userDomain,getSpmConfig:function(e){return d.getCommentTestSpmConfig(e,n.parentSubmitArgs.commentId)}}));n.$ta=n.$el.find("textarea");new s(n.$ta,81);if(!r.isSupport())new r(n.$ta,n.$ta.attr("placeholder"));n.limitTa=new c(n.$ta);n.modelEvents(n.limitTa,"ta");n.editTa=new o(n.$ta);n.submitForm=new l({el:n.$el,playmode:parseInt(d.globals.page.playmode)});n.modelEvents(n.submitForm,"submit");n.renderFace();n.setVipGrade();n.FormContent="."+t.picUploadId+"FormContent";if(d.check("picUpload")&&!n.isReply){if(w.length>0)if(w.indexOf(t.picUploadId)>=0)m.mupload({id:t.picUploadId,num:0});else if(w.indexOf("nopic")>=0)e(".comment-form .pic_tool",n.$el).remove();else n.picflag(t);else n.picflag(t);if(!i){e(n.FormContent+" .upload-el").css({left:"-1000px"});e(n.FormContent+" .ui-upload-a").addClass("ui-upload-ative")}}e(document.body).on("click",function(t){var i=e(t.target).closest(".form-toolbar");if(n.hasOpenFace&&!i.length)n.closeFace()});p.bind("login:after",function(t){if(!n.$el||n.$el.length<=0)return;if(!t)return;var i=e(".comment-form",n.$el);e(".form-user-info",i).html('<a href="'+d.globals.userDomain+t.userCode+'" target="_blank">'+t.userName+"</a>");if(!n.isReply)0==e(".form-user-avatar",i).length&&i.prepend('<div class="form-cell form-user-avatar"><a href="'+d.globals.userDomain+t.userCode+'" target="_blank"><img title="'+t.userName+'" src="'+t.avatarMiddle+'"></a></div>');n.uploadload();n.setVipGrade()})},uploadload:function(){var t=this;e(t.FormContent+" .upload-el").css({left:"auto"});e(t.FormContent+" .ui-upload-a").removeClass("ui-upload-ative")},picflag:function(e){m.mupload({id:e.picUploadId,num:0});return false},reset:function(e){this.parentSubmitArgs.objectId=e},setVipGrade:function(){var t=this;var n=p.getUserInfo();if(!n)return;t.submitForm.setVipGrade(n);if(!t.isReply){var i=e(".form-user-info",t.$el);i.find("a:gt(0)").remove();var a=i.html();i.html(a+g({data:n}));e(".form-user-avatar img",t.$el).attr("src",n.avatarMiddle)}if(n.userLevel>16||n.vipInfo&&n.vipInfo.mmid)t.renderFace(20)},events:{"click .switch_toobar a":"switchFace","click .faces-btn":"openFace","click .time_anchor":"timeAnchor","click .form-btn-submit":"formSubmit","click .faces_con a":"addFace2Ta","click .faces_con p":"addQuickreply","click .form-user-login":"loginRegGuide","click .change_verify_code":"changeVerifyCode","focus textarea":"changeVerifyCodeTime","click .form-btn-cancle":"remove","click .comment-atuser":"focus","mouseenter  .form-textarea-pic .img-item":"mouseePic","mouseleave  .form-textarea-pic .img-item":"mouselPic","click .form-textarea-pic .opacity-dom .pic-icon":"closePic"},mouseePic:function(t){var n=e(t.currentTarget);n.addClass("img-ctive")},mouselPic:function(t){var n=e(t.currentTarget);n.removeClass("img-ctive")},closePic:function(t){var n=e(t.currentTarget);var i=n.closest(".form-content");var a=n.closest(".cont-imgbox").find(".cont-imgitem ul li").length-1;if(a<=0)i.removeClass("form-textarea-pic");else if(a<9){i.find(".upload-el").css({left:"auto"});i.find(".ui-upload-a").removeClass("ui-upload-ative")}n.closest("li").remove()},focus:function(){this.$ta.focus()},renderFace:function(e,t){var a=this;var o=t||a.$el;var s=i.all();var r=["万万表情","泡芙小姐","暴走漫画"];var c=["默认表情","快捷回复","步步惊心","终极一班","琅琊榜"];var l=p.getUserInfo();var m={"万万表情":{name:"万万",img:"//r1.ykimg.com/05100000573C2D3067BC3D740E011788"},"泡芙小姐":{name:"泡芙",img:"//r1.ykimg.com/05100000573C2D3167BC3D3D0C0B5C07"},"暴走漫画":{name:"暴走",img:"//r1.ykimg.com/05100000573C2D3067BC3D7402025ABC"}};var u=l&&l.vipInfo&&l.vipInfo.mmid||e>16;a.isVipx=u;o.find(".faces-vip-tool").html(h({data:s.data_vip,nonVip:m,indexList:r,isVip:u,init:"万万表情"}));var d="快捷回复";var f=false;if(y){d="";f="3"!=n("chuda_qheader_spot_dis")}o.find(".faces-normal-tool").html(v({data:s.data_normal,hasNew:f,indexList:c,init:"默认表情",initnone:d,setrumors:y}))},remove:function(){this.trigger("remove:success",[]);this.undelegateEvents();this.unbind();this.$el.remove();this.$el=null},loginRegGuide:function(e){p.login(function(){if("function"==typeof e)e()})},changeVerifyCodeTime:function(e){var t=this;if(!t.VerifyCodeTime){t.VerifyCodeTime=true;setTimeout(function(){t.VerifyCodeTime=false},1e4);this.changeVerifyCode()}},changeVerifyCode:function(t){t&&t.preventDefault();var n=this;if(n.codeChecking)return;var i=p.isLogin();if(!i)return false;var a=n.$el.find(".verify_code_img");var o=n.$el.find(".verify_code_value");var s=n.$el.find(".form-validate");n.codeChecking=true;m.isNeedVerify({},function(t){o.val("");if("0"==t.code&&t.data){m.getVerifyCode({},function(e){if("0"==e.code){e.data=JSON.parse(e.data);o.attr("key",e.data.captchaKey);a.attr("src","data:image/jpeg;base64,"+e.data.captchaData)}});s.show();if(!r.isSupport()&&0==e(".ui-placeholder",s).length)new r(o,o.attr("placeholder"),{top:22})}else s.hide();n.codeChecking=false})},setRelyName:function(e){var t=this;var n='<div class="comment-atuser">'+e+"</div>";t.$el.find(".comment-atuser").remove();t.$el.find(".form-textarea").append(n);t.currentReply=e;t.$el.find(".input-count").html(0);t.$ta.val(e);t.setCursor(e.length,t.$ta)},setCursor:function(e,t){var n=t[0];e=e||0;var i=i||e;try{if(n.setSelectionRange){n.focus();n.setSelectionRange(e,i)}else if(n.createTextRange){var a=n.createTextRange();a.collapse(true);a.moveEnd("character",i);a.moveStart("character",e);a.select()}}catch(o){}},setArgs:function(t){this.submitArgs=e.extend({},this.parentSubmitArgs,t)},setface:function(){if(!d.check("quickreply"))return;var e=this;var t=d.globals.page;var n=[305355,310282,305135];var i=true;for(var a in n)if(n[a]==t.showid)i=false;if(i)return false;if(y){e.renderFace(e.isVipx?20:0);return}m.quickreply({vid:t.videoId,pid:t.showid,fid:t.folderId,uid:t.videoOwner,cid:t.catId},function(t){if("0"==t.code)if(t.data.rumors){y=t.data.rumors;e.renderFace(e.isVipx?20:0)}})},formSubmit:function(t){t.preventDefault();var n=this;n.closeFace();var i=n.submitArgs||n.parentSubmitArgs||{};if(n.isReply){i.flag=!e(t.currentTarget).closest(".form-toolbar").find(".reply-repeat").prop("checked");i.sourceCommentId=!i.flag?i.commentId:n.parentSubmitArgs.commentId}this.submitForm.commentNew(i)},"{submit} success":function(e){this.$ta.val("");this.find(".input-count").html(0);this.changeVerifyCode();this.submitArgs=null;this.$el.find(".comment-atuser").remove();this.trigger("submit:success",[e])},"{submit} error":function(e){this.trigger("submit:error",[e]);this.changeVerifyCode()},"{ta} input":function(t,n){var i=this;var a=i.$ta.val();var o=/^回复 @.*?:/;var s=o.exec(a);var r=s?s[0]:null;if(i.currentReply&&r!==i.currentReply){if(""!=a)i.$ta.val("");a="";i.$el.find(".comment-atuser").remove();i.currentReply=""}t=a.replace(o,"").replace(/(\r\n|\n|\r|\s)/g,"--").length;var c=e(".form-wordlimit .input-count",i.$el);c[t>n?"addClass":"removeClass"]("form-wordlimit-warning");c.html(t)},addFace2Ta:function(t){var n=e(t.currentTarget);var i="["+n.attr("title")+"]";this.editTa.insert(i);this.$ta.removeClass("defaultext");this.$ta.trigger("input")},addQuickreply:function(t){var i=e(t.currentTarget);var a=i.attr("title");this.editTa.insert(a);this.$ta.removeClass("defaultext");this.$ta.trigger("input");n("chuda_qheader_spot_dis",3,{expires:365});var o=i.closest(".dropmenu");o.find(".chuda_qheader_spot_dis").hide()},dropmenu:function(e){},closeFace:function(){this.$el&&this.$el.find(".faces-active").removeClass("faces-active").removeAttr("style").siblings(".faces-content").removeAttr("style");this.hasOpenFace=false},switchFace:function(t){var n=e(t.currentTarget);if(n.hasClass("tab_active"))return;var i=n.parents(".faces-content");var a=i.find(".faces");var o=i.find('[data-id="'+n.attr("title")+'"]');n.addClass("tab_active").siblings().removeClass("tab_active");a.hide();o.show()},openFace:function(t){var n=e(t.currentTarget);if(n.hasClass("faces-active")){this.closeFace();return}this.closeFace();this.hasOpenFace=true;var i=n.siblings(".faces-content");if(!i.length)return;n.addClass("faces-active");var a=n.outerHeight();var o=a-1.5;var s=this.facesConfig;var r={top:"top",bottom:"top",left:"left",right:"right"};var c={top:"bottom",bottom:"top",left:"right",right:"left"};var l=s.align.split(/\s+/);var m=s.rangeNode;if(m){var u=n.outerWidth();var d=i.outerWidth();var p=i.outerHeight();var f=n.offset();var v=f.top;var h=f.left;var g=m.offset();var b=g.top;var y=g.left;var w=m.width();var _=m.height();var x=v-b;var C=_-x-a;var I=h-y+u;var k=w-I+u;var T={top:p,bottom:p,left:d,right:d};var j={top:x,bottom:C,left:k,right:I};l.forEach(function(e,t){if(j[e]>T[e])return;if(j[c[e]]>T[c[e]])l[t]=c[e]})}var P={visibility:"visible"};P[c[l[0]]]=o;P[r[l[1]]]=0;i.css(P);n.css("border-"+l[0]+"-color","transparent")}});return _});n("module/comment/v3/commentPager",["tui/art","tui/view","tui/dialog","module/comment/v3/commentConfig"],function(t,n,i,a){var o=t.compile('<div class="comment-pager fix">\n<div class="comment-pager-state">\n第<span><%=currentPage%></span>页<%if(totalSize > 0){%>/共<span><%=totalPage%></span>页<%}%>\n</div>\n<ul class="comment-pager-turn">\n<li title="上一页">\n<%if(totalPage > 1 && currentPage > 1){%>\n<a data-page="<%=currentPage - 1%>" href="javascript:;">上一页</a>\n<%}else{%>\n<span>上一页</span>\n<%}%>\n</li>\n<li title="下一页">\n<%if(totalPage > 1 && totalPage > currentPage){%>\n<a data-page="<%=currentPage + 1%>" href="javascript:;" <%=getSpmConfig(\'nextpage\', currentPage + 1)%> >下一页</a>\n<%}else{%>\n<span>下一页</span>\n<%}%>\n</li>\n</ul>\n<ul class="comment-pager-page">\n<%\nvar start = currentPage - 4;\nvar end = currentPage + 5;\nif(start < 1){\nstart = 1;\n}\nif(end > totalPage){\nend = totalPage;\n}\n%>\n<%if(start > 1){%>\n<li><a data-page="1" href="javascript:;" <%=getSpmConfig(\'page\', 1)%> >1</a></li>\n<%}%>\n<%if(start - 1 > 1){%>\n<li>...</li>\n<%}%>\n<%for(var i = start; i <= end; i++){%>\n<%if(i == currentPage){%>\n<li><span><%=i%></span></li>\n<%}else{%>\n<li><a data-page="<%=i%>" href="javascript:;" <%=getSpmConfig(\'page\', i)%> ><%=i%></a></li>\n<%}%>\n<%}%>\n<%if(totalPage - end > 1){%>\n<li>...</li>\n<%}%>\n<%if(totalPage > end){%>\n<li><a data-page="<%=totalPage%>" href="javascript:;" <%=getSpmConfig(\'page\', totalPage)%> ><%=totalPage%></a></li>\n<%}%>\n</ul>\n</div>');var s=n.extend({initialize:function(){},events:{"click .comment-pager a":"changePage"},changePage:function(t){var n=this;var i=n.options.changePage;i&&i.call(n,e(t.currentTarget).data("page"));return false},render:function(t){return o(e.extend({currentPage:1,totalPage:10,totalSize:0,getSpmConfig:function(e,n){return a.getCommentTestSpmConfig(e,t.commentId+"_"+n,{num:n})}},t))}});return s});n("module/comment/v3/const",["module/comment/v3/face","module/comment/v3/commentConfig"],function(e,t){var n=Array.prototype.slice;var i="[0-9０-９]";var a="[0-5０-５]";var o="[:：]";var s="(?:分钟?)";var r=new RegExp(["("+i+"+"+s+")(?:("+a+"?"+i+")秒)?"+"(?:到|至)"+i+"+"+s+"(?:"+a+"?"+i+"秒)?","("+i+"+"+"(?:到|至))"+i+"+"+s+"(?:"+a+"?"+i+"秒)?","("+i+"+"+s+")("+a+"?"+i+")秒","("+i+"+"+s+")","("+i+"+)秒","("+i+"+"+o+")("+a+"?"+i+")(?!"+i+")"].join("|"),"g");var c={escapeHtml:function(e){var t={"&":"&#38;","<":"&#60;",">":"&#62;",'"':"&#34;","'":"&#39;","/":"&#47;"};var n=/&(?!#?\w+;)|<|>|"|'|\//g;return e?(e+"").replace(n,function(e){return t[e]||e}):e},face:function(t){return e.showFace(t)},url:function(e){return e.replace(/\[url\](.*?)\[\/url\]/gi,function(e,t){return t})},star:function(e,t){if(t)for(var n in t){var i=new RegExp(l(n),"g");e=e.replace(i,'<a href="'+t[n]+'" target="_blank">'+n+"</a>")}return e},at:function(e,n){if(n)for(var i in n)if("youku"!=i&&n[i])e=e.replace(new RegExp("@"+l(i),"g"),'<a href="'+t.globals.userDomain+n[i]+'" target="_blank">@'+i+"</a>");return e},removeRepeatAt:function(e,t){if(t&&t.userName){var n=new RegExp("回复 @"+l(t.userName)+" :s*","g");var i="回复 @"+t.userName+" :";if(!n.test(e))e=i+e;else e=e.replace(n,i);var a={};a[t.userName]=t.userCode;e=this.at(e,a)}return e},ht:function(e,t){if(t)for(var n in t)e=e.replace(new RegExp("#"+l(n)+"#","g"),'<a href="//gh.youku.com/topic_page/detail?id='+t[n]+'" target="_blank">#'+n+"#</a>");return e},timer:function(e){return e.replace(r,function(){var e=n.call(arguments);var t=0;e.slice(1,-2).forEach(function(e){e=(e||"").replace(/[\uff10-\uff19\uff1a]/g,function(e){return String.fromCharCode(e.charCodeAt(0)-65248)});t+=parseInt(e,10)*(/[到至分\:]/.test(e)?60:1)||0});return'<a title="点击从此时间点播放" href="#" class="seekTime" data-time="'+t+'">'+e[0]+"</a>"})},activityName:function(e,t){if(!e)return"";if(t)t='style="color:rgb('+(255&t>>16)+","+(255&t>>8)+","+(255&t)+');"';return'<span class="comment-user-activityname" '+(t||"")+">"+e+"_</span>"}};return c;function l(e){return String(e).replace(/[-[\]{}()*+?.,\\^$|#\s]/g,"\\$&")}});n("module/comment/v3/subcomment",["tui/art","tui/view","tui/util","module/comment/v3/const","module/comment/v3/model","module/comment/v3/form","module/comment/v3/utils","module/comment/v3/face","module/comment/v3/commentToolbar","module/comment/v3/commentPager","module/comment/v3/commentConfig"],function(t,n,i,a,o,s,r,c,l,m,u){var d=t.compile('<div class="comment-reply-container">\n<% var pagerHtml = data.totalPage > 1 ?\npager.render({ currentPage: data.currentPage, totalPage: data.totalPage, totalSize: data.totalSize, commentId: commentId }) :\n\'\';\n%>\n<%==pagerHtml%>\n<div class="comment-reply-list comment-list-box">\n<%if(data.replies.length > 0 ){%>\n<%data.replies.forEach(function(item,i){%>\n<div class="comment-item">\n<!--commentcon bg-->\n<div class="comment-content">\n<div class="comment-user-avatar">\n<a href="<%=userDomain%><%=item.user.userCode%>" target="_blank">\n<img class="img-small" _hz="" src="<%=item.user.avatarSmall%>">\n</a>\n</div>\n<div class="comment-section">\n<div class="comment-user-info">\n<a href="<%=userDomain%><%=item.user.userCode%>" target="_blank" class="<%if(item.user.userlevel && item.user.isVip){%>redname<%}%> " _hz="">\n<%==getActivityName(item.user.userActName, item.user.color)%><%=item.user.aliasName || item.user.userName%>\n</a>\n<%if(videoOwnerId == item.user.userId){%>\n<span class="comment-usertitle">频道主</span>\n<%}else if(suid==item.user.userId){%>\n<span class="comment-usertitle">楼主</span>\n<%}%>\n<%if(item.user.vipInfo){%>\n<%if(item.user.vipInfo.mmid=="100002"){%>\n<a href="http://vip.youku.com/" title="<%=item.user.vipInfo.name%>" target="_blank"><span class="vip-level-icon level-vip<%=item.user.vipInfo.vipGrade%>"  <%if(item.user.vipInfo.icon){%>style="background: url(<%=item.user.vipInfo.icon%>) 0px 0px no-repeat;height: 22px;"<%}%> ></span></a>\n<%}else if(item.user.vipInfo.mmid=="100004"){%>\n<a href="http://vip.youku.com/" title="<%=item.user.vipInfo.name%>" target="_blank"><span class="vip-level-icon level-lvip<%=item.user.vipInfo.vipGrade%>"  <%if(item.user.vipInfo.icon){%>style="background: url(<%=item.user.vipInfo.icon%>) 0px 0px no-repeat;height: 22px;"<%}%>></span></a>\n<%}else if(item.user.vipInfo.mmid=="100006"){%>\n<a href="http://vip.youku.com/" title="<%=item.user.vipInfo.name%>" target="_blank"><span class="vip-level-icon level-lvip<%=item.user.vipInfo.vipGrade%>" <%if(item.user.vipInfo.icon){%>style="background: url(<%=item.user.vipInfo.icon%>) 0px 0px no-repeat;height: 22px;"<%}%>></span></a>\n<%}%>\n<%}%>\n<%if(item.user.userLevel && item.user.userLevel>5){%>\n<a href="//lv.youku.com/page/grade/compare?uid=<%=item.user.userId%>" target="_blank" title="用户等级" class="user-grade-icon user-grade-lv<%=item.user.userLevel%>"></a>\n<%}%>\n<span class="comment-text"><%==textTransform(item.content,item)%></span>\n</div>\n</div>\n<%var toolbarHtml = !toolbar ? \'\' : toolbar.render({\nid: item.id,\nupCount: item.upCount,\ndownCount: item.downCount,\nuserId: item.user.userId,\nuserName: item.user.userName,\nshowSubReply: allowReply\n});%>\n<%==toolbarHtml%>\n<span class="comment-timestamp"><%=util.release(item.createTime)%></span>\n</div>\n<!--commentcon end-->\n</div>\n<%})%>\n<%}%>\n</div>\n<%==pagerHtml%>\n</div>');var p=t.compile('<%data.replies.forEach(function(item,i){%>\n<div class="comment-item">\n<!--commentcon bg-->\n<div class="comment-content">\n<div class="comment-user-avatar">\n<a href="<%=userDomain%><%=item.user.userCode%>" target="_blank">\n<img class="img-small" _hz="" src="<%=item.user.avatarSmall%>">\n</a>\n</div>\n<div class="comment-section">\n<div class="comment-user-info">\n<a href="<%=userDomain%><%=item.user.userCode%>" target="_blank" class="<%if(item.user.userlevel && item.user.isVip){%>redname<%}%> " _hz="">\n<%==getActivityName(item.user.userActName, item.user.color)%><%=item.user.aliasName || item.user.userName%>\n</a>\n<%if(videoOwnerId == item.user.userId){%>\n<span class="comment-usertitle">频道主</span>\n<%}else if(suid==item.user.userId){%>\n<span class="comment-usertitle">楼主</span>\n<%}%>\n<%if(item.user.vipInfo){%>\n<%if(item.user.vipInfo.mmid=="100002"){%>\n<a href="http://vip.youku.com/" title="<%=item.user.vipInfo.name%>" target="_blank"><span class="vip-level-icon level-vip<%=item.user.vipInfo.vipGrade%>"  <%if(item.user.vipInfo.icon){%>style="background: url(<%=item.user.vipInfo.icon%>) 0px 0px no-repeat;height: 22px;"<%}%> ></span></a>\n<%}else if(item.user.vipInfo.mmid=="100004"){%>\n<a href="http://vip.youku.com/" title="<%=item.user.vipInfo.name%>" target="_blank"><span class="vip-level-icon level-lvip<%=item.user.vipInfo.vipGrade%>"  <%if(item.user.vipInfo.icon){%>style="background: url(<%=item.user.vipInfo.icon%>) 0px 0px no-repeat;height: 22px;"<%}%>></span></a>\n<%}else if(item.user.vipInfo.mmid=="100006"){%>\n<a href="http://vip.youku.com/" title="<%=item.user.vipInfo.name%>" target="_blank"><span class="vip-level-icon level-lvip<%=item.user.vipInfo.vipGrade%>" <%if(item.user.vipInfo.icon){%>style="background: url(<%=item.user.vipInfo.icon%>) 0px 0px no-repeat;height: 22px;"<%}%>></span></a>\n<%}%>\n<%}%>\n<%if(item.user.userLevel && item.user.userLevel>5){%>\n<a href="//lv.youku.com/page/grade/compare?uid=<%=item.user.userId%>" target="_blank" title="用户等级" class="user-grade-icon user-grade-lv<%=item.user.userLevel%>"></a>\n<%}%>\n<span class="comment-text"><%==textTransform(item.content,item)%></span>\n</div>\n</div>\n<%var toolbarHtml = !toolbar ? \'\' : toolbar.render({\nid: item.id,\nupCount: item.upCount,\ndownCount: item.downCount,\nuserId: item.user.userId,\nuserName: item.user.userName,\nshowSubReply: allowReply\n});%>\n<%==toolbarHtml%>\n<span class="comment-timestamp"><%=util.release(item.createTime)%></span>\n</div>\n<!--commentcon end-->\n</div>\n<%})%>\n');var f=n.extend({initialize:function(e){this.sublist=[];this.parentModule=e.parentModule},clear:function(){this.sublist.forEach(function(e){e.remove()});this.sublist=[];return this},textTransform:function(e,t){var n=this;e=a.escapeHtml(e);e=a.removeRepeatAt(e,t.replyUser);u.check("text.star",function(){e=a.star(e,n.starLink)});u.check("text.at",function(){e=a.at(e,t.atUsers)});u.check("text.ht",function(){e=a.ht(e,t.topics)});e=a.timer(e);e=a.url(e);e=a.face(e);return e},render:function(t){var n=this;var o=e(t.el);if(e(".commnet-reply",o).length>0)return;var r='<div class="comment-reply fix"><div class="comment-form-container"></div></div>';var c=e(r).appendTo(o);var d=t.objectInfo.objectId;var f=t.objectInfo.objectType;var v;if(u.check("operate.reply")){v=new s({el:c.find(".comment-form-container"),isReply:true,submitArgs:{commentId:t.commentId,objectId:d,objectType:f},faces:{rangeNode:(n.parentModule||{parentModule:{}}).parentModule.$el}});v.bind("submit:success",function(t){if(0!=t.code)return;if(!t.data)return;e(".comment-reply-list",c).prepend(p({data:{replies:[{id:0,content:t.params.content,createTime:Date.now(),user:{userId:t.data.userId,userName:t.data.userName,aliasName:"我",avatarSmall:t.data.avatarMiddle,userlevel:{},isVip:true}}]},util:i,textTransform:n.textTransform.bind(n),userDomain:u.globals.userDomain,getActivityName:a.activityName})).find(".null").remove()});v.bind("remove:success",function(){c.remove()})}var h=new l({el:c,objectInfo:t.objectInfo,items:{showUp:true,showDown:true,showSubReply:true},commentReplySub:function(t){if(!v)return;var n=e(t.target);var i=n.data("id");var a="回复 @"+n.data("uname")+" :";v.setRelyName(a);v.setArgs({commentId:i})}});var g={app:"pc",commentId:t.commentId,objectId:d,objectType:f,currentPage:1,pageSize:10};var b=new m({el:c,changePage:function(e){g.currentPage=e;n.getSubCommentsContent(c,h,b,g,t.userId)}});b.changePage(1);n.sublist.push(c)},getSubCommentsContent:function(t,n,s,r,c){var l=this;l.trigger("load:before",[t]);o.replyList(r,function(o){if(0==o.code){var m=e(d({data:o.data,util:i,textTransform:l.textTransform.bind(l),toolbar:n,pager:s,suid:c,videoOwnerId:u.globals.page.videoOwner,allowReply:u.check("operate.reply"),userDomain:u.globals.userDomain,commentId:r.commentId,getActivityName:a.activityName}));var p=e(".comment-reply-container",t);if(p.length>0)p.replaceWith(m);else t.append(m);l.trigger("load:after",[t,o.data])}})}});return f});n("module/comment/v3/commentList",["tui/art","tui/view","tui/util","module/comment/v3/const","module/comment/v3/model","module/comment/v3/utils","module/comment/v3/commentImage","module/comment/v3/commentToolbar","module/comment/v3/subcomment","module/comment/v3/commentPager","module/comment/v3/commentConfig","module/comment/v3/commentLogin"],function(t,n,i,a,o,s,r,c,l,m,u,d){var p=t.compile('<%var pagerHtml= data.totalPage > 1 ? pager.render({currentPage:data.currentPage,totalPage:data.totalPage,totalSize:data.totalSize, commentId: 0}) : \'\';%>\n<div class="comment-pager-header">\n<%==pagerHtml%>\n</div>\n<%if(data.hot.length > 0 && data.currentPage == 1){%>\n<div class="comment-list-hot comment-list-box">\n<div class="comment-list-head">\n<h3 class="title">热门评论</h3>\n</div>\n<div class="comment-list-body">\n<%data.hot.forEach(function(item,i){%>\n<div class="comment-item" data-id="<%=item.id%>">\n<div class="comment-content">\n<div class="comment-user-avatar">\n<a href="<%=userDomain%><%=item.user.userCode%>" target="_blank"><img _hz="" src="<%=item.user.avatarMiddle%>"></a>\n</div>\n<div class="comment-section">\n<div class="comment-user-info">\n<a href="<%=userDomain%><%=item.user.userCode%>" class="<%if(item.user.vipInfo && [100002,100004,100006].indexOf(item.user.vipInfo.mmid) != -1){%>redname<%}%>" target="_blank">\n<%==getActivityName(item.user.userActName, item.user.color)%><%=item.user.aliasName || item.user.userName%>\n</a>\n<%if(videoOwnerId == item.user.userId){%>\n<span class="comment-usertitle">频道主</span>\n<%}%>\n<%if(item.user.vipInfo && [100002,100004,100006].indexOf(item.user.vipInfo.mmid) != -1){%>\n<a href="http://vip.youku.com/" title="<%=item.user.vipInfo.name%>" target="_blank">\n<span class="vip-level-icon" style="background: url(<%=item.user.vipInfo.icon%>);height: 22px;margin: 0;"></span>\n</a>\n<%}%>\n<%if(item.user.userLevel && item.user.userLevel>5){%>\n<a href="//lv.youku.com/page/grade/compare?uid=<%=item.user.userId%>" target="_blank" title="用户等级" class="user-grade-icon user-grade-lv<%=item.user.userLevel%>"></a>\n<%}%>\n<span class="comment-timestamp"><%=util.release(item.createTime)%></span>\n</div>\n<div class="comment-text">\n<p>\n<%if(item.flags && item.flags.isTop){%>\n<i class="comment-ico comment-ico-top"></i>\n<%}%>\n<%==textTransform(item.content, item)%>\n</p>\n<%if(item.parentComment && item.parentComment.content && item.parentComment.user){%>\n<p class="comment-source">\n<a href="<%=userDomain%><%=item.parentComment.user.userCode%>" target="_blank"  class="<%if(item.parentComment.isVip){%>redname<%}%>"><%=item.parentComment.user.userName%></a>:\n<%==textTransform(item.parentComment.content, item.parentComment)%>\n</p>\n<%}%>\n<%==commentImage.render({ picList: item.picList })%>\n</div>\n<% var toolbarHtml = !toolbar ? \'\' : toolbar.render({\nid: item.id,\nupCount: item.upCount, \ndownCount: item.downCount,\nreplyCount: item.replyCount,\nisTop: item.flags.isTop,\nuserId: item.user.userId, \nuserName: item.user.userName,\ncanDelete: userPermission.canDelete || loginUserInfo.yid == item.user.userId || loginUserInfo.userId == item.user.userId,\ncanSetTop: userPermission.canSetTop,\nshowReply: allowReply ? true : item.replyCount > 0\n})%>\n<%==toolbarHtml%>\n</div>\n<%if(item.flags && item.flags.isFame){%>\n<div class="starbg"></div>\n<%}%>\n</div>\n</div>\n<%});%>\n</div>\n</div>\n<%}%>\n<div class="comment-list-main comment-list-box">\n<div class="comment-list-head" <%if(data.currentPage != 1 || data.hot.length == 0){%>style="display:none;"<%}%>>\n<h3 class="title"><%=joinNewCommentTest ? \'大家都在聊\' : \'最新评论\'%></h3>\n</div>\n<div class="comment-list-body">\n<%if(data.comment.length>0){%>\n<%data.comment.forEach(function(item){%>\n<div class="comment-item" data-id="<%=item.id%>">\n<div class="comment-content">\n<div class="comment-user-avatar">\n<a href="<%=userDomain%><%=item.user.userCode%>" target="_blank"><img _hz="" src="<%=item.user.avatarMiddle%>"></a>\n</div>\n<div class="comment-section">\n<div class="comment-user-info">\n<a href="<%=userDomain%><%=item.user.userCode%>" class="<%if(item.user.vipInfo && [100002,100004,100006].indexOf(item.user.vipInfo.mmid) != -1){%>redname<%}%>" target="_blank">\n<%==getActivityName(item.user.userActName, item.user.color)%><%=item.user.aliasName || item.user.userName%>\n</a>\n<%if(videoOwnerId == item.user.userId){%>\n<span class="comment-usertitle">频道主</span>\n<%}%>\n<%if(item.user.vipInfo && [100002,100004,100006].indexOf(item.user.vipInfo.mmid) != -1){%>\n<a href="http://vip.youku.com/" title="<%=item.user.vipInfo.name%>" target="_blank">\n<span class="vip-level-icon" style="background: url(<%=item.user.vipInfo.icon%>);height: 22px;margin: 0;"></span>\n</a>\n<%}%>\n<%if(item.user.userLevel && item.user.userLevel>5){%>\n<a href="//lv.youku.com/page/grade/compare?uid=<%=item.user.userId%>" target="_blank" title="用户等级" class="user-grade-icon user-grade-lv<%=item.user.userLevel%>"></a>\n<%}%>\n<span class="comment-timestamp"><%=util.release(item.createTime)%></span>\n</div>\n<div class="comment-text">\n<p>\n<%if(item.flags && item.flags.isTop){%>\n<i class="comment-ico comment-ico-top"></i>\n<%}%>\n<%==textTransform(item.content, item)%>\n</p>\n<%if(item.parentComment && item.parentComment.content && item.parentComment.user){%>\n<p class="comment-source">\n<a href="<%=userDomain%><%=item.parentComment.user.userCode%>" target="_blank"  class="<%if(item.parentComment.isVip){%>redname<%}%>"><%=item.parentComment.user.userName%></a>:\n<%==textTransform(item.parentComment.content, item.parentComment)%>\n</p>\n<%}%>\n<%==commentImage.render({ picList: item.picList })%>\n</div>\n<% var toolbarHtml = !toolbar ? \'\' : toolbar.render({\nid: item.id,\nupCount: item.upCount, \ndownCount: item.downCount,\nreplyCount: item.replyCount,\nisTop: item.flags.isTop,\nuserId: item.user.userId, \nuserName: item.user.userName,\ncanDelete: userPermission.canDelete || loginUserInfo.yid == item.user.userId || loginUserInfo.userId == item.user.userId,\ncanSetTop: userPermission.canSetTop,\nshowReply: allowReply ? true : item.replyCount > 0\n})%>\n<%==toolbarHtml%>\n</div>\n<%if(item.flags && item.flags.isFame){%>\n<div class="starbg"></div>\n<%}%>\n</div>\n</div>\n<%});%>\n<%}else{%>\n<div class="comment-empty"><h3>暂无新评论～</h3></div>\n<%}%>\n</div>\n</div>\n<div class="comment-pager-footer">\n<%==pagerHtml%>\n</div>\n');var f=t.compile('<div class="comment-item" data-id="<%=item.id%>">\n<div class="comment-content">\n<div class="comment-user-avatar">\n<a href="<%=userDomain%><%=item.user.userCode%>" target="_blank"><img _hz="" src="<%=item.user.avatarMiddle%>"></a>\n</div>\n<div class="comment-section">\n<div class="comment-user-info">\n<a href="<%=userDomain%><%=item.user.userCode%>" class="<%if(item.user.vipInfo && [100002,100004,100006].indexOf(item.user.vipInfo.mmid) != -1){%>redname<%}%>" target="_blank">\n<%==getActivityName(item.user.userActName, item.user.color)%><%=item.user.aliasName || item.user.userName%>\n</a>\n<%if(videoOwnerId == item.user.userId){%>\n<span class="comment-usertitle">频道主</span>\n<%}%>\n<%if(item.user.vipInfo && [100002,100004,100006].indexOf(item.user.vipInfo.mmid) != -1){%>\n<a href="http://vip.youku.com/" title="<%=item.user.vipInfo.name%>" target="_blank">\n<span class="vip-level-icon" style="background: url(<%=item.user.vipInfo.icon%>);height: 22px;margin: 0;"></span>\n</a>\n<%}%>\n<%if(item.user.userLevel && item.user.userLevel>5){%>\n<a href="//lv.youku.com/page/grade/compare?uid=<%=item.user.userId%>" target="_blank" title="用户等级" class="user-grade-icon user-grade-lv<%=item.user.userLevel%>"></a>\n<%}%>\n<span class="comment-timestamp"><%=util.release(item.createTime)%></span>\n</div>\n<div class="comment-text">\n<p>\n<%if(item.flags && item.flags.isTop){%>\n<i class="comment-ico comment-ico-top"></i>\n<%}%>\n<%==textTransform(item.content, item)%>\n</p>\n<%if(item.parentComment && item.parentComment.content && item.parentComment.user){%>\n<p class="comment-source">\n<a href="<%=userDomain%><%=item.parentComment.user.userCode%>" target="_blank"  class="<%if(item.parentComment.isVip){%>redname<%}%>"><%=item.parentComment.user.userName%></a>:\n<%==textTransform(item.parentComment.content, item.parentComment)%>\n</p>\n<%}%>\n<%==commentImage.render({ picList: item.picList })%>\n</div>\n<% var toolbarHtml = !toolbar ? \'\' : toolbar.render({\nid: item.id,\nupCount: item.upCount, \ndownCount: item.downCount,\nreplyCount: item.replyCount,\nisTop: item.flags.isTop,\nuserId: item.user.userId, \nuserName: item.user.userName,\ncanDelete: userPermission.canDelete || loginUserInfo.yid == item.user.userId || loginUserInfo.userId == item.user.userId,\ncanSetTop: userPermission.canSetTop,\nshowReply: allowReply ? true : item.replyCount > 0\n})%>\n<%==toolbarHtml%>\n</div>\n<%if(item.flags && item.flags.isFame){%>\n<div class="starbg"></div>\n<%}%>\n</div>\n</div>\n');
var v=t.compile('\n<% var pagerHtml = data.totalPage > 1 ? \npager.render({ currentPage: data.currentPage, totalPage: data.totalPage, totalSize: data.totalSize }) :\n\'\';\n%>\n<%==pagerHtml%>\n<div class="comment-list-box">\n<div class="comment-list-head comment-myreply-tab">\n<a data-usertype="myComment" class="<%if(userType==\'myComment\'){%> active<%}%>">我收到的评论回复<%if(myComment){%>(<%=myComment%>)<%}%></a>\n<a data-usertype="myVideoComment" class="<%if(userType==\'myVideoComment\'){%> active<%}%>">我收到的视频评论<%if(myVideoComment){%>(<%=myVideoComment%>)<%}%></a>\n</div>\n<%if(data.userComment.length>0){%>\n<!--body begin-->\n<div class="comment-list-body">\n<%data.userComment.forEach(function(item,i){%>\n<!--一条回复内容 begin-->	\n<div class="comment-item">\n<div class="comment-content">\n<div class="comment-user-avatar">\n<a href="<%=userDomain%><%=item.user.userCode%>" target="_blank"><img _hz="" src="<%=item.user.avatarMiddle%>"></a>\n</div>\n<div class="comment-section">\n<div class="comment-user-info">\n<a href="<%=userDomain%><%=item.user.userCode%>" class="<%if(item.user.vipInfo && [100002,100004,100006].indexOf(item.user.vipInfo.mmid) != -1){%>redname<%}%>" target="_blank"><%=item.user.userName%></a>\n<%if(item.user.vipInfo){%>\n<%if(item.user.vipInfo.mmid=="100002"){%>\n<a href="http://vip.youku.com/" title="<%=item.user.vipInfo.name%>" target="_blank"><span  <%if(item.user.vipInfo.icon){%>style="background: url(<%=item.user.vipInfo.icon%>) 0px 0px no-repeat;height: 22px;"<%}%> class="vip-level-icon level-vip<%=item.user.vipInfo.vipGrade%>"></span></a>\n<%}else if(item.user.vipInfo.mmid=="100004"){%>\n<a href="http://vip.youku.com/" title="<%=item.user.vipInfo.name%>" target="_blank"><span  <%if(item.user.vipInfo.icon){%>style="background: url(<%=item.user.vipInfo.icon%>) 0px 0px no-repeat;height: 22px;"<%}%> class="vip-level-icon level-lvip<%=item.user.vipInfo.vipGrade%>"></span></a>\n<%}else if(item.user.vipInfo.mmid=="100006"){%>\n<a href="http://vip.youku.com/" title="<%=item.user.vipInfo.name%>" target="_blank"><span <%if(item.user.vipInfo.icon){%>style="background: url(<%=item.user.vipInfo.icon%>) 0px 0px no-repeat;height: 22px;"<%}%> class="vip-level-icon level-vip<%=item.user.vipInfo.vipGrade%>" ></span></a>\n<%}%>\n<%}%>\n<%if(item.user.userLevel && item.user.userLevel>5){%>\n<a href="//lv.youku.com/page/grade/compare?uid=<%=item.user.userId%>" target="_blank" title="用户等级" class="user-grade-icon user-grade-lv<%=item.user.userLevel%>"></a>\n<%}%>\n<span class="comment-timestamp"><%=util.release(item.createTime)%> </span>\n</div>\n<div class="comment-text">\n<p>\n<%==textTransform(item.content, item)%>\n</p>\n</div>\n<div class="comment-section comment-myreply">\n<div class="comment-text">\n<%if(item.parentComment){%>\n我的评论：<%==textTransform(item.parentComment.content, item)%>\n<%}%>\n</div>\n<div class="comment-myreply-source">\n<%if(item.videoInfo && item.videoInfo.thumburl){%>\n<a class="source-video-img" href="//v.youku.com/v_show/id_<%=item.videoInfo.videoId%>"><img src="<%=item.videoInfo.thumburl%>" alt="视频截图"></a>\n<%if(item.videoInfo.videoId){%>\n<p class="source-video-name">来自视频：<a href="//v.youku.com/v_show/id_<%=item.videoInfo.videoId%>"><%=item.videoInfo.title%></a></p>\n<%}%>\n<%}%>\n</div>\n</div>\n</div>\n</div>\n</div>\n<!--一条回复内容 end-->\n<%});%>\n</div>\n<!--body end-->\n<%}else{%>\n<div class="comment-empty"><h3>暂无评论～</h3></div>\n<%}%>\n</div>\n<%==pagerHtml%>\n');var h=t.compile('\n<% var pagerHtml = data.totalPage > 1 ? \npager.render({ currentPage: data.page, totalPage: data.totalPage, totalSize: data.pageResult.totalSize }) :\n\'\';\n%>\n<%==pagerHtml%>\n<%if(data.pageResult.data){%>\n<div class="comment-list-box">\n<div class="comment-list-body comment-list-db">\n<%data.pageResult.data.forEach(function(item,i){%>\n<%if(i < data.lastpagenumber){%>\n<div class="comment-item <%if(item.islastone){%>comment_last<%}%>">\n<div class="comment-user-info">\n<a href="<%=item.author.alt%>" target="_blank"><%=item.author.name%></a>\n<label><i class="comment-ico comment-ico-db"></i></label>\n</div>\n<div class="comment-text"><%=item.content%></div>\n<div class="panel"><span class="comment-timestamp"><%=item.created_at%></span></div>\n</div>\n<%}%>\n<%});%>\n<%if(data.cometoDouBanUrl){%>\n<div class="more"><a href="<%=data.cometoDouBanUrl%>" target = "_blank">去豆瓣查看更多</a></div>\n<%}%>\n</div>\n</div>\n<%}else{%>\n<div class="comment-empty"><h3>暂无豆瓣评论～</h3></div>\n<%}%>\n<%==pagerHtml%>\n');var g={2:"myComment",4:"myVideoComment"};var b=n.extend({initialize:function(t){var n=this;n.parentModule=t.parentModule;n.scroll=e.extend({container:"html,body",scrollTop:function(e){return e.offset().top}},t.scroll);n.objectInfo=t.objectInfo;n.userPermission=t.userPermission;n.pager=new m({el:n.$el,changePage:function(e){n.loadParam.currentPage=e;n.load(n.loadParam,"changePage")}});n.commentImage=new r({el:n.$el});var i=new l({parentModule:n});i.bind("load:before",function(t){if(!u.check("commentOpen"))e(n.scroll.container).animate({scrollTop:n.scroll.scrollTop(t.closest(".comment-item"))},500)});n.toolbar=new c({el:n.$el,objectInfo:n.objectInfo,items:{showUp:true,showDown:true,showReply:true,showDelete:true,showSetTop:true,showInform:false},commentReply:function(t){i.starLink=n.starLink;var a=e(t.target);var o=a.closest(".comment-item");var s=e(".comment-reply",o).length>0;i.clear();if(!s)i.render({el:o,objectInfo:n.objectInfo,commentId:a.data("id"),userId:a.data("uid")});return false},commentDeleteCallback:function(e){n.removeItem(e)},commentTopCallback:function(){n.loadParam.currentPage=1;n.load(n.loadParam,"setTop")}});d.bind("login:after",function(e){n.updateDiffItem()})},events:{"click .comment-empty a":"refresh","click a.seekTime":"seekTime","click .comment-myreply-tab a":"changeMyReply"},seekTime:function(t){if(t&&t.preventDefault){t.preventDefault();t=e(t.currentTarget).data("time")}t=parseInt(t);if(t&&window.ykPlyr&&e.isFunction(window.ykPlyr.PlayerSeek)){window.ykPlyr.PlayerSeek(t);window.scroll(0,0)}},refresh:function(){this.load(this.loadParam)},textTransform:function(e,t){var n=this;e=a.escapeHtml(e);u.check("text.star",function(){e=a.star(e,n.starLink)});u.check("text.at",function(){e=a.at(e,t.atUsers)});u.check("text.ht",function(){e=a.ht(e,t.topics)});e=a.timer(e);e=a.url(e);e=a.face(e);return e},load:function(e,t,n){var i=this;i.loadParam=e;i.trigger("load:before",[e.currentPage,e.listType,t]);i.$el.html('<div class="comment-empty comment-loading"></div>');if("db"==e.listType){i.dataComments=null;i.loadDbComment(e,t);return}if("mycomment"==e.listType){i.dataComments=null;i.loadMyComment(e,t);return}i.loadComment(e,t,n)},loadComment:function(e,t,n){var s=this;if("0"==s.objectInfo.objectId||""==s.objectInfo.objectId)return false;o.commentList({app:"pc",objectId:s.objectInfo.objectId,objectType:s.objectInfo.objectType,listType:e.listType||0,currentPage:e.currentPage||1,pageSize:e.pageSize||30},function(o,r){if(0!=o.code){s.$el.html('<div class="comment-empty">似乎出问题了,点击<a href="javascript:;">刷新</a>一下看看吧~</div>');return}if(!u.check("text.hotComment"))o.data&&(o.data.hot=[]);if(!u.check("commentOpen")&&u.isJoinCommentTest()){if("init"==t)window.goldlog&&window.goldlog.record("/yt/ykcomment.play.commentNewAlgorithm","EXP","type=init_"+(r?"new":"old")+"&showid="+u.globals.page.showid+"&videocode="+u.globals.page.videoId2,"H1512895196");o.data.hot=[].concat(o.data.hot).filter(function(e){return e&&e.flags&&e.flags.isTop})}s.dataComments=o.data;s.$el.html(p({data:o.data,util:i,textTransform:s.textTransform.bind(s),videoOwnerId:u.globals.page.videoOwner,loginUserInfo:d.getUserInfo()||{},userPermission:s.userPermission,commentImage:s.commentImage,toolbar:s.toolbar,pager:s.pager,allowReply:u.check("operate.reply"),userDomain:u.globals.userDomain,joinNewCommentTest:1==u.isJoinCommentTest(),getActivityName:a.activityName}));n&&n();s.trigger("load:after",[o.data,e.listType,t])})},loadDbComment:function(e,t){var n=this;o.getDbComment({app:"pc",page:e.currentPage,videoId:n.objectInfo.objectId,showId:u.globals.page.showid},function(e){if(0!=e.code){n.$el.html('<div class="comment-empty">似乎出问题了,点击<a href="javascript:;">刷新</a>一下看看吧~</div>');return}n.$el.html(h({data:e.data.con,util:i,textTransform:n.textTransform.bind(n),pager:n.pager}));n.trigger("load:after",[e.data.con,"db",t])})},loadMyComment:function(e,t){var n=this;var a={app:"pc",userType:e.userType||2,currentPage:e.currentPage||1,pageSize:e.pageSize||30};o.getUserComment(a,function(e){if(0!=e.code){n.$el.html('<div class="comment-empty">似乎出问题了,点击<a href="javascript:;">刷新</a>一下看看吧~</div>');return false}var o=g[a.userType];if(1==a.currentPage)if("myComment"==o)n.myCommentNum=e.data.totalSize;else if("myVideoComment"==o)n.myVideoCommentNum=e.data.totalSize;n.$el.html(v({data:e.data,util:i,textTransform:n.textTransform.bind(n),userType:o,myComment:n.myCommentNum,myVideoComment:n.myVideoCommentNum,pager:n.pager,userDomain:u.globals.userDomain}));n.trigger("load:after",[e.data,"mycomment",t])})},changeMyReply:function(t){var n=this;var i=e(t.currentTarget);var a=i.data("usertype");for(var o in g)if(a==g[o]){a=o;break}n.loadParam.userType=a;n.loadParam.currentPage=1;n.load(n.loadParam)},removeItem:function(t){var n=this;e('[data-id="'+t+'"]',n.$el).remove();var i=e(".comment-list-main .comment-list-body",n.$el);if(0===i.children().length)i.append('<div class="comment-empty"><h3>暂无新评论～</h3></div>')},add:function(t){var n=this;n.$el.find(".comment-list-main .comment-list-body").prepend(f({item:{user:{aliasName:"我",userId:-1,userName:t.userName,avatarMiddle:t.userImage},picList:t.picList,content:t.content,createTime:Date.now()},util:i,textTransform:n.textTransform.bind(n),commentImage:n.commentImage,userDomain:u.globals.userDomain,getActivityName:a.activityName}));n.trigger("add:after",[]);e(".comment-empty",n.$el).remove()},scrollTop:function(t){var n=this;var i=n.$el;if(2==t&&0==(i=e(".comment-list-main",n.$el)).length)i=n.$el;if(3==t&&0==(i=e(".comment-list-hot",n.$el)).length)i=n.$el;e(n.scroll.container).animate({scrollTop:n.scroll.scrollTop(i)},500)},updateDiffItem:function(){var t=this;if(!t.dataComments)return;var n=d.getUserInfo();var i=t.dataComments.comment.concat(t.dataComments.hot).filter(function(e){return e.user.userId==n.userId||e.user.userId==n.yid||t.userPermission.canDelete||t.userPermission.canSetTop});i.forEach(function(i){var a=e('.comment-item[data-id="'+i.id+'"] > .comment-content .comment-handle',t.$el);var o=t.toolbar.render({id:i.id,upCount:i.upCount,downCount:i.downCount,replyCount:i.replyCount,isTop:i.flags.isTop,userId:i.user.userId,userName:i.user.userName,canDelete:t.userPermission.canDelete||i.user.userId==n.userId||i.user.userId==n.yid,canSetTop:t.userPermission.canSetTop,showReply:u.check("operate.reply")?true:i.replyCount>0});if(a.html()!=e(o).html())a.replaceWith(o)})}});return b});n("tui/popup",[],function(){var t=!("minWidth"in e("html")[0].style);var n=!t;function i(){this.destroyed=false;this.__popup=e("<div />").css({display:"none",position:"absolute",outline:0}).attr("tabindex","-1").html(this.innerHTML).appendTo("body");this.__backdrop=this.__mask=e("<div />").css({opacity:.7,background:"#000"}).append(e("<iframe />").attr("frameborder",0).css({position:"absolute",top:0,left:0,width:"100%",height:"100%",background:"#000",opacity:0}));this.node=this.__popup[0];this.backdrop=this.__backdrop[0]}e.extend(i.prototype,{node:null,backdrop:null,fixed:false,destroyed:true,open:false,returnValue:"",autofocus:true,align:"bottom left",innerHTML:"",className:"ui-popup",setHtml:function(e){var t=this.__popup;if(t)t.html(e);return this},show:function(a){if(this.destroyed)return this;var o=this.__popup;var s=this.__backdrop;this.__activeElement=this.__getActive();this.open=true;this.follow=a||this.follow;if(!this.__ready){o.addClass(this.className).attr("role",this.modal?"alertdialog":"dialog").css("position",this.fixed?"fixed":"absolute");if(!t)e(window).on("resize",e.proxy(this.reset,this));if(this.modal){var r={position:"fixed",left:0,top:0,width:"100%",height:"100%",overflow:"hidden",userSelect:"none",zIndex:this.zIndex||i.zIndex};o.addClass(this.className+"-modal");if(!n)e.extend(r,{position:"absolute",width:e(window).width()+"px",height:e(document).height()+"px"});s.css(r).attr({tabindex:"0"}).on("focus",e.proxy(this.focus,this));this.__mask=s.clone(true).attr("style","").insertAfter(o);s.addClass(this.className+"-backdrop").insertBefore(o);this.__ready=true}if(!o.html())o.html(this.innerHTML)}o.addClass(this.className+"-show").show();s.show();this.reset().focus();this.__dispatchEvent("show");return this},showModal:function(){this.modal=true;return this.show.apply(this,arguments)},close:function(e){if(!this.destroyed&&this.open){if(void 0!==e)this.returnValue=e;this.__popup.hide().removeClass(this.className+"-show");this.__backdrop.hide();this.open=false;this.blur();this.__dispatchEvent("close")}return this},remove:function(){if(this.destroyed)return this;this.__dispatchEvent("beforeremove");if(i.current===this)i.current=null;this.__popup.remove();this.__backdrop.remove();this.__mask.remove();if(!t)e(window).off("resize",this.reset);this.__dispatchEvent("remove");for(var n in this)delete this[n];return this},reset:function(){var e=this.follow;if(e)this.__follow(e);else this.__center();this.__dispatchEvent("reset");return this},focus:function(){var t=this.node;var n=this.__popup;var a=i.current;var o=this.zIndex=i.zIndex++;if(a&&a!==this)a.blur(false);if(!e.contains(t,this.__getActive())){var s=n.find("[autofocus]")[0];if(!this._autofocus&&s)this._autofocus=true;else s=t;this.__focus(s)}n.css("zIndex",o);i.current=this;n.addClass(this.className+"-focus");this.__dispatchEvent("focus");return this},blur:function(){var e=this.__activeElement;var t=arguments[0];if(false!==t)this.__focus(e);this._autofocus=false;this.__popup.removeClass(this.className+"-focus");this.__dispatchEvent("blur");return this},addEventListener:function(e,t){this.__getEventListener(e).push(t);return this},removeEventListener:function(e,t){var n=this.__getEventListener(e);for(var i=0;i<n.length;i++)if(t===n[i])n.splice(i--,1);return this},__getEventListener:function(e){var t=this.__listener;if(!t)t=this.__listener={};if(!t[e])t[e]=[];return t[e]},__dispatchEvent:function(e){var t=this.__getEventListener(e);if(this["on"+e])this["on"+e]();for(var n=0;n<t.length;n++)t[n].call(this)},__focus:function(e){try{if(this.autofocus&&!/^iframe$/i.test(e.nodeName))e.focus()}catch(t){}},__getActive:function(){try{var e=document.activeElement;var t=e.contentDocument;var n=t&&t.activeElement||e;return n}catch(i){}},__center:function(){var t=this.__popup;var n=e(window);var i=e(document);var a=this.fixed;var o=a?0:i.scrollLeft();var s=a?0:i.scrollTop();var r=n.width();var c=n.height();var l=t.width();var m=t.height();var u=(r-l)/2+o;var d=382*(c-m)/1e3+s;var p=t[0].style;p.left=Math.max(parseInt(u),o)+"px";p.top=Math.max(parseInt(d),s)+"px"},__follow:function(t){var n=t.parentNode&&e(t);var i=this.__popup;if(this.__followSkin)i.removeClass(this.__followSkin);if(n){var a=n.offset();if(a.left*a.top<0)return this.__center()}var o=this;var s=this.fixed;var r=e(window);var c=e(document);var l=e(this.rangeNode);var m=0;var u=0;var d=0;var p=0;var f=l.offset();if(f){m=f.left;u=f.top;p=l.width();d=l.height()}var v=r.width();var h=r.height();var g=c.scrollLeft();var b=c.scrollTop();var y=i.width();var w=i.height();var _=n?n.outerWidth():0;var x=n?n.outerHeight():0;var C=this.__offset(t);var I=C.left;var k=C.top;var T=s?I-g:I;var j=s?k-b:k;var P=h+b;var S=d+u;var L=v+g;var z=p+m;var N=s?0:g>m?g:m;var D=s?0:b>u?b:u;var $=N-y+(L>z?m<g?z-g:p:m>g?L-m:v);var E=D-w+(P>S?u<b?S-b:d:u>b?P-u:h);var F={};var O=this.align.split(" ");var R=this.className+"-";var q={top:"bottom",bottom:"top",left:"right",right:"left"};var A={top:"top",bottom:"top",left:"left",right:"left"};var U=[{top:j-w,bottom:j+x,left:T-y,right:T+_},{top:j,bottom:j-w+x,left:T,right:T-y+_}];var M={left:T+_/2-y/2,top:j+x/2-w/2};var V={left:[N,$],top:[D,E]};e.each(O,function(e,t){if(U[e][t]>V[A[t]][1])t=O[e]=q[t];if(U[e][t]<V[A[t]][0])O[e]=q[t]});if(!O[1]){A[O[1]]="left"===A[O[0]]?"top":"left";U[1][O[1]]=M[A[O[1]]]}R+=O.join("-")+" "+this.className+"-follow";o.__followSkin=R;if(n)i.addClass(R);F[A[O[0]]]=parseInt(U[0][O[0]]);F[A[O[1]]]=parseInt(U[1][O[1]]);i.css(F)},__offset:function(t){var n=t.parentNode;var i=n?e(t).offset():{left:t.pageX,top:t.pageY};t=n?t:t.target;var a=t.ownerDocument;var o=a.defaultView||a.parentWindow;if(o==window)return i;var s=o.frameElement;var r=e(a);var c=r.scrollLeft();var l=r.scrollTop();var m=e(s).offset();var u=m.left;var d=m.top;return{left:i.left+u-c,top:i.top+d-l}}});i.zIndex=1024;i.current=null;return i});n("module/comment/v3/postsContent",["tui/art","tui/view","tui/popup","tui/dialog","module/comment/v3/model","module/comment/v3/commentToolbar","module/comment/v3/commentList","module/comment/v3/form","module/comment/v3/utils","module/comment/v3/commentConfig","module/comment/v3/commentLogin"],function(t,n,i,a,o,s,r,c,l,m,u){i.zIndex=2e4;var d=t.compile('<div class="posts-content">\n<div class="posts-item">\n<div class="posts-title">\n<%=data.title%>\n</div>\n<div class="posts-userinfo posts-spacing">\n<a href="<%=userDomain%><%=data.user.userCode%>" class="<%if(data.user.vipInfo && [100002,100004,100006].indexOf(data.user.vipInfo.mmid) != -1){%>redname<%}%>" target="_blank"><%=data.user.userName%></a>\n<span class="posts-usertitle"><%=videoOwnerId == data.user.userId ? \'频道主\' : \'楼主\'%></span>\n<%if(data.user.vipInfo && [100002,100004,100006].indexOf(data.user.vipInfo.mmid) != -1){%>\n<a href="http://vip.youku.com/" title="<%=data.user.vipInfo.name%>" target="_blank">\n<span class="vip-level-icon" style="background: url(<%=data.user.vipInfo.icon%>);height: 22px;margin: 0;"></span>\n</a>\n<%}%>\n<%if(data.user.userLevel && data.user.userLevel>5){%>\n<a href="http://lv.youku.com/page/grade/compare?uid=<%=data.user.userId%>" target="_blank" title="用户等级" class="user-grade-icon user-grade-lv<%=data.user.userLevel%>"></a>\n<%}%>\n<span class="posts-timestamp"><%=data.createTimeFormat.replace(\'发表于\',\'\')%></span>\n</div>\n<div class="posts-text">\n<%==escapePostsHtml(data.content)%>\n</div>\n<div class="posts-handle fix">\n<div class="posts-share" style="display:none;">\n<span class="posts-share-title">分享</span>\n<a href="javascript:;" class="posts-share-btn icon-weixin"></a>\n<a href="javascript:;" class="posts-share-btn icon-weibo"></a>\n<a href="javascript:;" class="posts-share-btn icon-qzone"></a>\n<a href="javascript:;" class="posts-share-btn icon-qq"></a>\n</div>\n<% var toolbarHtml = toolbar.render({ \nid: data.postId,\nupCount: data.upCount, \ndownCount: data.downCount,\nreplyCount: data.commentCount, \nuserId: data.user.userId,\nuserName: data.user.userName,\n})%>\n<%==toolbarHtml%>\n</div>\n</div>\n<div class="posts-comment">\n<div class="posts-comment-form"></div>\n<div class="posts-comment-list"></div>\n</div>\n</div>');var p=n.extend({initialize:function(e){var t=this;t.objectInfo=e.objectInfo;t.param=e||{};t.initCommon()},scrollForm:function(){var e=this;var t=e.form;if(!t)return;var n=e.$el;n.scrollTop(n.scrollTop()+t.$el.get(0).getBoundingClientRect().top);t.focus()},eventsPopup:{"click .posts-content-popup-close":function(){this.popup&&this.popup.remove()}},eventsPage:{},initPage:function(){this.$el.html('<div class="posts-cotent-loading">')},remove:function(){self.popup&&self.popup.remove();self.form&&self.form.remove();self.form=null;self.popup=null;self.$el=null},togglePlay:function(t,n){e("html,body").css({overflow:t?"":"hidden"});var i=window.ykPlyr;if(i&&e.isFunction(i.PlayerPause))i.PlayerPause(n)},initPopup:function(){var t=this;var n=new i;n.clickbackdropclose=true;n.fixed=true;n.className="posts-content-popup";n.setHtml('<div class="posts-content-popup-body"><a class="iconfont posts-content-popup-close"></a><div class="posts-cotent-loading"></div></div>');var a=document.getElementById("movie_player");var o;n.onshow=function(){if(a&&a.isPause)o=a.isPause();t.togglePlay(false,true)};n.onremove=function(){t.togglePlay(true,void 0==o?false:o);t.remove()};t.popup=n;t.events=t.eventsPopup;t.setElement(e(".posts-content-popup-body",e(n.node)),true);e(n.node).on("click",function(e){if(e.target===e.currentTarget)n&&n.remove()});n.showModal()},initCommon:function(){var e=this;e.userPermission={canSetTop:false,canDelete:false}},render:function(t){var n=this;n.param.el?n.initPage():n.initPopup();if(!n.$el){console.error("not found contentNode");return}o.getPostsContent({app:"pc",objectId:n.objectInfo.objectId,objectType:n.objectInfo.objectType,postId:t},function(i){if(0!=i.code)return;n.param.el&&i.data.title&&(document.title=i.data.title);n.toolbar=new s({el:n.$el,objectInfo:n.objectInfo,items:{showUp:true,showDown:true,showReply:true},commentReply:function(){n.scrollForm();return false}});e(".posts-cotent-loading",n.$el).replaceWith(d({data:i.data,toolbar:n.toolbar,videoOwnerId:m.globals.page.videoOwner,escapePostsHtml:n.escapePostsHtml.bind(n),userDomain:m.globals.userDomain}));var a=n.form=new c({el:e(".posts-comment-form",n.$el),submitArgs:{objectId:t,objectType:2},picUploadId:"posts",faces:{rangeNode:n.$el}});a.bind("submit:success",function(e){if(0!=e.code)return;o.add({userName:e.data.userName,userImage:e.data.avatarMiddle,picList:e.picList,content:e.params.content},function(){})});var o=new r({el:e(".posts-comment-list",n.$el),parentModule:n,objectInfo:{objectId:t,objectType:2},userPermission:{canDelete:(u.getUserInfo()||{}).userId==i.data.user.userId,canSetTop:false},scroll:{container:n.$el,scrollTop:function(e){return n.$el.scrollTop()+e[0].getBoundingClientRect().top}}});o.load({listType:0,currentPage:1})})},escapePostsHtml:function(e){var t=this;e=l.escapePostsHtml(e);e=t.parseActiveMark(e);return e},parseActiveMark:function(t){var n=this;var i;t=t.replace(/\[activity\s+([^\]]+)\]/,function(e,t){i=t||0;return""});if(i){t='<p class="posts-activity"></p>'+t;o.getActivityInfo({activityId:i},function(t){if(0!=t.code)return;var s=[];(t.data.roleList||[]).forEach(function(e){if(!e||void 0===e.id)return;s.push('<span><a class="role-bgimg"  href="javascript:;" data-id="'+i+'" data-role="'+e.id+'">'+e.roleName+"</a></span>")});if(s.length>0)s.push("<span>已领取昵称的人数："+t.data.count+"</span>");e(".posts-activity",n.$el).on("click","a",function r(t){if(!u.isLogin())return u.login(function(){r(t)});var n=e(t.target);o.addActivityName({activityId:n.data("id"),roleId:n.data("role")},function(e){var t;switch(e.code){case 0:t="你已经成功领取应援昵称："+e.data+"，快来给你的爱豆应援吧。";break;case 5010:t="不要贪心哦，你已经领取过昵称了，直接去说些什么吧。";break;default:t=e.message}a.alert({zIndex:20010,content:t})})}).html(s.join(""))})}return t}});return p});n("module/comment/v3/posts",["tui/art","tui/view","tui/popup","module/comment/v3/model","module/comment/v3/postsContent","module/comment/v3/commentToolbar","module/comment/v3/commentImage","module/comment/v3/utils","module/comment/v3/commentConfig"],function(t,n,i,a,o,s,r,c,l){var m=t.compile('<%data.forEach(function(item,i){%>\n<div class="posts-item" data-id="<%=item.postId%>">\n<div class="posts-userphoto">\n<a href="<%=userDomain%><%=item.user.userCode%>" target="_blank">\n<img src="<%=item.user.avatarLarge%>">\n</a>\n</div>\n<div class="posts-section">\n<div class="posts-userinfo">\n<a href="<%=userDomain%><%=item.user.userCode%>" class="<%if(item.user.vipInfo && [100002,100004,100006].indexOf(item.user.vipInfo.mmid) != -1){%>redname<%}%>" target="_blank"><%=item.user.userName%></a>\n<% if(videoOwnerId == item.user.userId){%>\n<span class="posts-usertitle">频道主</span>\n<%}%>\n<%if(item.user.vipInfo && [100002,100004,100006].indexOf(item.user.vipInfo.mmid) != -1){%>\n<a href="http://vip.youku.com/" title="<%=item.user.vipInfo.name%>" target="_blank">\n<span class="vip-level-icon" style="background: url(<%=item.user.vipInfo.icon%>);height: 22px;margin: 0;"></span>\n</a>\n<%}%>\n<%if(item.user.userLevel && item.user.userLevel>5){%>\n<a href="//lv.youku.com/page/grade/compare?uid=<%=item.user.userId%>" target="_blank" title="用户等级" class="user-grade-icon user-grade-lv<%=item.user.userLevel%>"></a>\n<%}%>\n<span class="posts-timestamp"><%=item.createTimeFormat.replace(\'发表于\',\'\')%></span>\n</div>\n<div class="posts-title posts-spacing">\n<a href="javascript:;"><%=item.title%></a>\n</div>\n<div class="posts-text">\n<%==escapePostsHtml(item.digest)%>\n</div>\n<div class="posts-image">\n<%==commentImage.render({ picList: item.picList })%>\n</div>\n<%if(item.stamp){%>\n<div class="posts-tag">\n<img src="<%=item.stamp%>" alt="">\n</div>\n<%}%>\n<% var toolbarHtml = toolbar.render({ \nid: item.postId,\nupCount: item.upCount, \ndownCount: item.downCount,\nreplyCount: item.commentCount,\nuserId: item.user.userId,\nuserName: item.user.userName,\n})%>\n<%==toolbarHtml%>\n</div>\n</div>\n<%})%>');var u=n.extend({initialize:function(t){var n=this;n.objectInfo=t.objectInfo;n.postsContent=new o({objectInfo:n.objectInfo});n.commentImage=new r({el:n.$el});n.toolbar=new s({el:n.$el,objectInfo:n.objectInfo,items:{showUp:true,showDown:true,showReply:true},commentReply:function(e){n.showContent(e);return false}});e(window).on("resize",function(){setTimeout(function(){n.computeContentFold(true)},200)});if(t.el&&true!==t.lazyLoad)n.loadPosts(3)},events:{"click .posts-fold-btn":"showContent","click .posts-title a":"showContent","click .posts-more a":"loadMore"},loadMore:function(t){var n=this;var i=e(t.target).parent();i.addClass("posts-more-loading");n.loadPosts(10,"",function(){i.removeClass("posts-more-loading")})},refresh:function(e){this.listType=e;this.lastPostId=0;this.loadPosts(3,"html")},loadPosts:function(t,n,i){var o=this;a.getPosts({app:"pc",objectId:o.objectInfo.objectId,objectType:o.objectInfo.objectType,listType:o.listType||0,lastPostId:o.lastPostId,limit:t},function(t){if(0==t.code){o.lastPostId=t.data.lastPostId;var a=e(">.posts-list,>.posts-more",o.$el);if(0===a.length)a=e('<div class="posts-list"></div><div class="posts-more"><a href="javascript:;">查看更多</a></div>').appendTo(o.$el);a.eq(0)[n||"append"](m({data:t.data.posts,toolbar:o.toolbar,videoOwnerId:l.globals.page.videoOwner,commentImage:o.commentImage,escapePostsHtml:c.escapePostsHtml,userDomain:l.globals.userDomain}))}i&&i();o.trigger("load:after",[t.data&&t.data.posts])})},showContent:function(t){this.postsContent.render(e(t.target).closest(".posts-item").data("id"))},computeContentFold:function(t){var n=this;var i=n.$el.find(".posts-text");var a=Math.floor(14*1.8);var o=Math.floor(i.width()/14);i.each(function(n,i){var s=e(i);if(true!==t&&e(".posts-fold-btn",s).length>0)return true;var r=s.outerHeight();if(s.get(0).scrollHeight-r>1){var c=s.find(">p,>br");var l;s.find(".posts-fold-btn").remove();c.each(function(t,n){var i=e(n);var s=n.nodeName.toLowerCase();if(i.position().top+(i.height()||a)<r){"p"===s&&(l=i);return true}if("br"===s)i=l;if(!i)return;var c=i.html();var m=Math.floor((r-i.position().top)/a*o-6);m=Math.min(m,c.length);var u=new RegExp("(.{"+m+"})(.*)");i.html(c.replace(u,'$1<a href="javascript:;" data-id="" class="posts-fold-btn posts-fold-btn-show">&nbsp;&nbsp;阅读全文<br/><br/><br/><br/></a>$2'));return false})}})}});return u});n("module/comment/v3/starComming",["tui/util/codec"],function(t){var n={init:function(e){if(!e.storage)return false;var t=e.storage.starreview;if(t.length>0)this.dowhat(t);else return false},dowhat:function(t){var n=this;for(var i in t){var a=t[i]["pk_id"];if(a){var o=this.inputTest(t[i]);if(o<0)e("#starCommingPannel_"+a).remove();else n.createDOM(t[i],o)}}},createDOM:function(e,n){var i='<em class="ico-comstar"></em>';var a=e["content"];if("inComming"==n)a=e["content2"];else if("afterComming"==n)a=e["content3"];var o='<div id = "starCommingPannel_'+e["pk_id"]+'" class="comment-Starhint">'+'<div class="starhint-close" style="display:none;" onclick= "starComming.closeClick(this);"></div>'+"<dl>"+'<dt><a href="//i.youku.com/u/'+t.encodeUid(e["starid"])+'" target="_blank"><img src="'+e["icon"]+'"></a></dt>'+'<dd><a href="//i.youku.com/u/'+t.encodeUid(e["starid"])+'" target="_blank">'+e["starname"]+"</a>"+i+"<br><span>"+e["role"]+"</span></dd>"+"</dl>"+'<div class="starhintDetail">'+"<p><span>"+a+"</span></p>"+'<a href="'+e["link"]+'" target="_blank">去看看</a>'+"</div>"+"</div>";jQuery("#videocomment").before(o)},getVIDFromURL:function(e){if("string"!=typeof e)return false;var n=e.match(/v_show\/id_([\w=]+)(\.*?)/);n=n[1]?t.decode64(n[1].substr(1))>>2:false;return n},inputTest:function(e){var t=-1;if("undefined"==typeof e["pk_id"]||0==e["pk_id"])return-1;if("undefined"==typeof e["status"]||0==e["status"])return-1;var n=1e3*e["begintime"];var i=1e3*e["starbgtime"];var a=1e3*e["starendtime"];var o=1e3*e["expiretime"];if(n>i||i>a||a>o)return-5;var s=(new Date).getTime();if(s>o)return-6;if(s<n)return-10;if(s>=n&&s<=i)t="beforeComming";else if(s>=i&&s<a)t="inComming";else if(s>=a&&s<=o)t="afterComming";else if(s>o)t="starCommingOver";return t}};return n});n("module/comment/v3/comment",["tui/view","tui/art","tui/util","module/comment/v3/model","module/comment/v3/form","module/cms/dataStore","module/comment/v3/starComming","module/comment/v3/commentList","module/comment/v3/posts","module/comment/v3/cmtegg","module/comment/v3/commentConfig","module/comment/v3/commentLogin"],function(t,n,i,a,o,s,r,c,l,m,u,d){var p=n.compile('<div class="comment-area <%=videoClass%>" <%=getSpmConfig(\'comment\')%> >\n<div id="commentAction" class="comment-area-form"></div>\n<div id="videocomment" class="comment-area-box">\n<div class="comment-tab">\n<ul class="comment-tab-left">\n<li data-type="all" class="current comment-show">全部评论<em class="num" id="allCommentNum"></em></li>\n<li data-type="db">豆瓣评论</li>\n<li data-type="owner">频道主说</li>\n<li data-type="star">明星说</li>\n</ul>\n<ul class="comment-tab-right">\n<li data-type="my">我的评论消息</li>\n<li data-type="input" <%=getSpmConfig(\'commentinput\')%> ><i class="icon-publish-comment"></i>发表评论</li>\n</ul>\n</div>\n<div class="comment-new-tooltip" style="display:none;">\n<a style="display:block;" charset="hz-4001208" href="javascript:;">有新评论，刷新看看</a>\n</div>\n<div class="comment-area-list">\n<div id="videoPostslist" class="posts-list-area comment-list-box">\n<div class="comment-list-head">\n<h3 class="title">热门<%=isShowVideo > 0 ? \'影评\' : \'长评\'%></h3>\n</div>\n<div class="comment-list-body">\n</div>\n</div>\n<div id=\'videoCommentlist\'></div>\n</div>\n<div class="forbid forbidden_comment" style="display:none">\n<h3>当前视频暂不支持评论。</h3>\n</div>\n<div id="commentPublish" class="comment-tooltip">\n<a href="javascript:;">发表评论</a>\n</div>\n</div>\n</div>');var f=e(window);var v={all:0,owner:1,star:2,db:"db",my:"mycomment"};var h={"频道主说":"owner","豆瓣评论":"db","明星说":"star"};var g=t.extend({hasLoaded:false,comstatus:3e4,comstatusNum:1,initialize:function(t){var n=this;n.slefext(t);n.$el.html(p({videoClass:u.globals.videoClass||"",isShowVideo:u.globals.page.showid>0,getSpmConfig:function(e){return u.getCommentTestSpmConfig(e,0)}}));n.$tabList=e(".comment-tab li",n.$el);if(u.check("operate.input")){n.form=new o({el:"#commentAction",gift:true,submitArgs:n.objectInfo,picUploadId:"comment",faces:{rangeNode:n.$el}});n.modelEvents(n.form,"form")}else e("#commentPublish").remove();var a=n.commentList=new c({el:"#videoCommentlist",objectInfo:n.objectInfo,userPermission:n.userPermission,parentModule:n,scroll:{scrollTop:function(t){if(t.is("#videoCommentlist"))t=e(".comment-area-list",n.$el);return t.offset().top-130}}});a.bind("load:before",function(){e(".comment-area-list",n.$el).removeClass("comment-list-hasposts")}).bind("load:after",function(t,o,s){if(0==o&&0!=t.comment.length){e(".comment-new-tooltip",n.$el).hide();if(1==t.currentPage){n.lastid=t.comment[0].id;var r=t.comment[0].createTime;var c=new Date(r);var l=new Date;var m=l.getTime()-c.getTime();n.lasttime=parseInt(m/(24*60*1e3*60));e("#allCommentNum").html("("+i.split(t.totalSize)+")")}}else n.lasttime=15;if(u.check("posts")){n.hasCommentPager=t.totalPage>1;
n.showPosts=[0,1].indexOf(o)!=-1&&1==t.currentPage;n.togglePosts()}if(!u.check("commentOpen")&&"add"!=s&&"init"!=s)a.scrollTop(["commentnew","setTop"].indexOf(s)+2)}).bind("add:after",function(){if(!u.check("commentOpen"))a.scrollTop(2)});if(u.check("posts")){n.posts=new l({el:"#videoPostslist .comment-list-body",objectInfo:n.objectInfo,lazyLoad:true});n.posts.bind("load:after",function(e){n.hasPostsData=e&&e.length>0;n.togglePosts()})}n.lazyLoad();n.commentEgg();if(!u.check("commentOpen"))window.goldlog&&window.goldlog.record("/yt/ykcomment.play.commentInit","EXP","objectId="+n.objectInfo.objectId,"H1505507056")},togglePosts:function(){var t=this;var n=t.$el;if(!u.check("posts"))return;var i=t.showPosts&&t.hasPostsData;var a=e(".comment-area-list",t.$el);a[i?"addClass":"removeClass"]("comment-list-hasposts");a[!t.hasCommentPager?"addClass":"removeClass"]("comment-list-nopager");if(a.hasClass("comment-list-hasposts"))t.posts&&t.posts.computeContentFold();if(0==e(".comment-list-hot",n).length)e(".comment-list-main .comment-list-head",n)[i?"show":"hide"]()},events:{"click .comment-tab li":"tabChange","click .comment-new-tooltip a":"commentNewNotic","click #commentPublish":function(){this.scrollForm()}},"{form} submit:success":function(e){var t=this;var n=function(){if(!e.data)return false;t.commentList.add({userName:e.data.userName,userImage:e.data.avatarMiddle,picList:e.picList,content:e.params.content})};var i=t.$tabList.filter('[data-type="all"]');if(!i.hasClass("current")){t.$tabList.removeClass("current");i.addClass("current");t.commentList.load({listType:0,currentPage:1},"add",n)}else n()},scrollForm:function(){var t=this;var n=t.form;if(!n)return;e("html,body").scrollTop(n.$el.offset().top-130);t.form.focus()},slefext:function(e){var t=this;var n=u.globals.page;if(void 0==n.objectType)n.objectType=1;t.objectInfo={objectId:n.videoId,objectType:n.objectType};t.userPermission={canDelete:(d.uid()||-1)==n.videoOwner,canSetTop:false};d.bind("login:after",function(){t.userPermission.canDelete=t.userPermission.canDelete||d.uid()==n.videoOwner});t.getStarActivity();a.switchEnv()},reset:function(e){var t=this;if(e==u.globals.page.videoId)return;u.globals.page.videoId=e;if(!t.hasLoaded)return;t.objectInfo.objectId=e;t.form&&t.form.reset(e);t.getStarActivity();t.commentEgg();t.$tabList.filter('[data-type="all"]').click()},tabChange:function(t){var n=this;var i=e(t.currentTarget);var a=i.data("type");if("input"==a&&n.form){n.scrollForm();return}if("my"==a&&!d.isLogin()){d.login(function(){n.tabChange(t)});return}n.$tabList.removeClass("current");i.addClass("current");n.load(a,1,"tab")},lazyLoad:function(e){var t=this;var n=t.$el;if(!n.length)return;function i(){var e=n.offset().top;if(f.scrollTop()+f.height()>e&&!t.hasLoaded){t.init();f.off("scroll.commentControlLazyLoad")}}f.on("scroll.commentControlLazyLoad",function(){i()});i()},commentNewNotic:function(t){var n=this;e(t.currentTarget).parent().hide(200);n.load("all",1,"commentnew");n.comstatusNum=1;if(!n.updateCommentTsTimer)n.updateCommentTs()},getInfo:function(){var e=this;a.getInfo({objectId:e.objectInfo.objectId,app:"pc"},function(t){if(0==t.code){var n=e.userPermission;n.canDelete=n.canDelete||t.data.pgc;n.canSetTop=n.canSetTop||t.data.pgc||t.data.canSetTop;e.commentList.updateDiffItem()}})},getStarActivity:function(){var e=this;var t=u.globals.page;var n={folderid:t.folderId,showid:t.showid,videoid:t.videoId,toppicid:t.catId,client:"pc"};e.dataStore=s.getInstance(n)},getStarInfo:function(){if(!u.check("text.star"))return;var e=this;var t=u.globals.page;a.getPersonInfo({showId:t.showid||0,app:"pc",videoId:t.videoId,catId:t.catId||0},function(t){if(0==t.code)e.commentList.starlink=t.data})},load:function(e,t,n){var i=this;var a=["all","owner"].indexOf(e);if(a!=-1&&"commentnew"!=n)i.posts&&i.posts.refresh(a);i.commentList.load({listType:v[e],currentPage:t},n)},commentTabBanner:function(){if(!u.check("tabFixed"))return;var t=this;var n=e(".comment-tab",t.$el);var i=t.$tabList.filter('[data-type="input"]');var a={satae:"stable",tab_innerOffsetTop:false,test:function(){var e=parseInt(f.scrollTop());if(!a.tab_innerOffsetTop)a.tab_innerOffsetTop=n.offset().top-81;if(e<a.tab_innerOffsetTop)a.stable();else a.fixed()},fixed:function(){if("stable"!=a.satae)return;a.satae="fixed";u.check("operate.input")&&i.show();n.addClass("comment-tab-fixed");var e=n.parent().width();if(n.width()!=e)n.css("width",e);a.tab_innerOffsetTop=n.offset().top-81},stable:function(){if("fixed"!=a.satae)return;a.satae="stable";i.hide();n.removeClass("comment-tab-fixed");a.tab_innerOffsetTop=false},bindScroll:function(){a.test();f.on("scroll",a.test)}};a.bindScroll()},loadTab:function(){var e=this;a.navigationBar({app:"pc",objectId:e.objectInfo.objectId},function(t){var n=[];if(0==t.code&&t.data.length>0){if(96==u.globals.page.catId)t.data.push({name:"豆瓣评论"});n=t.data.map(function(e){return h[e.name]})}n.forEach(function(t){u.check("tab."+t)&&e.$tabList.filter('[data-type="'+t+'"]').addClass("comment-show")})});u.check("tab.my",function(){e.$tabList.filter('[data-type="my"]').addClass("comment-show")})},updateCommentTs:function(){var t=this;if(t.lasttime&&t.lasttime>=15)return false;a.objectCommentStatus({app:"pc",objectId:t.objectInfo.objectId,objectType:t.objectInfo.objectType,listType:"0",lastCommentId:t.lastid||0},function(n){if(0==n.code&&n.data.newCount>0){e(".comment-new-tooltip",t.$el).show();clearTimeout(t.updateCommentTsTimer);t.updateCommentTsTimer=null}});t.comstatusNum++;if(t.comstatusNum>10)t.comstatusNum=10;clearTimeout(t.updateCommentTsTimer);t.updateCommentTsTimer=setTimeout(function(){t.updateCommentTs()},t.comstatus*t.comstatusNum)},commentEgg:function(){var e=this;if(!u.check("egg")||!e.form)return;var t=u.globals.page;new m({form:e.form,params:{client:"pc",folderid:t.folderId,showid:t.showid,videoid:t.videoId,toppicid:t.catId}})},init:function(){var e=this;e.hasLoaded=true;d.init();e.getInfo();e.getStarInfo();e.loadTab();setTimeout(function(){e.updateCommentTs()},e.comstatus);e.commentTabBanner();setTimeout(function(){e.load("all",1,"init");r.init(e.dataStore)},1e3)}});return g});n("page/find/play/comment",["module/comment/v3/comment","module/comment/v3/commentConfig","module/comment/v3/commentLogin","module/login/login"],function(e,t,n,i){var a=["test.comment.youku.com","video-prepub.youku.com","video-develop.youku.com","video-develop.inner.youku.com"].indexOf(window.location.hostname)>=0;t.init({},{page:window.PageConfig,appId:"100-DDwODVkv",appSecret:window.location.search.indexOf("type=test")>0?"24b556b2e1e8194280173e5d6b4c0875":"6c4aa6af6560efff5df3c16c704b49f1",commentSource:"20000",isTestEnv:a});n.loginFunc=function(){i.login()};i.bind("login:success",function(){n.trigger("login:success")});new e({el:"#module_basic_comment"})})}(window.jQuery,window.oz.require,window.oz.define);;GW      YXYX=1Y[W{   ?    :http://js.ykimg.com/youku/dist/js/page/find/play/comment_31.js necko:classified 1 strongly-framed 1 request-method GET request-Accept-Encoding gzip, deflate response-head HTTP/1.1 200 OK
Server: Tengine
Content-Type: text/javascript
Content-Length: 144112
Date: Sun, 02 Jul 2017 08:53:16 GMT
Expires: Tue, 04 Jul 2017 08:53:16 GMT
Cache-Control: max-age=172800
Accept-Ranges: bytes
Etag: "1687879318"
Last-Modified: Thu, 29 Jun 2017 01:50:01 GMT
Timing-Allow-Origin: *, *
Vary: Accept-Encoding
Via: cache12.l2nu17-1[0,304-0,H], cache9.l2nu17-1[1,0], cache5.cn600[0,200-0,H], cache2.cn600[0,0]
Age: 185
X-Cache: HIT TCP_MEM_HIT dirn:7:220746446
x-swift-savetime: Sun, 02 Jul 2017 08:54:52 GMT
x-swift-cachetime: 300
eagleid: 01bddb4214989857816417155e
 original-response-headers Server: Tengine
Content-Type: text/javascript
Content-Length: 144112
Connection: keep-alive
Date: Sun, 02 Jul 2017 08:53:16 GMT
Expires: Tue, 04 Jul 2017 08:53:16 GMT
Cache-Control: max-age=172800
Accept-Ranges: bytes
Etag: "1687879318"
Last-Modified: Thu, 29 Jun 2017 01:50:01 GMT
Timing-Allow-Origin: *, *
Vary: Accept-Encoding
Via: cache12.l2nu17-1[0,304-0,H], cache9.l2nu17-1[1,0], cache5.cn600[0,200-0,H], cache2.cn600[0,0]
Age: 185
X-Cache: HIT TCP_MEM_HIT dirn:7:220746446
x-swift-savetime: Sun, 02 Jul 2017 08:54:52 GMT
x-swift-cachetime: 300
eagleid: 01bddb4214989857816417155e
 uncompressed-len 0 net-response-time-onstart 468 net-response-time-onstop 468  2